<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>RPI 5" Showcase - Home</title>
    
    <!-- Critical CSS Loading - Prevent FOUC (Flash of Unstyled Content) -->
    <style>
      /* Critical styles - loaded immediately */
      html, body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #000 !important;
        color: #fff !important;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        /* Force hardware acceleration */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        /* Optimize rendering */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeSpeed;
      }
      
      /* Prevent flash of white background */
      #app {
        background: #000 !important;
        height: 100vh;
        display: flex;
        flex-direction: column;
        /* GPU acceleration */
        transform: translateZ(0);
        will-change: transform;
      }
      
      /* Optimize for returning users */
      .returning-user .loading-overlay {
        animation-duration: 0.2s !important;
        transition-duration: 0.2s !important;
      }
      
      /* Loading screen to prevent FOUC */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(to bottom, #1e0033, #3b0057, #4b0063);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.5s ease-out;
      }
      
      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }
      
      .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loading-text {
        margin-top: 20px;
        color: white;
        font-size: 16px;
        text-align: center;
        font-weight: 500;
        letter-spacing: 0.5px;
      }
    </style>
    
    <!-- Smart Quality Detection System for Pi 3/4/5 -->
    <script>
      // Device capability detection and quality mode selection
      (function() {
        'use strict';
        
        // Detect device capabilities
        const deviceInfo = {
          // CPU cores
          cores: navigator.hardwareConcurrency || 1,
          
          // Memory (approximate)
          memory: navigator.deviceMemory || 1,
          
          // GPU info
          gpu: {
            vendor: '',
            renderer: ''
          },
          
          // Screen size and pixel density
          screen: {
            width: screen.width,
            height: screen.height,
            pixelRatio: window.devicePixelRatio || 1
          },
          
          // User agent hints
          userAgent: navigator.userAgent.toLowerCase()
        };
        
        // Try to get GPU info
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (gl) {
            deviceInfo.gpu.vendor = gl.getParameter(gl.VENDOR) || '';
            deviceInfo.gpu.renderer = gl.getParameter(gl.RENDERER) || '';
          }
        } catch (e) {
          console.log('GPU detection failed:', e);
        }
        
        // Determine quality mode based on device capabilities
        function determineQualityMode() {
          // Pi 3B+ detection (4 cores, low memory, older GPU)
          if (deviceInfo.cores === 4 && 
              deviceInfo.memory <= 1 && 
              deviceInfo.userAgent.includes('armv7l')) {
            return 'low';
          }
          
          // Pi 4 detection (4 cores, more memory, better GPU)
          if (deviceInfo.cores === 4 && 
              deviceInfo.memory > 1 && 
              deviceInfo.userAgent.includes('armv7l')) {
            return 'medium';
          }
          
          // Pi 5 detection (4+ cores, more memory, modern GPU)
          if (deviceInfo.cores >= 4 && 
              deviceInfo.memory > 2 && 
              (deviceInfo.userAgent.includes('aarch64') || deviceInfo.userAgent.includes('armv8'))) {
            return 'high';
          }
          
          // Fallback based on memory
          if (deviceInfo.memory <= 1) return 'low';
          if (deviceInfo.memory <= 2) return 'medium';
          return 'high';
        }
        
        // Set quality mode globally
        window.QUALITY_MODE = determineQualityMode();
        window.DEVICE_INFO = deviceInfo;
        
        // Log detection results
        console.log('🔍 Device Detection:', {
          cores: deviceInfo.cores,
          memory: deviceInfo.memory + 'GB',
          gpu: deviceInfo.gpu.renderer,
          screen: `${deviceInfo.screen.width}x${deviceInfo.screen.height}`,
          qualityMode: window.QUALITY_MODE
        });
        
        // Add quality mode indicator to body
        document.addEventListener('DOMContentLoaded', function() {
          document.body.setAttribute('data-quality-mode', window.QUALITY_MODE);
          console.log(`🎮 Quality Mode: ${window.QUALITY_MODE.toUpperCase()}`);
        });
      })();
    </script>
    
    <!-- Enhanced Emoji Font Support for Raspberry Pi -->
    <style>
      /* Multiple emoji font sources for better compatibility */
      @font-face {
        font-family: 'NotoColorEmoji';
        src: url('https://fonts.gstatic.com/s/notocoloremoji/v25/Yq6P-KqIXTD0t4D9z1ESnKM3-HpFabsE4tq3luCC7p-aXxcn.woff2') format('woff2');
        font-display: swap;
      }
      
      @font-face {
        font-family: 'TwemojiMozilla';
        src: url('https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/fonts/TwemojiMozilla.ttf') format('truetype');
        font-display: swap;
      }
      
      /* Comprehensive emoji font stack for Raspberry Pi */
      .emoji-text {
        font-family: 'NotoColorEmoji', 'TwemojiMozilla', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', 'EmojiOne Mozilla', 'Segoe UI Symbol', sans-serif;
        font-variant-emoji: emoji;
        text-rendering: optimizeSpeed;
        -webkit-font-feature-settings: "liga" 1, "dlig" 1;
        font-feature-settings: "liga" 1, "dlig" 1;
      }
      
      /* Quality mode CSS variables */
      :root {
        /* Low quality (Pi 3B+) */
        --low-particles: 15;
        --low-animations: none;
        --low-effects: none;
        --low-background: simple;
        
        /* Medium quality (Pi 4) */
        --medium-particles: 40;
        --medium-animations: basic;
        --medium-effects: basic;
        --medium-background: gradient;
        
        /* High quality (Pi 5) */
        --high-particles: 80;
        --high-animations: full;
        --high-effects: full;
        --high-background: complex;
      }

      /* Apply quality modes */
      [data-quality-mode="low"] {
        --particles: var(--low-particles);
        --animations: var(--low-animations);
        --effects: var(--low-effects);
        --background: var(--low-background);
      }

      [data-quality-mode="medium"] {
        --particles: var(--medium-particles);
        --animations: var(--medium-animations);
        --effects: var(--medium-effects);
        --background: var(--medium-background);
      }

      [data-quality-mode="high"] {
        --particles: var(--high-particles);
        --animations: var(--high-animations);
        --effects: var(--high-effects);
        --background: var(--high-background);
      }
    </style>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="RPI Showcase" />
    <meta name="msapplication-TileColor" content="#000000" />
    <meta name="msapplication-config" content="none" />
    
    <!-- Preload emoji fonts for better performance -->
    <link rel="preload" href="https://fonts.gstatic.com/s/notocoloremoji/v25/Yq6P-KqIXTD0t4D9z1ESnKM3-HpFabsE4tq3luCC7p-aXxcn.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/fonts/TwemojiMozilla.ttf" as="font" type="font/ttf" crossorigin>
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="./assets/Matrix.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="./assets/Matrix.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/Matrix.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="./assets/Matrix.png" />
  </head>
  <body>
    <!-- Loading overlay to prevent FOUC -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Matrix TSL loading...</div>
      </div>
    </div>
    
    <!-- Preload critical resources -->
    <script>
      // Immediate DOM ready check and loading management
      (function() {
        'use strict';
        
        // Track loading state
        let cssLoaded = false;
        let domReady = false;
        let assetsLoaded = false;
        
        // Function to hide loading overlay when everything is ready
        function checkAllLoaded() {
          if (cssLoaded && domReady && assetsLoaded) {
            setTimeout(() => {
              const overlay = document.getElementById('loadingOverlay');
              if (overlay) {
                overlay.classList.add('hidden');
                setTimeout(() => {
                  overlay.remove();
                }, 500);
              }
            }, 300); // Small delay to ensure smooth transition
          }
        }
        
        // Mark CSS as loaded (will be set when main styles are applied)
        window.markCSSLoaded = function() {
          cssLoaded = true;
          checkAllLoaded();
        };
        
        // Mark DOM as ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            domReady = true;
            checkAllLoaded();
          });
        } else {
          domReady = true;
        }
        
        // Mark assets as loaded
        window.addEventListener('load', function() {
          assetsLoaded = true;
          checkAllLoaded();
        });
        
        // Fallback: hide loading overlay after maximum 3 seconds
        setTimeout(() => {
          const overlay = document.getElementById('loadingOverlay');
          if (overlay && !overlay.classList.contains('hidden')) {
            console.log('Fallback: Hiding loading overlay after timeout');
            overlay.classList.add('hidden');
            setTimeout(() => overlay.remove(), 500);
          }
        }, 3000);
        
      })();
    </script>
    
    <!-- Navigation Optimizer - Prevents CSS loading delays on return visits -->
    <script src="./js/navigation-optimizer.js"></script>
    
    <!-- Optimized cache management script -->
    <script>
      (function() {
        'use strict';
        
        // Less aggressive cache clearing - only clear old versions
        async function clearOldCaches() {
          try {
            if ('caches' in window) {
              const cacheNames = await caches.keys();
              // Only clear caches that are truly old (not current version)
              const oldCaches = cacheNames.filter(name => 
                name.includes('rpi-5inch-showcase') && !name.includes('v4')
              );
              
              if (oldCaches.length > 0) {
                console.log('🧹 Clearing old caches:', oldCaches);
                await Promise.all(
                  oldCaches.map(cacheName => caches.delete(cacheName))
                );
                console.log('✅ Old caches cleared');
              }
            }
          } catch (error) {
            console.log('⚠️ Cache clearing error:', error);
          }
        }
        
        // Check if we're returning from another page
        const isReturning = sessionStorage.getItem('showcase-navigation');
        
        if (isReturning) {
          // If returning, prioritize speed over cache clearing
          console.log('🔄 Returning to homepage - prioritizing speed');
        } else {
          // If first visit, do cache maintenance
          clearOldCaches();
          sessionStorage.setItem('showcase-navigation', 'true');
        }
        
        // Reduced development mode cache clearing
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
          console.log('🔧 Development mode detected');
          
          // Only force reload if it's been more than 30 minutes since last reload
          const lastReload = sessionStorage.getItem('lastReload');
          const now = Date.now();
          if (lastReload && (now - parseInt(lastReload)) > 1800000) { // 30 minutes
            console.log('🔄 Development mode: forcing fresh reload (30min interval)');
            sessionStorage.setItem('lastReload', now.toString());
            window.location.reload(true);
          } else if (!lastReload) {
            sessionStorage.setItem('lastReload', now.toString());
          }
        }
      })();
    </script>
    
    <div id="app">
      <header class="topbar">
        <img src="./assets/Matrix.png" alt="Matrix TSL" class="logo top-logo animated-logo2" />
        <div class="title-container">
          <h1 class="title">
            <span class="text-reveal">Inspiring the next generation of Engineers</span>
          </h1>
        </div>
      </header>

      <main id="main-content">
        <!-- Home screen content -->
        <section id="screen-home" class="screen active">
          <div class="particles" id="particles"></div>
          <div class="grid">
                           <!-- STL Viewer hidden - keeping GLB viewer instead -->
              <!-- <a href="./screens/stl.html" class="card fancy theme-orange">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon"></div>
                <span class="label">3D Model</span>
              </a> -->
             <a href="./screens/glb.html" class="card fancy theme-purple">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="3D"></div>
               <span class="label">3D Models</span>
             </a>
             <a href="./screens/printer.html" class="card fancy theme-red">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="PRINT"></div>
               <span class="label">3D Printer Demo</span>
             </a>
             <a href="./screens/about.html" class="card fancy theme-silver">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="INFO"></div>
               <span class="label">About</span>
             </a>
                                        <a href="./screens/ai-chat.html" class="card fancy theme-green">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="AI"></div>
                <span class="label">AI Chat</span>
              </a>
              <a href="./screens/curriculum.html" class="card fancy theme-teal">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="CURR"></div>
                <span class="label">Curriculum</span>
              </a>

               <a href="./screens/electrical-machines.html" class="card fancy theme-blue">
                 <div class="border-animation"></div>
                 <div class="card-particles"></div>
                 <div class="icon" data-text-fallback="MACH"></div>
                 <span class="label">Electrical Machines</span>
               </a>
             <a href="./screens/games.html" class="card fancy theme-gold">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="GAME"></div>
               <span class="label">Games Hub</span>
             </a>
             
             <a href="./screens/ar-hub.html" class="card fancy theme-violet">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="AR"></div>
               <span class="label">AR Hub</span>
             </a>
                           <a href="./screens/scroll.html" class="card fancy theme-grey">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="SCROLL"></div>
                <span class="label">Scroll Test</span>
              </a>
             <a href="./screens/settings.html" class="card fancy theme-blue">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="SET"></div>
               <span class="label">Settings</span>
             </a>
             <a href="./screens/info.html" class="card fancy theme-purple">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="INFO"></div>
               <span class="label">System Info</span>
             </a>
             <a href="./screens/touch.html" class="card fancy theme-cyan">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="TOUCH"></div>
               <span class="label">Touch Demo</span>
             </a>
             <a href="./screens/video.html" class="card fancy theme-indigo">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="VIDEO"></div>
               <span class="label">Video Player</span>
             </a>
             <a href="./screens/visuals.html" class="card fancy theme-lime">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="ART"></div>
               <span class="label">Visuals</span>
             </a>

             <a href="./screens/graphs-combined.html" class="card fancy theme-purple">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="CHART"></div>
               <span class="label">Advanced Charts</span>
             </a>
                           <a href="./screens/react-chart-demo.html" class="card fancy theme-cyan">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="REACT"></div>
                <span class="label">React Charts</span>
              </a>
              <a href="./screens/buttons.html" class="card fancy theme-pink">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="BTN"></div>
                <span class="label">Buttons</span>
              </a>
             <a href="./screens/student-dashboard.html" class="card fancy theme-green">
               <div class="border-animation"></div>
               <div class="card-particles"></div>
               <div class="icon" data-text-fallback="DASH"></div>
               <span class="label">Student Dashboard</span>
             </a>
                           <a href="./screens/wind-tunnel.html" class="card fancy theme-cyan">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="WIND"></div>
                <span class="label">Wind Tunnel</span>
              </a>
              
              <a href="./emoji-test.html" class="card fancy theme-orange">
                <div class="border-animation"></div>
                <div class="card-particles"></div>
                <div class="icon" data-text-fallback="TEST"></div>
                <span class="label">Emoji Test</span>
              </a>
           </div>
        </section>
      </main>
    </div>
    
    <!-- EMBEDDED CSS - Loaded immediately after critical styles -->
    <style>
      /* Base styles for the showcase container */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #000;
        color: #fff;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
      }
      
      #app {
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      /* Topbar styles */
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 1000;
      }
      
      .logo {
        height: 40px;
        width: auto;
      }
      
      .top-logo {
        animation: pulse 2s infinite;
      }
      
      .title-container {
        flex: 1;
        display: flex;
        justify-content: center;
        overflow: hidden;
      }
      
      .title {
        font-size: 24px;
        font-weight: 600;
        color: white;
        margin: 0;
        text-align: center;
        letter-spacing: -0.5px;
        overflow: hidden;
      }
      
      .text-reveal {
        display: inline-block;
        background: linear-gradient(90deg, #ffffff, #f0f0f0, #ffffff);
        background-size: 200% auto;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shine 6s linear infinite, textReveal 2s ease-out;
      }
      
      @keyframes shine {
        0% { background-position: 0% center; }
        100% { background-position: 200% center; }
      }
      
      @keyframes textReveal {
        0% { 
          opacity: 0;
          transform: translateY(20px);
          letter-spacing: 5px;
        }
        30% {
          opacity: 0.5;
        }
        100% { 
          opacity: 1;
          transform: translateY(0);
          letter-spacing: -0.5px;
        }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      
      /* Main content area */
      #main-content {
        flex: 1;
        overflow: hidden;
        position: relative;
      }
      
      /* Screen base styles */
      .screen {
        display: block;
        height: 100%;
        width: 100%;
      }
      
      /* Home screen specific styles - scoped to #screen-home */
      #screen-home {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 15px 10px; /* Reduced padding for more space */
        background: linear-gradient(to bottom, #1e0033, #3b0057, #4b0063);
        height: 100%;
        width: 100%;
        position: relative;
        overflow: hidden;
      }
      
      /* Animated background */
      #screen-home::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
          radial-gradient(circle at 20% 30%, rgba(157, 78, 221, 0.4) 0%, transparent 25%),
          radial-gradient(circle at 80% 70%, rgba(86, 24, 128, 0.4) 0%, transparent 35%),
          radial-gradient(circle at 40% 80%, rgba(194, 158, 255, 0.3) 0%, transparent 20%);
        z-index: 0;
        animation: cosmic-pulse 15s ease infinite alternate;
      }
      
      @keyframes cosmic-pulse {
        0% { opacity: 0.5; background-position: 0% 0%; }
        50% { opacity: 0.7; background-position: 10% 10%; }
        100% { opacity: 0.5; background-position: 0% 0%; }
      }
      
      /* Moving particles - cosmic stars and nebulae */
      .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
      }
      
      .particle {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 
          0 0 10px rgba(255, 255, 255, 0.5),
          0 0 20px rgba(255, 255, 255, 0.3),
          0 0 30px rgba(255, 255, 255, 0.1);
        pointer-events: none;
      }
      
      /* Different types of cosmic particles */
      .particle:nth-child(3n+1) {
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 
          0 0 10px rgba(255, 255, 255, 0.8),
          0 0 20px rgba(255, 255, 255, 0.5),
          0 0 30px rgba(255, 255, 255, 0.3);
      }
      
      .particle:nth-child(3n+2) {
        background: rgba(194, 158, 255, 0.9);
        box-shadow: 
          0 0 10px rgba(194, 158, 255, 0.8),
          0 0 20px rgba(194, 158, 255, 0.5),
          0 0 30px rgba(194, 158, 255, 0.3);
      }
      
      .particle:nth-child(3n+3) {
        background: rgba(135, 206, 250, 0.9);
        box-shadow: 
          0 0 10px rgba(135, 206, 250, 0.8),
          0 0 20px rgba(135, 206, 250, 0.5),
          0 0 30px rgba(135, 206, 250, 0.3);
      }
      
      /* Create nebula effect */
      .nebula {
        position: absolute;
        border-radius: 50%;
        filter: blur(40px);
        opacity: 0.15;
        pointer-events: none;
        z-index: 0;
        animation: nebula-pulse 10s ease-in-out infinite alternate;
        mix-blend-mode: screen;
      }
      
      @keyframes nebula-pulse {
        0% { transform: scale(1); opacity: 0.1; }
        50% { transform: scale(1.1); opacity: 0.2; }
        100% { transform: scale(1); opacity: 0.1; }
      }
      
      /* Shooting stars */
      @keyframes shooting-star {
        0% { 
          transform: translateX(0) translateY(0) rotate(215deg) scale(0);
          opacity: 0;
        }
        10% {
          transform: translateX(-10vw) translateY(10vh) rotate(215deg) scale(1);
          opacity: 1;
        }
        20% {
          transform: translateX(-20vw) translateY(20vh) rotate(215deg) scale(1);
          opacity: 0;
        }
        100% {
          transform: translateX(-20vw) translateY(20vh) rotate(215deg) scale(1);
          opacity: 0;
        }
      }
      
      /* Distant galaxy clusters */
      .galaxy-cluster {
        position: absolute;
        width: 120px;
        height: 120px;
        background: radial-gradient(
          ellipse at center,
          rgba(255, 255, 255, 0.2) 0%,
          rgba(194, 158, 255, 0.1) 40%,
          rgba(86, 24, 128, 0.05) 60%,
          transparent 80%
        );
        border-radius: 50%;
        filter: blur(15px);
        opacity: 0.3;
        z-index: 0;
        mix-blend-mode: screen;
      }
      
      #screen-home .grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 4-column layout for better card size */
        grid-template-rows: repeat(auto-fit, minmax(80px, 1fr)); /* Fixed minimum row height for uniformity */
        gap: clamp(6px, 1.5vw, 15px); /* Smaller gap for more space */
        max-width: 95vw; /* Use more viewport width */
        width: 100%;
        height: calc(100vh - 120px); /* Fixed height to prevent overflow */
        z-index: 10;
        position: relative;
        padding: 10px;
        box-sizing: border-box;
        align-content: start; /* Align grid items to start */
        /* Ensure uniform grid item sizing */
        grid-auto-rows: 1fr;
        align-items: stretch;
      }
      
      #screen-home .card {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: clamp(6px, 1.5vw, 12px);
        padding: clamp(8px, 2vw, 20px) clamp(6px, 1.5vw, 15px);
        text-align: center;
        cursor: pointer;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        min-height: clamp(80px, 12vh, 120px); /* Uniform minimum height */
        height: 100%; /* Force all cards to same height */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 2;
        text-decoration: none;
        color: white;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        animation: float 3s ease-in-out infinite;
        transform-style: preserve-3d;
        perspective: 1000px;
        box-shadow: 
          0 clamp(2px, 1vw, 5px) clamp(8px, 2vw, 15px) rgba(0, 0, 0, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.2),
          inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        /* Ensure uniform sizing */
        box-sizing: border-box;
        flex-shrink: 0;
        /* Force uniform dimensions */
        aspect-ratio: 1;
        width: 100%;
        height: 100%;
      }
      
      /* Add a glossy reflection effect */
      #screen-home .card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 60%;
        background: linear-gradient(to bottom, 
          rgba(255, 255, 255, 0.2) 0%, 
          rgba(255, 255, 255, 0.1) 40%, 
          rgba(255, 255, 255, 0) 100%);
        border-radius: 15px 15px 100px 100px;
        pointer-events: none;
        z-index: 2;
        opacity: 0.5;
        transition: opacity 0.5s ease;
      }
      
      #screen-home .card:hover::after {
        opacity: 0.8;
      }
      
      /* Add a border glow effect */
      #screen-home .card::before {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 17px;
        background: linear-gradient(45deg, 
          rgba(255, 255, 255, 0.1), 
          rgba(255, 255, 255, 0.5), 
          rgba(255, 255, 255, 0.1));
        background-size: 200% 200%;
        z-index: -1;
        animation: border-glow 3s linear infinite;
        opacity: 0.5;
        transition: opacity 0.5s ease;
      }
      
      @keyframes border-glow {
        0% { background-position: 0% 0%; }
        100% { background-position: 200% 0%; }
      }
      
      #screen-home .card:hover::before {
        opacity: 1;
      }
      
      /* Different float animations for each card */
      #screen-home .card:nth-child(1) { animation: float 4s ease-in-out infinite; }
      #screen-home .card:nth-child(2) { animation: float 3.5s ease-in-out infinite 0.1s; }
      #screen-home .card:nth-child(3) { animation: float 4.5s ease-in-out infinite 0.2s; }
      #screen-home .card:nth-child(4) { animation: none; }
      #screen-home .card:nth-child(5) { animation: float 4.2s ease-in-out infinite 0.4s; }
      #screen-home .card:nth-child(6) { animation: float 3.8s ease-in-out infinite 0.5s; }
      #screen-home .card:nth-child(7) { animation: float 4.7s ease-in-out infinite 0.6s; }
      #screen-home .card:nth-child(8) { animation: float 3.3s ease-in-out infinite 0.7s; }
      #screen-home .card:nth-child(9) { animation: float 4.9s ease-in-out infinite 0.8s; }
      
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
      }
      
      #screen-home .card .label {
        font-size: clamp(10px, 2.5vw, 16px);
        font-weight: 600;
        margin-top: clamp(6px, 1vw, 12px);
        z-index: 2;
        position: relative;
        animation: pulse 2s infinite;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
        transform: translateZ(30px);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.8));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
        line-height: 1.2;
        text-align: center;
      }
      
      /* Override pulse animation for Scroll Test card label */
      #screen-home .card:nth-child(4) .label {
        animation: textScrollAround 3s linear infinite;
      }
      
      #screen-home .card:hover .label {
        transform: translateZ(40px) scale(1.1);
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.6));
      }
      
      /* Override hover effect for Scroll Test card label */
      #screen-home .card:nth-child(4):hover .label {
        transform: translateZ(40px) scale(1.05);
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.6));
        animation: textScrollAround 1.5s linear infinite;
      }
      
      #screen-home .card .icon {
        width: clamp(35px, 8vw, 55px);
        height: clamp(35px, 8vw, 55px);
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        margin-bottom: clamp(6px, 1vw, 12px);
        z-index: 2;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(16px, 4vw, 28px);
        animation: spin 5s linear infinite;
        transform: translateZ(40px);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 
          0 clamp(2px, 1vw, 5px) clamp(8px, 2vw, 15px) rgba(0, 0, 0, 0.3),
          inset 0 1px 1px rgba(255, 255, 255, 0.6);
      }
      
      /* Enhanced emoji support for all card icons */
      #screen-home .card .icon::before {
        font-family: 'NotoColorEmoji', 'TwemojiMozilla', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', 'EmojiOne Mozilla', 'Segoe UI Symbol', sans-serif;
        font-variant-emoji: emoji;
        text-rendering: optimizeSpeed;
        -webkit-font-feature-settings: "liga" 1, "dlig" 1;
        font-feature-settings: "liga" 1, "dlig" 1;
        font-size: 24px;
        line-height: 1;
        display: inline-block;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      #screen-home .card:hover .icon {
        transform: translateZ(50px) scale(1.2);
        box-shadow: 
          0 8px 25px rgba(0, 0, 0, 0.4),
          inset 0 2px 3px rgba(255, 255, 255, 0.7);
      }
      
      /* Different animations for each card's icon */
      #screen-home .card:nth-child(1) .icon { animation: bounce 2s infinite; }
      #screen-home .card:nth-child(2) .icon { animation: spin 4s linear infinite; }
      #screen-home .card:nth-child(3) .icon { animation: wobble 3s ease-in-out infinite; }
      #screen-home .card:nth-child(4) .icon { animation: none; }
      #screen-home .card:nth-child(5) .icon { animation: flip 4s infinite; }
      #screen-home .card:nth-child(6) .icon { animation: rotate3d 5s infinite; }
      #screen-home .card:nth-child(7) .icon { animation: jump 2.5s infinite; }
      #screen-home .card:nth-child(8) .icon { animation: shake 4s cubic-bezier(.36,.07,.19,.97) infinite; }
      #screen-home .card:nth-child(9) .icon { animation: glow 3s infinite; }
      #screen-home .card:nth-child(10) .icon { animation: pulse 2.8s infinite; }
      #screen-home .card:nth-child(11) .icon { animation: rotate3d 6s infinite; }
      #screen-home .card:nth-child(12) .icon { animation: spin 5s linear infinite; }
             #screen-home .card:nth-child(13) .icon { animation: wobble 2.5s ease-in-out infinite; }
       #screen-home .card:nth-child(14) .icon { animation: flash 2s infinite; }
       #screen-home .card:nth-child(15) .icon { animation: bounce 2.2s infinite; }
       #screen-home .card:nth-child(19) .icon { animation: spin 4.5s linear infinite; }
       
       /* Different animations for each card's label */
       #screen-home .card:nth-child(1) .label { animation: glow 2.5s infinite; }
       #screen-home .card:nth-child(2) .label { animation: pulse 3s infinite 0.2s; }
       #screen-home .card:nth-child(3) .label { animation: glow 3.5s infinite 0.3s; }
       #screen-home .card:nth-child(4) .label { animation: textScrollAround 3s linear infinite; }
       #screen-home .card:nth-child(5) .label { animation: glow 3.2s infinite 0.5s; }
       #screen-home .card:nth-child(6) .label { animation: pulse 3.4s infinite 0.6s; }
       #screen-home .card:nth-child(7) .label { animation: glow 2.9s infinite 0.7s; }
       #screen-home .card:nth-child(8) .label { animation: pulse 3.7s infinite 0.8s; }
       #screen-home .card:nth-child(9) .label { animation: glow 3.1s infinite 0.9s; }
       #screen-home .card:nth-child(10) .label { animation: pulse 3.3s infinite 1.0s; }
       #screen-home .card:nth-child(11) .label { animation: glow 3.6s infinite 1.1s; }
       #screen-home .card:nth-child(12) .label { animation: pulse 3.8s infinite 1.2s; }
       #screen-home .card:nth-child(13) .label { animation: glow 3.4s infinite 1.3s; }
       #screen-home .card:nth-child(14) .label { animation: flash 2.5s infinite 1.4s; }
       #screen-home .card:nth-child(15) .label { animation: glow 2.8s infinite 1.5s; }
       #screen-home .card:nth-child(19) .label { animation: pulse 3.0s infinite 1.6s; }
      
      @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @keyframes wobble {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px) rotate(-5deg); }
        75% { transform: translateX(5px) rotate(5deg); }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
      }
      
      @keyframes flip {
        0% { transform: rotateY(0); }
        50% { transform: rotateY(180deg); }
        100% { transform: rotateY(360deg); }
      }
      
      @keyframes rotate3d {
        0% { transform: rotate3d(1, 1, 1, 0deg); }
        50% { transform: rotate3d(1, 1, 1, 180deg); }
        100% { transform: rotate3d(1, 1, 1, 360deg); }
      }
      
      @keyframes jump {
        0%, 100% { transform: translateY(0) scale(1); }
        50% { transform: translateY(-15px) scale(1.1); }
      }
      
             @keyframes glow {
         0%, 100% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
         50% { text-shadow: 0 0 20px rgba(255, 255, 255, 1), 0 0 30px rgba(255, 255, 255, 0.8); }
       }
       
       @keyframes flash {
         0%, 100% { opacity: 1; transform: scale(1); }
         50% { opacity: 0.7; transform: scale(1.1); }
       }
      
      /* 3D Model Card - 1st position */
      #screen-home .card:nth-child(1) .icon::before {
        content: "🔲";
      }
      
      #screen-home .card:nth-child(1) .icon::after {
        content: "3D";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 8px;
        font-weight: bold;
        color: rgba(255,255,255,0.8);
        display: none;
        font-family: Arial, sans-serif;
      }
      
      /* Enhanced emoji fallback system */
      @supports not (font-variant-emoji: emoji) {
        #screen-home .card .icon::before {
          display: none;
        }
        #screen-home .card .icon::after {
          display: block !important;
        }
      }
      
      /* Show text fallbacks by default, hide when emojis load */
      #screen-home .card .icon::after {
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 8px;
        font-weight: bold;
        color: rgba(255,255,255,0.8);
        font-family: Arial, sans-serif;
        z-index: 2;
        opacity: 0.7;
      }
      
      /* Hide text fallbacks when emojis are working */
      .emojis-working #screen-home .card .icon::after {
        display: none;
      }
      
      /* Force emoji rendering on supported systems */
      @supports (font-variant-emoji: emoji) {
        #screen-home .card .icon::before {
          font-variant-emoji: emoji;
          -webkit-font-variant-emoji: emoji;
        }
      }
      
      /* Additional emoji optimization */
      #screen-home .card .icon::before {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
        font-size: 24px !important;
        line-height: 1 !important;
        text-align: center !important;
        vertical-align: middle !important;
      }
      
      /* Ensure emojis are properly sized on different devices */
      @media (max-width: 768px) {
        #screen-home .card .icon::before {
          font-size: 20px !important;
        }
      }
      
      @media (max-width: 480px) {
        #screen-home .card .icon::before {
          font-size: 18px !important;
        }
      }
      
      /* 3D Printer Demo Card - 2nd position */
      #screen-home .card:nth-child(2) .icon::before {
        content: "🖨️";
      }
      #screen-home .card:nth-child(2) .icon::after {
        content: "PRINT";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 7px;
        font-weight: bold;
        color: rgba(255,255,255,0.8);
        display: none;
        font-family: Arial, sans-serif;
      }
      
      /* About Card - 3rd position */
      #screen-home .card:nth-child(3) .icon::before {
        content: "ℹ️";
      }
      #screen-home .card:nth-child(3) .icon::after {
        content: "INFO";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 8px;
        font-weight: bold;
        color: rgba(255,255,255,0.8);
        display: none;
        font-family: Arial, sans-serif;
      }
      
             /* AI Chat Card - 4th position */
       #screen-home .card:nth-child(4) .icon::before {
         content: "🤖";
       }
       #screen-home .card:nth-child(4) .icon::after {
         content: "AI";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Curriculum Card - 5th position */
       #screen-home .card:nth-child(5) .icon::before {
         content: "📚";
       }
       #screen-home .card:nth-child(5) .icon::after {
         content: "CURR";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 7px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
      
             /* AR Demo Card - 6th position */
       #screen-home .card:nth-child(6) .icon::before {
         content: "🔮";
       }
       #screen-home .card:nth-child(6) .icon::after {
         content: "AR";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
      
             /* Balloon Pop Card - 7th position */
       #screen-home .card:nth-child(7) .icon::before {
         content: "🎈";
       }
       #screen-home .card:nth-child(7) .icon::after {
         content: "POP";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 7px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Camera Showcase Card - 8th position */
       #screen-home .card:nth-child(8) .icon::before {
         content: "📷";
       }
       #screen-home .card:nth-child(8) .icon::after {
         content: "CAM";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 7px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Electrical Machines Card - 9th position */
       #screen-home .card:nth-child(9) .icon::before {
         content: "⚙️";
       }
       #screen-home .card:nth-child(9) .icon::after {
         content: "MACH";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 7px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Games Hub Card - 10th position */
       #screen-home .card:nth-child(10) .icon::before {
         content: "🎮";
       }
       #screen-home .card:nth-child(10) .icon::after {
         content: "GAME";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Scroll Test Card - 11th position */
       #screen-home .card:nth-child(11) .icon::before {
         content: "📜";
       }
       #screen-home .card:nth-child(11) .icon::after {
         content: "SCROLL";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 7px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Settings Card - 12th position */
       #screen-home .card:nth-child(12) .icon::before {
         content: "⚙️";
       }
       #screen-home .card:nth-child(12) .icon::after {
         content: "SET";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* System Info Card - 13th position */
       #screen-home .card:nth-child(13) .icon::before {
         content: "📊";
       }
       #screen-home .card:nth-child(13) .icon::after {
         content: "INFO";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Touch Demo Card - 14th position */
       #screen-home .card:nth-child(14) .icon::before {
         content: "👆";
       }
       #screen-home .card:nth-child(14) .icon::after {
         content: "TOUCH";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Video Player Card - 15th position */
       #screen-home .card:nth-child(15) .icon::before {
         content: "🎬";
       }
       #screen-home .card:nth-child(15) .icon::after {
         content: "VIDEO";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
       /* Visuals Card - 16th position */
       #screen-home .card:nth-child(16) .icon::before {
         content: "🎨";
       }
       #screen-home .card:nth-child(16) .icon::after {
         content: "ART";
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: 8px;
         font-weight: bold;
         color: rgba(255,255,255,0.8);
         display: none;
         font-family: Arial, sans-serif;
       }
       
               /* Wind Tunnel Card - 17th position */
        #screen-home .card:nth-child(17) .icon::before {
          content: "🌪️";
        }
        #screen-home .card:nth-child(17) .icon::after {
          content: "WIND";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 7px;
          font-weight: bold;
          color: rgba(255,255,255,0.8);
          display: none;
          font-family: Arial, sans-serif;
        }
        
        /* Buttons Card - 18th position */
        #screen-home .card:nth-child(18) .icon::before {
          content: "🔘";
        }
        #screen-home .card:nth-child(18) .icon::after {
          content: "BTN";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 7px;
          font-weight: bold;
          color: rgba(255,255,255,0.8);
          display: none;
          font-family: Arial, sans-serif;
        }
        
        /* Emoji Test Card - 19th position */
        #screen-home .card:nth-child(19) .icon::before {
          content: "🧪";
        }
        #screen-home .card:nth-child(19) .icon::after {
          content: "TEST";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 7px;
          font-weight: bold;
          color: rgba(255,255,255,0.8);
          display: none;
          font-family: Arial, sans-serif;
        }
      
      /* Touch Demo Card - Glow Effect */
      #screen-home .card:nth-child(1) {
        box-shadow: 0 0 15px rgba(0, 188, 212, 0.2);
      }
      
      #screen-home .card:nth-child(1):hover {
        box-shadow: 0 0 30px rgba(0, 188, 212, 0.6);
        transform: translateY(-5px);
      }
      
      /* System Info Card - Split Open Effect */
      #screen-home .card:nth-child(2) {
        transition: all 0.5s ease;
        overflow: hidden;
      }
      
      #screen-home .card:nth-child(2):hover {
        transform: scale(1.05);
      }
      
      #screen-home .card:nth-child(2)::before,
      #screen-home .card:nth-child(2)::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        transition: all 0.5s ease;
        background: rgba(156, 39, 176, 0.1);
        z-index: -1;
      }
      
      #screen-home .card:nth-child(2):hover::before {
        transform: translateX(-10px) rotate(-3deg);
      }
      
      #screen-home .card:nth-child(2):hover::after {
        transform: translateX(10px) rotate(3deg);
      }
      
      /* Games Hub Card - Flip Effect */
      #screen-home .card:nth-child(3) {
        perspective: 1000px;
        transition: all 0.6s ease;
      }
      
      #screen-home .card:nth-child(3):hover {
        transform: rotateY(180deg);
      }
      
      #screen-home .card:nth-child(3):hover .icon,
      #screen-home .card:nth-child(3):hover .label {
        transform: rotateY(180deg);
      }
      
      /* Scroll Test Card - Scroll Around Effect */
      #screen-home .card:nth-child(4) {
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        animation: scrollAround 4s linear infinite;
      }
      
      /* Scroll Test Card Text Animation */
      #screen-home .card:nth-child(4) .label {
        animation: textScrollAround 3s linear infinite;
        position: relative;
        overflow: hidden;
      }
      
      #screen-home .card:nth-child(4):hover {
        animation: scrollAround 1.5s linear infinite;
        transform: scale(1.05);
        box-shadow: 
          0 8px 25px rgba(0, 0, 0, 0.5),
          0 0 20px rgba(255, 255, 255, 0.3);
      }
      
      #screen-home .card:nth-child(4):hover .label {
        animation: textScrollAround 1.5s linear infinite;
      }
      
      @keyframes scrollAround {
        0% {
          transform: translateX(0) translateY(0) rotate(0deg);
        }
        25% {
          transform: translateX(10px) translateY(-10px) rotate(3deg);
        }
        50% {
          transform: translateX(0) translateY(-20px) rotate(0deg);
        }
        75% {
          transform: translateX(-10px) translateY(-10px) rotate(-3deg);
        }
        100% {
          transform: translateX(0) translateY(0) rotate(0deg);
        }
      }
      
      /* Text scrolling animation for Scroll Test card */
      @keyframes textScrollAround {
        0% {
          transform: translateX(0) translateY(0) rotate(0deg);
        }
        25% {
          transform: translateX(8px) translateY(-8px) rotate(2deg);
        }
        50% {
          transform: translateX(0) translateY(-15px) rotate(0deg);
        }
        75% {
          transform: translateX(-8px) translateY(-8px) rotate(-2deg);
        }
        100% {
          transform: translateX(0) translateY(0) rotate(0deg);
        }
      }
      
      /* Visuals Card - Pulse Effect */
      #screen-home .card:nth-child(5) {
        transition: all 0.3s ease;
      }
      
      #screen-home .card:nth-child(5):hover {
        animation: pulse-card 1.5s infinite;
      }
      
      @keyframes pulse-card {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      /* 3D Model Card - Rotate Effect */
      #screen-home .card:nth-child(6) {
        transition: all 0.5s ease;
      }
      
      #screen-home .card:nth-child(6):hover {
        transform: rotate(5deg) scale(1.1);
      }
      
      /* 3D Printer Demo Card - Layered Effect */
      #screen-home .card:nth-child(7) {
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
      }
      
      #screen-home .card:nth-child(7)::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: linear-gradient(transparent 0%, rgba(229, 57, 53, 0.1) 100%);
        top: 0;
        left: 0;
        z-index: 1;
        transform: translateY(100%);
        transition: transform 0.5s ease;
      }
      
      #screen-home .card:nth-child(7):hover::before {
        transform: translateY(0);
        animation: layerPrint 2s ease infinite;
      }
      
      @keyframes layerPrint {
        0% { transform: translateY(100%); }
        50% { transform: translateY(0%); }
        100% { transform: translateY(-100%); }
      }
      
      /* Settings Card - Shake Effect */
      #screen-home .card:nth-child(8) {
        transition: all 0.3s ease;
      }
      
      #screen-home .card:nth-child(8):hover {
        animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
      }
      
      @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-3px, 0, 0); }
        40%, 60% { transform: translate3d(3px, 0, 0); }
      }
      
      /* About Card - Expand Effect */
      #screen-home .card:nth-child(9) {
        transition: all 0.4s ease;
      }
      
      #screen-home .card:nth-child(9):hover {
        transform: scale(1.1);
        border-radius: 25px;
      }
      
      /* Border animations for all cards */
      #screen-home .card .border-animation {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 15px;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        animation: borderFlow 3s linear infinite;
        pointer-events: none;
        z-index: 1;
      }
      
      @keyframes borderFlow {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      
      /* Theme variations with vibrant gradients */
      #screen-home .theme-cyan { 
        border-color: #00bcd4; 
        background: linear-gradient(135deg, #00e5ff, #00bcd4, #0097a7);
        box-shadow: 0 5px 15px rgba(0, 188, 212, 0.6);
      }
      #screen-home .theme-purple { 
        border-color: #9c27b0; 
        background: linear-gradient(135deg, #ea80fc, #9c27b0, #7b1fa2);
        box-shadow: 0 5px 15px rgba(156, 39, 176, 0.6);
      }
      #screen-home .theme-indigo { 
        border-color: #3f51b5; 
        background: linear-gradient(135deg, #7986cb, #3f51b5, #303f9f);
        box-shadow: 0 5px 15px rgba(63, 81, 181, 0.6);
      }
      #screen-home .theme-gold { 
        border-color: #ff9800; 
        background: linear-gradient(135deg, #ffd740, #ff9800, #f57c00);
        box-shadow: 0 5px 15px rgba(255, 152, 0, 0.6);
      }
             #screen-home .theme-white { 
         border-color: #ffffff; 
         background: linear-gradient(135deg, #ffffff, #f5f5f5, #e0e0e0);
         box-shadow: 0 5px 15px rgba(255, 255, 255, 0.6);
       }
       #screen-home .theme-grey { 
         border-color: #666666; 
         background: linear-gradient(135deg, #888888, #666666, #444444);
         box-shadow: 0 5px 15px rgba(102, 102, 102, 0.6);
       }
      #screen-home .theme-lime { 
        border-color: #cddc39; 
        background: linear-gradient(135deg, #eeff41, #cddc39, #afb42b);
        box-shadow: 0 5px 15px rgba(205, 220, 57, 0.6);
      }
      #screen-home .theme-orange { 
        border-color: #ff5722; 
        background: linear-gradient(135deg, #ff9e80, #ff5722, #e64a19);
        box-shadow: 0 5px 15px rgba(255, 87, 34, 0.6);
      }
      #screen-home .theme-red { 
        border-color: #e53935; 
        background: linear-gradient(135deg, #ff8a80, #e53935, #c62828);
        box-shadow: 0 5px 15px rgba(229, 57, 53, 0.6);
      }
      #screen-home .theme-blue { 
        border-color: #2196f3; 
        background: linear-gradient(135deg, #82b1ff, #2196f3, #1976d2);
        box-shadow: 0 5px 15px rgba(33, 150, 243, 0.6);
      }
      #screen-home .theme-silver { 
        border-color: #9e9e9e; 
        background: linear-gradient(135deg, #e0e0e0, #9e9e9e, #757575);
        box-shadow: 0 5px 15px rgba(158, 158, 158, 0.6);
      }
      #screen-home        .theme-green { 
         border-color: #4caf50; 
         background: linear-gradient(135deg, #81c784, #4caf50, #388e3c);
         box-shadow: 0 5px 15px rgba(76, 175, 80, 0.6);
       }
       
       .theme-pink { 
         border-color: #e91e63; 
         background: linear-gradient(135deg, #f48fb1, #e91e63, #c2185b);
         box-shadow: 0 5px 15px rgba(233, 30, 99, 0.6);
       }
       
       .theme-teal { 
         border-color: #009688; 
         background: linear-gradient(135deg, #4db6ac, #009688, #00695c);
         box-shadow: 0 5px 15px rgba(0, 150, 136, 0.6);
       }
       
       .theme-violet { 
         border-color: #8b5cf6; 
         background: linear-gradient(135deg, #a78bfa, #8b5cf6, #7c3aed);
         box-shadow: 0 5px 15px rgba(139, 92, 246, 0.6);
       }
      
      /* Quality-based optimizations */
      
      /* Low quality - disable all animations */
      [data-quality-mode="low"] #screen-home .card {
        animation: none !important;
        transform-style: flat !important;
        perspective: none !important;
      }
      
      [data-quality-mode="low"] #screen-home .card .icon {
        animation: none !important;
        transform: none !important;
      }
      
      [data-quality-mode="low"] #screen-home .card .label {
        animation: none !important;
        transform: none !important;
        text-shadow: none !important;
      }
      
      [data-quality-mode="low"] .particle {
        animation: none !important;
      }
      
      [data-quality-mode="low"] .nebula {
        animation: none !important;
      }
      
      [data-quality-mode="low"] .galaxy-cluster {
        animation: none !important;
      }
      
      /* Low quality - simplify background */
      [data-quality-mode="low"] #screen-home::before {
        background: #1e0033 !important;
        animation: none !important;
      }
      
      /* Low quality - remove complex effects */
      [data-quality-mode="low"] #screen-home .card {
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;
      }
      
      [data-quality-mode="low"] #screen-home .card::before,
      [data-quality-mode="low"] #screen-home .card::after {
        display: none !important;
      }
      
      /* Medium quality - basic animations */
      [data-quality-mode="medium"] #screen-home .card {
        animation: float 4s ease-in-out infinite;
        transform-style: flat !important;
        perspective: none !important;
      }
      
      [data-quality-mode="medium"] #screen-home .card .icon {
        animation: pulse 3s infinite;
        transform: none !important;
      }
      
      [data-quality-mode="medium"] #screen-home .card .label {
        animation: pulse 2s infinite;
        transform: none !important;
      }
      
      /* Medium quality - simplified background */
      [data-quality-mode="medium"] #screen-home::before {
        background: linear-gradient(to bottom, #1e0033, #4b0063) !important;
        animation: cosmic-pulse 20s ease infinite alternate;
      }
      
      /* Predefined float animations for medium quality */
      @keyframes float-slow {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
      }
      
      @keyframes float-medium {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-8px); }
      }
      
      @keyframes float-fast {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-12px); }
      }
      
      /* Specific optimization for 5-inch RPi screens (typically 800x480) */
      @media (max-width: 850px) and (max-height: 500px) {
        .topbar {
          padding: 6px 10px;
        }
        
        .logo {
          height: 28px;
        }
        
        .title {
          font-size: 14px;
        }
        
        #screen-home {
          padding: 5px;
        }
        
        #screen-home .grid {
          grid-template-columns: repeat(4, 1fr);
          grid-template-rows: repeat(4, 1fr); /* Fixed 4 rows for 5-inch screen */
          gap: 4px;
          padding: 4px;
          height: calc(100vh - 80px); /* Account for smaller topbar */
          /* Ensure perfect square grid cells */
          grid-auto-rows: 1fr;
          align-items: stretch;
        }
        
        #screen-home .card {
          padding: 4px 2px;
          min-height: 65px;
          height: 100%; /* Force uniform height */
          border-radius: 6px;
          /* Ensure perfect uniformity on 5-inch screen */
          aspect-ratio: 1;
          width: 100%;
        }
        
        #screen-home .card .label {
          font-size: 9px;
          margin-top: 2px;
          line-height: 1;
        }
        
        #screen-home .card .icon {
          width: 24px;
          height: 24px;
          margin-bottom: 2px;
        }
        
        #screen-home .card .icon::before {
          font-size: 14px;
        }
      }

      /* Responsive design - optimized for 5-inch RPi screens */
      @media (max-width: 1024px) {
        .title {
          font-size: 18px;
        }
        
        #screen-home .grid {
          grid-template-columns: repeat(4, 1fr); /* Keep 4 columns */
          gap: clamp(6px, 1.5vw, 12px);
          max-width: 98vw;
          padding: 8px;
        }
        
        #screen-home .card {
          padding: 10px 6px;
          min-height: clamp(60px, 10vh, 90px);
          height: 100%; /* Force uniform height */
        }
        
        #screen-home .card .label {
          font-size: clamp(9px, 2vw, 14px);
        }
        
        #screen-home .card .icon {
          width: clamp(30px, 6vw, 40px);
          height: clamp(30px, 6vw, 40px);
        }
      }
      
      @media (max-width: 768px) {
        .topbar {
          padding: 10px 15px;
        }
        
        .title {
          font-size: 16px;
        }
        
        #screen-home .grid {
          grid-template-columns: repeat(4, 1fr); /* Keep 4 columns */
          gap: clamp(4px, 1vw, 8px);
          padding: 6px;
        }
        
        #screen-home .card {
          padding: 8px 4px;
          min-height: clamp(55px, 8vh, 80px);
          height: 100%; /* Force uniform height */
        }
        
        #screen-home .card .label {
          font-size: clamp(8px, 1.8vw, 12px);
          margin-top: 4px;
        }
        
        #screen-home .card .icon {
          width: clamp(25px, 5vw, 35px);
          height: clamp(25px, 5vw, 35px);
          margin-bottom: 4px;
        }
      }
      
      @media (max-width: 600px) {
        .topbar {
          padding: 8px 12px;
        }
        
        .logo {
          height: 32px;
        }
        
        .title {
          font-size: clamp(12px, 3vw, 15px);
        }
        
        #screen-home {
          padding: 8px 5px;
        }
        
        #screen-home .grid {
          grid-template-columns: repeat(4, 1fr); /* Keep 4 columns even on small screens */
          gap: 4px;
          padding: 4px;
          height: calc(100vh - 100px);
        }
        
        #screen-home .card {
          padding: 6px 3px;
          min-height: clamp(50px, 7vh, 70px);
          height: 100%; /* Force uniform height */
          border-width: 1px;
        }
        
        #screen-home .card .label {
          font-size: clamp(7px, 1.5vw, 10px);
          margin-top: 3px;
          line-height: 1.1;
        }
        
        #screen-home .card .icon {
          width: clamp(20px, 4vw, 28px);
          height: clamp(20px, 4vw, 28px);
          margin-bottom: 3px;
        }
        
        /* Simplify animations on small screens for better performance */
        #screen-home .card::before,
        #screen-home .card::after {
          animation: none;
        }
      }
      
      /* Ultra-small screens (480px and below) - might show 3 columns if needed */
      @media (max-width: 480px) {
        #screen-home .grid {
          grid-template-columns: repeat(3, 1fr); /* Switch to 3 columns for very small screens */
          grid-template-rows: repeat(5, 1fr); /* Adjust rows accordingly */
        }
      }
      
      /* Ensure portrait orientation on very small devices works well */
      @media (max-width: 380px) {
        #screen-home .grid {
          max-width: 99vw;
          padding: 2px;
          grid-template-columns: repeat(3, 1fr); /* 3 columns for minimal screens */
        }
        
        #screen-home .card {
          min-height: clamp(45px, 6vh, 60px);
          height: 100%; /* Force uniform height */
          padding: 4px 2px;
        }
      }
    </style>
    
    <!-- Mark CSS as loaded -->
    <script>
      // Notify that main CSS has been loaded and parsed
      if (window.markCSSLoaded) {
        window.markCSSLoaded();
      }
    </script>
    
    <!-- Quality-Based Animated Cosmic Background Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Quality-based particle system
        const qualityMode = window.QUALITY_MODE || 'medium';
        const particlesContainer = document.getElementById('particles');
        
        // Particle counts based on quality
        const particleConfigs = {
          low: {
            stars: 1,
            nebulae: 1,
            galaxies: 0,
            shootingStars: false,
            animations: false
          },
          medium: {
            stars: 20,
            nebulae: 2,
            galaxies: 1,
            shootingStars: true,
            animations: true
          },
          high: {
            stars: 40,
            nebulae: 5,
            galaxies: 3,
            shootingStars: true,
            animations: true
          }
        };
        
        const config = particleConfigs[qualityMode];
        
        console.log(`🌟 Creating ${config.stars} stars, ${config.nebulae} nebulae, ${config.galaxies} galaxies for ${qualityMode} quality mode`);
        
        // Create particles based on quality mode
        if (config.stars > 0) {
          for (let i = 0; i < config.stars; i++) {
            createStar(particlesContainer, qualityMode);
          }
        }
        
        if (config.nebulae > 0) {
          for (let i = 0; i < config.nebulae; i++) {
            createNebula(particlesContainer, qualityMode);
          }
        }
        
        if (config.galaxies > 0) {
          for (let i = 0; i < config.galaxies; i++) {
            createGalaxyCluster(particlesContainer, qualityMode);
          }
        }
        
        // Shooting stars only for medium/high quality
        if (config.shootingStars) {
          setInterval(() => {
            if (Math.random() > 0.7) { // 30% chance every interval
              createShootingStar(particlesContainer, qualityMode);
            }
          }, 8000); // Try to create a shooting star every 8 seconds
        }
        
        // Quality-based star creation
        function createStar(container, quality) {
          const particle = document.createElement('div');
          particle.classList.add('particle');
          
          // Simpler stars for low quality
          if (quality === 'low') {
            particle.style.width = '2px';
            particle.style.height = '2px';
            particle.style.background = 'rgba(255, 255, 255, 0.8)';
            particle.style.opacity = '0.6';
          } else {
            // Full star effects for medium/high
            let size;
            const isLargeStar = Math.random() > 0.9;
            
            if (isLargeStar) {
              size = Math.random() * 4 + 3; // 3-7px for bright stars
              particle.style.opacity = Math.random() * 0.4 + 0.6; // Brighter
            } else {
              size = Math.random() * 2 + 1; // 1-3px for regular stars
              particle.style.opacity = Math.random() * 0.3 + 0.3; // Regular brightness
            }
            
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
          }
          
          // Position
          const x = Math.random() * 100;
          const y = Math.random() * 100;
          particle.style.left = `${x}%`;
          particle.style.top = `${y}%`;
          
          // Animations only for medium/high quality
          if (quality !== 'low' && config.animations) {
            if (Math.random() > 0.7) {
              const twinkleDuration = Math.random() * 3 + 2; // 2-5s
              particle.style.animation = `twinkle ${twinkleDuration}s ease-in-out infinite`;
            }
            
            if (Math.random() > 0.6) {
              setRandomStarMovement(particle, quality);
            }
          }
          
          container.appendChild(particle);
        }
        
        // Quality-based nebula creation
        function createNebula(container, quality) {
          const nebula = document.createElement('div');
          nebula.classList.add('nebula');
          
          // Smaller, simpler nebulae for low quality
          let size;
          if (quality === 'low') {
            size = Math.random() * 50 + 50; // 50-100px
            nebula.style.filter = 'blur(20px)';
            nebula.style.opacity = '0.1';
          } else {
            size = Math.random() * 200 + 100; // 100-300px
            nebula.style.filter = 'blur(40px)';
            nebula.style.opacity = '0.15';
          }
          
          nebula.style.width = `${size}px`;
          nebula.style.height = `${size}px`;
          
          // Random position
          const x = Math.random() * 100;
          const y = Math.random() * 100;
          nebula.style.left = `${x}%`;
          nebula.style.top = `${y}%`;
          
          // Random color - purples and blues for cosmic effect
          const hue = Math.random() * 60 + 240; // 240-300 range (blues to purples)
          const saturation = Math.random() * 30 + 70; // 70-100%
          const lightness = Math.random() * 20 + 50; // 50-70%
          nebula.style.backgroundColor = `hsla(${hue}, ${saturation}%, ${lightness}%, 0.2)`;
          
          // Add to container
          container.appendChild(nebula);
          
          // Animations only for medium/high quality
          if (quality !== 'low') {
            const delay = Math.random() * 5;
            nebula.style.animationDelay = `${delay}s`;
          }
        }
        
        // Quality-based star movement
        function setRandomStarMovement(particle, quality) {
          // No movement for low quality
          if (quality === 'low') {
            return;
          }
          
          // Simplified movement for medium quality
          if (quality === 'medium') {
            const moveFactor = 20;
            const x1 = (Math.random() * moveFactor) - (moveFactor/2);
            const y1 = (Math.random() * moveFactor) - (moveFactor/2);
            
            // Use predefined animations instead of dynamic keyframes
            const animations = ['float-slow', 'float-medium', 'float-fast'];
            const animation = animations[Math.floor(Math.random() * animations.length)];
            const duration = Math.random() * 20 + 40; // 40-60s
            particle.style.animation = `${animation} ${duration}s ease-in-out infinite`;
            return;
          }
          
          // Full movement for high quality
          const moveFactor = 60;
          const x1 = (Math.random() * moveFactor) - (moveFactor/2);
          const y1 = (Math.random() * moveFactor) - (moveFactor/2);
          
          // COMMENTED OUT: Dynamic keyframe generation causing performance issues
          // Create a unique keyframe animation for each particle
          // const uniqueName = 'star-' + Math.floor(Math.random() * 1000000);
          
          // Create keyframe animation - slower and more subtle for stars
          // const keyframes = `
          //   @keyframes ${uniqueName} {
          //     0%, 100% { transform: translate(0, 0); }
          //     50% { transform: translate(${x1}px, ${y1}px); }
          //   }
          // `;
          
          // Add keyframes to document
          // const style = document.createElement('style');
          // style.innerHTML = keyframes;
          // document.head.appendChild(style);
          
          // Apply animation to particle - much longer for cosmic effect
          const duration = Math.random() * 40 + 60; // 60-100s
          const delay = Math.random() * 10;
          // particle.style.animation = `${uniqueName} ${duration}s ease-in-out ${delay}s infinite alternate`;
          
          // TEMPORARY FIX: Use simple CSS animation instead of dynamic keyframes
          particle.style.animation = `twinkle ${duration}s ease-in-out ${delay}s infinite alternate`;
        }
        
        // Create a galaxy cluster
        function createGalaxyCluster(container) {
          const galaxy = document.createElement('div');
          galaxy.classList.add('galaxy-cluster');
          
          // Random size between 80px and 200px
          const size = Math.random() * 120 + 80;
          galaxy.style.width = `${size}px`;
          galaxy.style.height = `${size}px`;
          
          // Random position
          const x = Math.random() * 90 + 5; // Keep away from edges
          const y = Math.random() * 90 + 5;
          galaxy.style.left = `${x}%`;
          galaxy.style.top = `${y}%`;
          
          // Random rotation
          const rotation = Math.random() * 360;
          galaxy.style.transform = `rotate(${rotation}deg)`;
          
          // Add to container
          container.appendChild(galaxy);
          
          // COMMENTED OUT: Dynamic keyframe generation causing performance issues
          // Add subtle animation
          // const uniqueName = 'galaxy-' + Math.floor(Math.random() * 1000000);
          // const keyframes = `
          //   @keyframes ${uniqueName} {
          //     0%, 100% { transform: rotate(${rotation}deg) scale(1); opacity: 0.3; }
          //     50% { transform: rotate(${rotation + 5}deg) scale(1.1); opacity: 0.4; }
          //   }
          // `;
          
          // const style = document.createElement('style');
          // style.innerHTML = keyframes;
          // document.head.appendChild(style);
          
          // Apply animation
          const duration = Math.random() * 20 + 30; // 30-50s
          // galaxy.style.animation = `${uniqueName} ${duration}s ease-in-out infinite alternate`;
          
          // TEMPORARY FIX: Use simple CSS animation instead of dynamic keyframes
          galaxy.style.animation = `twinkle ${duration}s ease-in-out infinite alternate`;
        }
        
        // Create a shooting star
        function createShootingStar(container) {
          const star = document.createElement('div');
          star.classList.add('particle');
          
          // Make it elongated
          star.style.width = '3px';
          star.style.height = '40px'; // Long trail
          star.style.borderRadius = '40%';
          star.style.opacity = '0';
          
          // Brighter than regular stars
          star.style.boxShadow = `
            0 0 10px rgba(255, 255, 255, 0.8),
            0 0 20px rgba(255, 255, 255, 0.6),
            0 0 30px rgba(255, 255, 255, 0.4)
          `;
          
          // Random starting position in top-right quadrant
          const x = Math.random() * 50 + 50; // 50-100%
          const y = Math.random() * 30; // 0-30%
          star.style.left = `${x}%`;
          star.style.top = `${y}%`;
          
          // Add to container
          container.appendChild(star);
          
          // Apply shooting star animation
          star.style.animation = 'shooting-star 4s ease-out forwards';
          
          // Remove after animation completes
          setTimeout(() => {
            if (star.parentNode) {
              star.parentNode.removeChild(star);
            }
          }, 4000);
        }
        
        // Add twinkling animation
        const twinkleKeyframes = `
          @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
          }
        `;
        const twinkleStyle = document.createElement('style');
        twinkleStyle.innerHTML = twinkleKeyframes;
        document.head.appendChild(twinkleStyle);
        
        // Manual quality override function for testing
        window.setQualityMode = function(mode) {
          if (!['low', 'medium', 'high'].includes(mode)) {
            console.error('Invalid quality mode. Use: low, medium, or high');
            return;
          }
          
          window.QUALITY_MODE = mode;
          document.body.setAttribute('data-quality-mode', mode);
          console.log(`🎮 Manual Quality Mode: ${mode.toUpperCase()}`);
          
          // Reload particles with new quality mode
          const particlesContainer = document.getElementById('particles');
          particlesContainer.innerHTML = '';
          
          // Recreate particles with new quality mode
          const config = particleConfigs[mode];
          
          if (config.stars > 0) {
            for (let i = 0; i < config.stars; i++) {
              createStar(particlesContainer, mode);
            }
          }
          
          if (config.nebulae > 0) {
            for (let i = 0; i < config.nebulae; i++) {
              createNebula(particlesContainer, mode);
            }
          }
          
          if (config.galaxies > 0) {
            for (let i = 0; i < config.galaxies; i++) {
              createGalaxyCluster(particlesContainer, mode);
            }
          }
          
          console.log(`🌟 Recreated ${config.stars} stars, ${config.nebulae} nebulae, ${config.galaxies} galaxies for ${mode} quality mode`);
        };
        
        console.log('🎮 Quality testing commands:');
        console.log('  setQualityMode("low")    - Pi 3B+ mode');
        console.log('  setQualityMode("medium") - Pi 4 mode');
        console.log('  setQualityMode("high")   - Pi 5 mode');
        
      });
      
      document.addEventListener('DOMContentLoaded', function() {
        // Dynamic button animations
        const cards = document.querySelectorAll('#screen-home .card');
        
        // Add interactive animations to each card
        cards.forEach((card, index) => {
          // Create dynamic glow effect on touch/click
          card.addEventListener('touchstart', function(e) {
            createRippleEffect(e, this);
            createGlowEffect(this);
            createParticleBurst(this);
          });
          
          card.addEventListener('click', function(e) {
            createRippleEffect(e, this);
            createGlowEffect(this);
            createParticleBurst(this);
          });
          
          // Add random movement to each card
          setRandomCardMovement(card, index);
          
          // Create card particles
          createCardParticles(card, index);
        });
        
        // Create ripple effect on button touch/click
        function createRippleEffect(e, element) {
          const ripple = document.createElement('div');
          ripple.className = 'ripple-effect';
          
          const rect = element.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          
          // Get touch/click position relative to element
          const x = e.type === 'touchstart' ? 
                  e.touches[0].clientX - rect.left : 
                  e.clientX - rect.left;
          const y = e.type === 'touchstart' ? 
                  e.touches[0].clientY - rect.top : 
                  e.clientY - rect.top;
          
          ripple.style.width = ripple.style.height = `${size * 2}px`;
          ripple.style.left = `${x - size}px`;
          ripple.style.top = `${y - size}px`;
          
          element.appendChild(ripple);
          
          // Remove ripple after animation completes
          setTimeout(() => {
            ripple.remove();
          }, 1000);
        }
        
        // Create glow effect on button
        function createGlowEffect(element) {
          // Add intense glow class
          element.classList.add('intense-glow');
          
          // Remove class after animation completes
          setTimeout(() => {
            element.classList.remove('intense-glow');
          }, 700);
        }
        
        // Set random subtle movement for cards
        function setRandomCardMovement(card, index) {
          // COMMENTED OUT: Dynamic keyframe generation causing performance issues
          // Create a unique animation for each card
          // const uniqueName = 'card-move-' + index;
          const rotateX = (Math.random() * 3) - 1.5; // -1.5 to 1.5 degrees
          const rotateY = (Math.random() * 3) - 1.5; // -1.5 to 1.5 degrees
          const translateZ = Math.random() * 10 + 5; // 5 to 15px
          
          // Create keyframe animation
          // const keyframes = `
          //   @keyframes ${uniqueName} {
          //     0%, 100% { transform: rotateX(0deg) rotateY(0deg) translateZ(0); }
          //     25% { transform: rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(${translateZ}px); }
          //     75% { transform: rotateX(${-rotateX}deg) rotateY(${-rotateY}deg) translateZ(${translateZ/2}px); }
          //   }
          // `;
          
          // Add keyframes to document
          // const style = document.createElement('style');
          // style.innerHTML = keyframes;
          // document.head.appendChild(style);
          
          // Apply animation to card
          const duration = Math.random() * 5 + 8; // 8-13 seconds
          const delay = Math.random() * 2; // 0-2 second delay
          // card.style.animation = `${card.style.animation}, ${uniqueName} ${duration}s ease-in-out ${delay}s infinite`;
          
          // TEMPORARY FIX: Use existing float animation instead of dynamic keyframes
          // Note: This removes the unique movement per card but maintains performance
        }
        
        // Create particles inside each card
        function createCardParticles(card, cardIndex) {
          const particlesContainer = card.querySelector('.card-particles');
          const numParticles = 8 + Math.floor(Math.random() * 5); // 8-12 particles per card
          
          // Create static floating particles
          for (let i = 0; i < numParticles; i++) {
            createCardParticle(particlesContainer, cardIndex, i);
          }
        }
        
        // Create a single card particle
        function createCardParticle(container, cardIndex, particleIndex) {
          const particle = document.createElement('div');
          particle.classList.add('card-particle');
          
          // Random size between 3px and 8px
          const size = Math.random() * 5 + 3;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          
          // Random position within the card
          const x = Math.random() * 80 + 10; // 10% to 90% of width
          const y = Math.random() * 80 + 10; // 10% to 90% of height
          particle.style.left = `${x}%`;
          particle.style.top = `${y}%`;
          
          // Random opacity
          particle.style.opacity = Math.random() * 0.4 + 0.2;
          
          // Add to container
          container.appendChild(particle);
          
          // Set animation
          setCardParticleAnimation(particle, cardIndex, particleIndex);
        }
        
        // Set animation for card particle
        function setCardParticleAnimation(particle, cardIndex, particleIndex) {
          const animations = ['pulse-particle', 'orbit'];
          const animIndex = (cardIndex + particleIndex) % animations.length;
          const animation = animations[animIndex];
          const duration = Math.random() * 4 + 3; // 3-7 seconds
          const delay = Math.random() * 2; // 0-2 second delay
          
          // Apply animation
          particle.style.animation = `${animation} ${duration}s ease-in-out ${delay}s infinite`;
        }
        
        // Create particle burst on click/touch
        function createParticleBurst(card) {
          const particlesContainer = card.querySelector('.card-particles');
          const numParticles = 15 + Math.floor(Math.random() * 10); // 15-25 particles
          
          // Create burst particles
          for (let i = 0; i < numParticles; i++) {
            createBurstParticle(particlesContainer);
          }
        }
        
        // Create a single burst particle
        function createBurstParticle(container) {
          const particle = document.createElement('div');
          particle.classList.add('card-particle');
          
          // Random size between 2px and 6px
          const size = Math.random() * 4 + 2;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          
          // Start from center of card
          particle.style.left = `${45 + Math.random() * 10}%`;
          particle.style.top = `${45 + Math.random() * 10}%`;
          
          // Add to container
          container.appendChild(particle);
          
          // Set burst animation
          const animations = ['float-up', 'float-diagonal'];
          const animation = animations[Math.floor(Math.random() * animations.length)];
          const duration = Math.random() * 1 + 1; // 1-2 seconds
          
          // Apply animation
          particle.style.animation = `${animation} ${duration}s ease-out forwards`;
          
          // Remove particle after animation completes
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, duration * 1000);
        }
      });
    </script>
    
    <style>
      /* Dynamic animation styles */
      .ripple-effect {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
        transform: scale(0);
        animation: ripple 1s linear;
        pointer-events: none;
        z-index: 1;
      }
      
      @keyframes ripple {
        to {
          transform: scale(1);
          opacity: 0;
        }
      }
      
      .intense-glow {
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 60px currentColor !important;
        z-index: 10;
        animation-play-state: paused !important;
        transform: scale(1.05) !important;
        transition: all 0.3s ease-out !important;
      }
      
      /* Card particles */
      .card-particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        border-radius: 15px;
        pointer-events: none;
        z-index: 1;
      }
      
      .card-particle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        opacity: 0.6;
        z-index: 1;
      }
      
      /* Theme-specific particle colors */
      .theme-cyan .card-particle { background: rgba(0, 229, 255, 0.8); }
      .theme-purple .card-particle { background: rgba(234, 128, 252, 0.8); }
      .theme-indigo .card-particle { background: rgba(121, 134, 203, 0.8); }
      .theme-gold .card-particle { background: rgba(255, 215, 64, 0.8); }
             .theme-white .card-particle { background: rgba(255, 255, 255, 0.8); }
       .theme-grey .card-particle { background: rgba(136, 136, 136, 0.8); }
      .theme-lime .card-particle { background: rgba(238, 255, 65, 0.8); }
      .theme-orange .card-particle { background: rgba(255, 158, 128, 0.8); }
      .theme-red .card-particle { background: rgba(255, 138, 128, 0.8); }
      .theme-blue .card-particle { background: rgba(130, 177, 255, 0.8); }
      .theme-silver .card-particle { background: rgba(224, 224, 224, 0.8); }
             .theme-green .card-particle { background: rgba(129, 199, 132, 0.8); }
       .theme-pink .card-particle { background: rgba(244, 143, 177, 0.8); }
       .theme-teal .card-particle { background: rgba(0, 150, 136, 0.8); }
       .theme-violet .card-particle { background: rgba(139, 92, 246, 0.8); }
      
      /* Particle animations */
      @keyframes float-up {
        0% { transform: translateY(100%) scale(0); }
        50% { opacity: 1; }
        100% { transform: translateY(-100%) scale(1); opacity: 0; }
      }
      
      @keyframes float-diagonal {
        0% { transform: translate(-50%, 50%) scale(0); }
        50% { opacity: 1; transform: translate(0%, 0%) scale(1); }
        100% { transform: translate(50%, -50%) scale(0.5); opacity: 0; }
      }
      
      @keyframes pulse-particle {
        0%, 100% { transform: scale(0.8); opacity: 0.6; }
        50% { transform: scale(1.2); opacity: 0.9; }
      }
      
      @keyframes orbit {
        0% { transform: rotate(0deg) translateX(10px) rotate(0deg); }
        100% { transform: rotate(360deg) translateX(10px) rotate(-360deg); }
      }
    </style>
    
    <!-- Emoji Detection and Fallback System -->
    <script>
      // Emoji detection and fallback system
      (function() {
        'use strict';
        
        // Test if emojis are supported and rendering properly
        function testEmojiSupport() {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = 20;
          canvas.height = 20;
          
          // Test with a simple emoji
          ctx.font = '16px Arial';
          ctx.fillText('😀', 0, 16);
          
          const imageData = ctx.getImageData(0, 0, 20, 20);
          const data = imageData.data;
          
          // Check if the emoji actually rendered (not just a placeholder)
          let hasColor = false;
          for (let i = 0; i < data.length; i += 4) {
            if (data[i] > 0 || data[i + 1] > 0 || data[i + 2] > 0) {
              hasColor = true;
              break;
            }
          }
          
          return hasColor;
        }
        
        // Fallback to text labels if emojis don't work
        function enableEmojiFallbacks() {
          const cards = document.querySelectorAll('#screen-home .card');
          cards.forEach(card => {
            const icon = card.querySelector('.icon');
            if (icon) {
              const textFallback = icon.getAttribute('data-text-fallback');
              if (textFallback) {
                icon.style.setProperty('--fallback-text', `"${textFallback}"`);
              }
            }
          });
          
          // Add CSS to show fallback text
          const style = document.createElement('style');
          style.textContent = `
            #screen-home .card .icon::before {
              content: var(--fallback-text, attr(data-text-fallback)) !important;
              font-family: Arial, sans-serif !important;
              font-size: 12px !important;
              font-weight: bold !important;
              color: #fff !important;
            }
          `;
          document.head.appendChild(style);
        }
        
        // Initialize emoji system when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initEmojiSystem);
        } else {
          initEmojiSystem();
        }
        
        function initEmojiSystem() {
          // Wait a bit for fonts to load
          setTimeout(() => {
            if (!testEmojiSupport()) {
              console.log('⚠️ Emoji support not detected, enabling fallbacks');
              enableEmojiFallbacks();
            } else {
              console.log('✅ Emoji support detected and working');
              // Add class to body to hide text fallbacks
              document.body.classList.add('emojis-working');
            }
          }, 1000);
          
          // Add manual emoji test function to window for debugging
          window.testEmojis = function() {
            const result = testEmojiSupport();
            console.log('Manual emoji test result:', result);
            if (result) {
              document.body.classList.add('emojis-working');
              alert('✅ Emojis are working! Text fallbacks hidden.');
            } else {
              document.body.classList.remove('emojis-working');
              alert('⚠️ Emojis not working. Text fallbacks enabled.');
            }
            return result;
          };
        }
      })();
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      // Only register service worker in production
      if ('serviceWorker' in navigator && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        window.addEventListener('load', async () => {
          try {
            const registration = await navigator.serviceWorker.register('/sw.js');
            console.log('✅ Service Worker registered:', registration);
            
            // Handle updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('🔄 Service Worker update found');
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('🆕 New service worker available');
                  // Auto-reload for updates
                  window.location.reload();
                }
              });
            });
            
            // Handle controller change
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              console.log('🎮 Service Worker controller changed');
              // Reload page to get fresh content
              window.location.reload();
            });
            
          } catch (error) {
            console.error('❌ Service Worker registration failed:', error);
          }
        });
      } else {
        console.log('🚫 Service Worker disabled in development mode');
      }
    </script>
  </body>
</html>


