<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Breakout Game</title>
  <link rel="stylesheet" href="../styles/base.css">
  <link rel="stylesheet" href="../styles/game.css">
  
  <style>
    /* Breakout Game Specific Styles */
    #screen-breakout {
      width: 100%;
      height: 100vh;
      background: #0b0c10;
      color: #eef2f7;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    
    #screen-breakout * {
      box-sizing: border-box;
      touch-action: manipulation;
      user-select: none;
    }
    
    /* Header */
    .breakout-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      background: #101218;
      border-bottom: 1px solid #1c2030;
    }
    
    .breakout-title {
      font-size: 16px;
      margin: 0;
      color: #e4e6f1;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .home-button {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e4e6f1;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    
    .home-button:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .home-button:active {
      transform: scale(0.95);
    }
    
    /* Game Container */
    .game-container {
      flex: 1;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: #0b0c10;
      gap: 15px;
    }
    
    /* Game Area */
    .game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    /* Side Panel */
    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-width: 120px;
      max-width: 150px;
    }
    
    /* Game Canvas */
    .game-canvas {
      border: 2px solid #22c55e;
      border-radius: 8px;
      background: #f8f8f8;
      box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3);
      max-width: 100%;
      max-height: 80vh;
      cursor: crosshair; /* Default cursor for desktop */
    }
    
    /* Hide cursor on touchscreen devices */
    @media (pointer: coarse) {
      .game-canvas {
        cursor: none;
      }
    }
    
    /* Show cursor on devices with precise pointer (mouse) */
    @media (pointer: fine) {
      .game-canvas {
        cursor: crosshair;
      }
    }
    
    /* Fallback for older browsers - hide cursor on small screens */
    @media (max-width: 768px) and (max-height: 1024px) {
      .game-canvas {
        cursor: none;
      }
    }
    
    /* Control Buttons */
    .control-button {
      width: 100%;
      height: 50px;
      border: 2px solid #22c55e;
      border-radius: 8px;
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .control-button:hover {
      background: rgba(34, 197, 94, 0.2);
      transform: translateY(-2px);
    }
    
    .control-button:active {
      transform: translateY(0);
    }
    
    /* Direction Buttons */
    .direction-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .direction-button {
      width: 100%;
      height: 45px;
      border: 2px solid #22c55e;
      border-radius: 8px;
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .direction-button:hover {
      background: rgba(34, 197, 94, 0.2);
      transform: scale(1.05);
    }
    
    .direction-button:active {
      transform: scale(0.95);
    }
    
    /* Game Info */
    .game-info {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      font-size: 12px;
      color: #cfd6e6;
    }
    
    .game-info h4 {
      color: #22c55e;
      margin: 0 0 8px 0;
      font-size: 14px;
    }
    
    .game-info p {
      margin: 4px 0;
      font-size: 11px;
    }
    
    /* Game Info */
    .game-info {
      margin-top: 20px;
      text-align: center;
      color: #aab2c5;
      font-size: 14px;
      max-width: 400px;
    }
    
    .game-instructions {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .game-instructions h3 {
      color: #22c55e;
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    
    .game-instructions ul {
      margin: 0;
      padding-left: 20px;
      text-align: left;
    }
    
    .game-instructions li {
      margin: 5px 0;
      color: #cfd6e6;
    }
    
    /* Start Message */
    .start-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: #22c55e;
      padding: 20px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      border: 2px solid #22c55e;
      z-index: 10;
    }
    
    /* Game Over Screen */
    .game-over {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    
    .game-over h2 {
      color: #e24c4c;
      font-size: 32px;
      margin: 0 0 20px 0;
    }
    
    .game-over .score {
      color: #22c55e;
      font-size: 24px;
      margin-bottom: 30px;
    }
    
    .restart-button {
      background: #22c55e;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .restart-button:hover {
      background: #16a34a;
      transform: translateY(-2px);
    }
    
    .restart-button:active {
      transform: translateY(0);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .game-container {
        padding: 10px;
      }
      
      .game-canvas {
        max-width: 100%;
        max-height: 60vh;
      }
      
      .game-info {
        font-size: 12px;
      }
      
      .game-instructions {
        padding: 10px;
      }
      
      .game-instructions h3 {
        font-size: 14px;
      }
    }
    
    @media (max-height: 600px) {
      .game-container {
        padding: 5px;
      }
      
      .game-info {
        margin-top: 10px;
      }
      
      .game-instructions {
        margin-top: 10px;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <section id="screen-breakout" class="screen" aria-label="Breakout Game">
    <header class="breakout-header">
      <h1 class="breakout-title">Breakout Game</h1>
      <div class="header-right">
        <button id="btnHome" class="home-button" aria-label="Home">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </button>
      </div>
    </header>
    
    <main class="game-container">
      <div class="game-area">
        <canvas id="gameCanvas" class="game-canvas" width="600" height="500"></canvas>
      </div>
      
      <div class="side-panel">
        <!-- Direction Controls -->
        <div class="direction-buttons">
          <button id="btnLeft" class="direction-button">‚Üê</button>
          <button id="btnRight" class="direction-button">‚Üí</button>
        </div>
        
        <!-- Launch Button -->
        <button id="btnLaunch" class="control-button">
          üöÄ Launch Ball
        </button>
        
        <!-- Game Info -->
        <div class="game-info">
          <h4>How to Play</h4>
          <p><strong>Goal:</strong> Break all bricks</p>
          <p><strong>Controls:</strong> Move paddle left/right</p>
          <p><strong>Launch:</strong> Press space or button</p>
          <p><strong>Colors:</strong> Different point values</p>
        </div>
        
        <!-- Home Button -->
        <button id="btnHomeSide" class="control-button">
          üè† Home
        </button>
      </div>
    </main>
      
      <!-- Start Message -->
      <div id="startMessage" class="start-message">
        Press SPACE to Start
      </div>
      
      <!-- Game Over Screen -->
      <div id="gameOverScreen" class="game-over" style="display: none;">
        <h2>Game Over</h2>
        <div class="score">Score: <span id="finalScore">0</span></div>
        <button id="restartButton" class="restart-button">Play Again</button>
      </div>
    </main>
  </section>

  <script>
    (function() {
      'use strict';
      
      const root = document.getElementById('screen-breakout');
      const canvas = document.getElementById('gameCanvas');
      const context = canvas.getContext('2d');
      const startMessage = document.getElementById('startMessage');
      const gameOverScreen = document.getElementById('gameOverScreen');
      const finalScore = document.getElementById('finalScore');
      const restartButton = document.getElementById('restartButton');
      
      // Game state
      let gameStarted = false;
      let gameOver = false;
      let score = 0;
      
      // Level configuration
      const level1 = [
        [],
        [],
        [],
        [],
        [],
        [],
        ['R','R','R','R','R','R','R','R','R','R','R','R','R','R','R','R'],
        ['R','R','R','R','R','R','R','R','R','R','R','R','R','R','R','R'],
        ['O','O','O','O','O','O','O','O','O','O','O','O','O','O','O','O'],
        ['O','O','O','O','O','O','O','O','O','O','O','O','O','O','O','O'],
        ['G','G','G','G','G','G','G','G','G','G','G','G','G','G','G','G'],
        ['G','G','G','G','G','G','G','G','G','G','G','G','G','G','G','G'],
        ['Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y'],
        ['Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y']
      ];
      
      // Color mapping
      const colorMap = {
        'R': 'red',
        'O': 'orange', 
        'G': 'green',
        'Y': 'yellow'
      };
      
      // Game constants
      const brickGap = 2;
      const brickWidth = 35;
      const brickHeight = 16;
      const wallSize = 12;
      
      // Game objects
      let bricks = [];
      let paddle = {
        x: canvas.width / 2 - brickWidth / 2,
        y: 440,
        width: brickWidth,
        height: brickHeight,
        dx: 0
      };
      
      let ball = {
        x: 130,
        y: 260,
        width: 8,
        height: 8,
        color: 'black',
        speed: 2,
        dx: 0,
        dy: 0
      };
      
      // Initialize game
      function initGame() {
        // Create bricks
        bricks = [];
        for (let row = 0; row < level1.length; row++) {
          for (let col = 0; col < level1[row].length; col++) {
            const colorCode = level1[row][col];
            if (colorCode) {
              bricks.push({
                x: wallSize + (brickWidth + brickGap) * col,
                y: wallSize + (brickHeight + brickGap) * row,
                color: colorMap[colorCode],
                width: brickWidth,
                height: brickHeight
              });
            }
          }
        }
        
        // Reset game state
        score = 0;
        gameStarted = false;
        gameOver = false;
        
        // Reset paddle and ball
        paddle.x = canvas.width / 2 - brickWidth / 2;
        ball.x = 130;
        ball.y = 260;
        ball.dx = 0;
        ball.dy = 0;
        
        // Hide start message - game starts automatically
        startMessage.style.display = 'none';
        gameOverScreen.style.display = 'none';
      }
      
      // Collision detection
      function collides(obj1, obj2) {
        return obj1.x < obj2.x + obj2.width &&
               obj1.x + obj1.width > obj2.x &&
               obj1.y < obj2.y + obj2.height &&
               obj1.y + obj1.height > obj2.y;
      }
      
      // Game loop
      function gameLoop() {
        if (gameOver) return;
        
        requestAnimationFrame(gameLoop);
        context.clearRect(0, 0, canvas.width, canvas.height);
        
        // Move paddle
        paddle.x += paddle.dx;
        
        // Prevent paddle from going through walls
        if (paddle.x < wallSize) {
          paddle.x = wallSize;
        } else if (paddle.x + brickWidth > canvas.width - wallSize) {
          paddle.x = canvas.width - wallSize - brickWidth;
        }
        
        // Move ball
        ball.x += ball.dx;
        ball.y += ball.dy;
        
        // Ball wall collision
        if (ball.x < wallSize) {
          ball.x = wallSize;
          ball.dx *= -1;
        } else if (ball.x + ball.width > canvas.width - wallSize) {
          ball.x = canvas.width - wallSize - ball.width;
          ball.dx *= -1;
        }
        
        if (ball.y < wallSize) {
          ball.y = wallSize;
          ball.dy *= -1;
        }
        
        // Ball falls below screen
        if (ball.y > canvas.height) {
          endGame();
          return;
        }
        
        // Ball-paddle collision
        if (collides(ball, paddle)) {
          ball.dy *= -1;
          ball.y = paddle.y - ball.height;
        }
        
        // Ball-brick collision
        for (let i = 0; i < bricks.length; i++) {
          const brick = bricks[i];
          
          if (collides(ball, brick)) {
            bricks.splice(i, 1);
            score++;
            
            // Determine collision side and change velocity
            if (ball.y + ball.height - ball.speed <= brick.y ||
                ball.y >= brick.y + brick.height - ball.speed) {
              ball.dy *= -1;
            } else {
              ball.dx *= -1;
            }
            break;
          }
        }
        
        // Check win condition
        if (bricks.length === 0) {
          endGame(true);
          return;
        }
        
        // Draw everything
        drawGame();
      }
      
      // Draw game elements
      function drawGame() {
        // Draw walls
        context.fillStyle = 'lightgrey';
        context.fillRect(0, 0, canvas.width, wallSize);
        context.fillRect(0, 0, wallSize, canvas.height);
        context.fillRect(canvas.width - wallSize, 0, wallSize, canvas.height);
        
        // Draw ball if moving
        if (ball.dx || ball.dy) {
          context.fillStyle = ball.color;
          context.fillRect(ball.x, ball.y, ball.width, ball.height);
        }
        
        // Draw bricks
        bricks.forEach(function(brick) {
          context.fillStyle = brick.color;
          context.fillRect(brick.x, brick.y, brick.width, brick.height);
        });
        
        // Draw paddle
        context.fillStyle = 'cyan';
        context.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
        
        // Draw score
        context.fillStyle = '#22c55e';
        context.font = '16px Arial';
        context.fillText(`Score: ${score}`, 10, 30);
      }
      
      // End game
      function endGame(won = false) {
        gameOver = true;
        finalScore.textContent = score;
        gameOverScreen.style.display = 'flex';
        
        if (won) {
          document.querySelector('.game-over h2').textContent = 'You Win!';
          document.querySelector('.game-over h2').style.color = '#22c55e';
        } else {
          document.querySelector('.game-over h2').textContent = 'Game Over';
          document.querySelector('.game-over h2').style.color = '#e24c4c';
        }
      }
      
      // Start game
      function startGame() {
        if (gameStarted) return;
        
        gameStarted = true;
        ball.dx = ball.speed;
        ball.dy = ball.speed;
        gameLoop();
      }
      
      // Event listeners
      function handleKeyDown(e) {
        if (gameOver) return;
        
        // Arrow keys for paddle movement
        if (e.which === 37) { // Left arrow
          paddle.dx = -3;
        } else if (e.which === 39) { // Right arrow
          paddle.dx = 3;
        }
        
        // Space to start/launch ball
        if (e.which === 32) {
          if (!gameStarted) {
            startGame();
          }
        }
      }
      
      function handleKeyUp(e) {
        if (e.which === 37 || e.which === 39) {
          paddle.dx = 0;
        }
      }
      
      // Touch/mouse controls for mobile
      function handleMouseMove(e) {
        if (gameOver || !gameStarted) return;
        
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        
        // Move paddle to mouse position
        paddle.x = mouseX - paddle.width / 2;
        
        // Keep paddle within bounds
        if (paddle.x < wallSize) {
          paddle.x = wallSize;
        } else if (paddle.x + paddle.width > canvas.width - wallSize) {
          paddle.x = canvas.width - wallSize - paddle.width;
        }
      }
      
      // Event listeners
      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', handleKeyUp);
      canvas.addEventListener('mousemove', handleMouseMove);
      canvas.addEventListener('touchmove', function(e) {
        e.preventDefault();
        const touch = e.touches[0];
        handleMouseMove(touch);
      });
      
      // Restart button
      restartButton.addEventListener('click', function() {
        initGame();
        startGame();
        gameLoop();
      });
      
             // Side panel controls
       document.getElementById('btnLeft').addEventListener('click', function() {
         if (!gameOver) {
           paddle.dx = -3;
         }
       });
       
       document.getElementById('btnRight').addEventListener('click', function() {
         if (!gameOver) {
           paddle.dx = 3;
         }
       });
       
       document.getElementById('btnLaunch').addEventListener('click', function() {
         if (!gameStarted && !gameOver) {
           startGame();
         }
       });
       
       // Home buttons
       document.getElementById('btnHome').addEventListener('click', function() {
         window.location.href = '../index.html';
       });
       
       document.getElementById('btnHomeSide').addEventListener('click', function() {
         window.location.href = '../index.html';
       });
      
      // Initialize game
      initGame();
      // Start game automatically
      startGame();
      gameLoop();
      
    })();
  </script>
</body>
</html>
