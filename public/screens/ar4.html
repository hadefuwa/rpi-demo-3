<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>3D Classroom - AR Ready</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; height:100%; background:#0b0d10; overflow:hidden; }
    #info { position:absolute; top:8px; left:8px; right:8px; z-index:10;
      font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#e8eef5; background:rgba(0,0,0,0.35); padding:10px 12px; border-radius:8px;
      backdrop-filter:blur(6px);
    }
    #info small{opacity:.8}
    canvas{display:block}
    button{font:inherit; padding:6px 10px; border-radius:8px; border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.06); color:#e8eef5; cursor:pointer; margin-right:6px;
    }
    button:hover{background:rgba(255,255,255,.12)}
  </style>
</head>
<body>
  <div id="info">
    <strong>3D Classroom</strong> Â· Drag to orbit, scroll to zoom. Use AR button on supported devices.
    <div style="margin-top:6px;">
      <button id="toggleWire">Toggle wireframe</button>
      <button id="toggleShadows">Toggle shadows</button>
      <small>Serve with a local server. For AR use HTTPS on a compatible device.</small>
    </div>
  </div>

  <script type="module">
    // Use absolute URLs. Do not change these to "three".
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
    import { ARButton } from 'https://unpkg.com/three@0.160.0/examples/jsm/webxr/ARButton.js';

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Scene and camera
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b0d10);
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 200);
    camera.position.set(12, 9, 16);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 2.5, 0);
    controls.enableDamping = true;

    // Lights
    const hemi = new THREE.HemisphereLight(0xffffff, 0x223355, 0.7);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(10, 15, 6);
    dir.castShadow = true;
    dir.shadow.mapSize.set(2048, 2048);
    dir.shadow.camera.near = 0.5;
    dir.shadow.camera.far = 60;
    scene.add(dir);

    // Materials
    const materials = {
      floor: new THREE.MeshStandardMaterial({ color: 0x3c434d, roughness: 0.9, metalness: 0.0 }),
      wall:  new THREE.MeshStandardMaterial({ color: 0xe7ebf0, roughness: 1.0 }),
      wood:  new THREE.MeshStandardMaterial({ color: 0x9a6a3a, roughness: 0.7 }),
      metal: new THREE.MeshStandardMaterial({ color: 0x8ea1b5, metalness: 0.6, roughness: 0.3 }),
      board: new THREE.MeshStandardMaterial({ color: 0x0b1f2a, roughness: 0.9 }),
      glass: new THREE.MeshPhysicalMaterial({ color: 0xaed1ff, roughness: 0.1, transmission: 0.8, thickness: 0.2, transparent: true }),
      plastic: new THREE.MeshStandardMaterial({ color: 0x3a8ad8, roughness: 0.6 })
    };

    // Classroom
    const classroom = new THREE.Group();
    scene.add(classroom);

    // Floor
    const floor = new THREE.Mesh(new THREE.BoxGeometry(20, 0.2, 14), materials.floor);
    floor.receiveShadow = true;
    classroom.add(floor);
    const grid = new THREE.GridHelper(20, 20, 0x556270, 0x2a323c);
    grid.position.y = 0.101;
    classroom.add(grid);

    // Walls
    const wallThickness = 0.2, roomH = 6, roomW = 20, roomD = 14;
    function wall(w, h, d, x, y, z, mat = materials.wall) {
      const m = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), mat);
      m.position.set(x, y, z);
      m.castShadow = true; m.receiveShadow = true;
      classroom.add(m);
      return m;
    }
    wall(roomW, roomH, wallThickness, 0, roomH/2, -roomD/2); // back
    wall(roomW, roomH, wallThickness, 0, roomH/2,  roomD/2);  // front edge
    wall(wallThickness, roomH, roomD, -roomW/2, roomH/2, 0);  // left
    wall(wallThickness, roomH, roomD,  roomW/2, roomH/2, 0);  // right
    const ceiling = new THREE.Mesh(new THREE.BoxGeometry(roomW, 0.2, roomD), new THREE.MeshStandardMaterial({ color: 0xf2f4f7, roughness: 1 }));
    ceiling.position.set(0, roomH, 0);
    ceiling.receiveShadow = true;
    classroom.add(ceiling);

    // Window
    const windowFrame = new THREE.Mesh(new THREE.BoxGeometry(0.22, 2.2, 4.5), materials.metal);
    windowFrame.position.set(-roomW/2 + 0.11, 3, -2);
    classroom.add(windowFrame);
    const windowPane = new THREE.Mesh(new THREE.BoxGeometry(0.05, 2.0, 4.2), materials.glass);

    windowPane.position.set(-roomW/2 + 0.05, 3, -2);
    classroom.add(windowPane);

    // Door
    const door = new THREE.Mesh(new THREE.BoxGeometry(0.2, 2.3, 1.0), materials.wood);
    door.position.set(roomW/2 - 0.1, 1.15, 2.5);
    classroom.add(door);
    const handle = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.03, 0.2, 16), materials.metal);
    handle.rotation.z = Math.PI / 2;
    handle.position.set(roomW/2 - 0.02, 1.1, 2.1);
    classroom.add(handle);

    // Whiteboard
    const boardOuter = new THREE.Mesh(new THREE.BoxGeometry(0.08, 1.5, 3.5), materials.metal);
    boardOuter.position.set(0, 3.0, -roomD/2 + 0.08);
    classroom.add(boardOuter);
    const boardInner = new THREE.Mesh(new THREE.BoxGeometry(0.02, 1.3, 3.3), materials.board);
    boardInner.position.set(0.03, 3.0, -roomD/2 + 0.06);
    classroom.add(boardInner);

    // Teacher desk
    const teacherDesk = new THREE.Group();
    const deskTop = new THREE.Mesh(new THREE.BoxGeometry(2.6, 0.15, 1.2), materials.wood);
    deskTop.castShadow = deskTop.receiveShadow = true;
    deskTop.position.y = 1;
    teacherDesk.add(deskTop);
    for (let i = 0; i < 4; i++) {
      const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 1, 12), materials.metal);
      leg.castShadow = true; leg.receiveShadow = true;
      leg.position.set((i < 2 ? -1.15 : 1.15), 0.5, (i % 2 === 0 ? -0.45 : 0.45));
      teacherDesk.add(leg);
    }
    teacherDesk.position.set(0, 0, -4.5);
    classroom.add(teacherDesk);

    // Student desks and chairs
    const desks = new THREE.Group();
    classroom.add(desks);
    function makeDeskChair() {
      const g = new THREE.Group();
      const top = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.1, 0.7), materials.wood);
      top.castShadow = top.receiveShadow = true;
      top.position.y = 0.8;
      g.add(top);
      for (let i = 0; i < 4; i++) {
        const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.035, 0.035, 0.8, 12), materials.metal);
        leg.castShadow = leg.receiveShadow = true;
        leg.position.set((i < 2 ? -0.52 : 0.52), 0.4, (i % 2 === 0 ? -0.28 : 0.28));
        g.add(leg);
      }
      const seat = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.08, 0.5), materials.plastic);
      seat.position.set(0, 0.5, -0.6);
      seat.castShadow = seat.receiveShadow = true;
      g.add(seat);
      const back = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.45, 0.06), materials.plastic);
      back.position.set(0, 0.8, -0.86);
      back.castShadow = back.receiveShadow = true;
      g.add(back);
      return g;
    }
    const rows = 3, cols = 4, spacingX = 4.0, spacingZ = 3.2;
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const dc = makeDeskChair();
        dc.position.set(-((cols - 1) * spacingX) / 2 + c * spacingX, 0, -1 + r * spacingZ);
        desks.add(dc);
      }
    }

    // Fan
    const fan = new THREE.Group();
    const fanHub = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 0.2, 16), materials.metal);
    fanHub.rotation.x = Math.PI / 2;
    fan.add(fanHub);
    for (let i = 0; i < 3; i++) {
      const blade = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.02, 2.2), new THREE.MeshStandardMaterial({ color: 0xcccccc, roughness: 0.6 }));
      blade.position.z = 1.1;
      const holder = new THREE.Group();
      holder.rotation.y = (i * Math.PI * 2) / 3;
      holder.add(blade);
      fan.add(holder);
    }
    fan.position.set(0, roomH - 0.6, 0);
    fan.castShadow = true;
    classroom.add(fan);

    [floor, ceiling, boardInner, boardOuter].forEach(m => m.receiveShadow = true);

    // UI toggles
    let wireframe = false;
    let shadowsOn = true;
    document.getElementById('toggleWire').onclick = () => {
      wireframe = !wireframe;
      scene.traverse(o => {
        if (o.isMesh && o.material) {
          const mats = Array.isArray(o.material) ? o.material : [o.material];
          mats.forEach(m => { if ('wireframe' in m) m.wireframe = wireframe; });
        }
      });
    };
    document.getElementById('toggleShadows').onclick = () => {
      shadowsOn = !shadowsOn;
      renderer.shadowMap.enabled = shadowsOn;
    };

    // AR
    renderer.xr.enabled = true;
    const arBtn = ARButton.createButton(renderer, {
      requiredFeatures: [],
      optionalFeatures: ['dom-overlay'],
      domOverlay: { root: document.body }
    });
    document.body.appendChild(arBtn);

    renderer.xr.addEventListener('sessionstart', () => {
      scene.background = null;
      classroom.scale.setScalar(0.05);
      classroom.position.set(0, -0.2, -0.6);
    });
    renderer.xr.addEventListener('sessionend', () => {
      scene.background = new THREE.Color(0x0b0d10);
      classroom.scale.setScalar(1);
      classroom.position.set(0, 0, 0);
    });

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Animate
    const clock = new THREE.Clock();
    renderer.setAnimationLoop(() => {
      const t = clock.getElapsedTime();
      controls.update();
      fan.rotation.y = t * 2.5;
      renderer.render(scene, camera);
    });
  </script>
</body>
</html>
