<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RPI Camera Showcase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .camera-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .camera-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
        }
        
        /* Touch-friendly improvements */
        .btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
            touch-action: manipulation; /* Improves touch responsiveness */
            user-select: none; /* Prevents text selection on touch */
        }

        .camera-feed {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-placeholder {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .camera-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .camera-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #00d4ff;
            font-size: 1.2rem;
        }

        .btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.record {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .btn.record:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn.record.recording {
            background: linear-gradient(45deg, #ff0000, #cc0000);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .slider {
            width: 100%;
            height: 8px; /* Increased for better touch interaction */
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none; /* Added standard property */
            touch-action: manipulation; /* Improves touch responsiveness */
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none; /* Added standard property */
            width: 24px; /* Increased for better touch */
            height: 24px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 24px; /* Increased for better touch */
            height: 24px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .value-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            margin-top: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .effect-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 10px; /* Increased padding for better touch */
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            touch-action: manipulation; /* Improves touch responsiveness */
            user-select: none; /* Prevents text selection on touch */
            min-height: 44px; /* Minimum touch target size */
        }

        .effect-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .effect-btn.active {
            background: #00d4ff;
            border-color: #00d4ff;
        }

        .gallery-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .gallery-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .gallery-item-info {
            padding: 15px;
        }

        .gallery-item-info h4 {
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .gallery-item-info p {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .gallery-actions {
            display: flex;
            gap: 8px;
        }

        .gallery-actions .btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            min-width: auto;
        }

        .status-indicator {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .status-label {
            font-weight: 500;
        }

        .status-value {
            opacity: 0.8;
            font-family: monospace;
        }

        .camera-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .camera-info h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 500;
            font-family: monospace;
        }

        .recording-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
            animation: pulse 1s infinite;
        }

        .recording-indicator.active {
            display: block;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .overlay-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            opacity: 0.3;
        }

        .overlay-grid.active {
            opacity: 0.6;
        }

        .grid-line {
            background: rgba(255, 255, 255, 0.5);
        }

        .grid-line.vertical {
            width: 1px;
            height: 100%;
            margin: 0 auto;
        }

        .grid-line.horizontal {
            height: 1px;
            width: 100%;
            margin: auto 0;
        }

        .focus-indicator {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 2px solid #00d4ff;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .focus-indicator.active {
            opacity: 1;
            animation: focus-pulse 2s infinite;
        }

        @keyframes focus-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        /* Raspberry Pi 5-inch screen optimizations */
        @media (max-width: 800px) {
            .camera-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 5px;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .back-btn {
                top: 10px;
                left: 10px;
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .main-container {
                padding: 10px;
            }
            
            .camera-section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .camera-feed {
                min-height: 250px;
                margin-bottom: 15px;
            }
            
            .camera-controls {
                gap: 15px;
            }
            
            .control-group {
                padding: 15px;
            }
            
            .control-group h3 {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
                margin: 3px;
                min-width: 100px;
            }
            
            .effects-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 8px;
            }
            
            .effect-btn {
                padding: 8px;
                font-size: 0.8rem;
            }
            
            .slider-container {
                margin: 10px 0;
            }
            
            .slider-container label {
                font-size: 0.8rem;
            }
            
            .value-display {
                font-size: 0.8rem;
                padding: 6px 10px;
            }
            
            .info-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .info-item {
                padding: 10px;
            }
            
            .info-label {
                font-size: 0.7rem;
            }
            
            .info-value {
                font-size: 0.9rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .gallery-item img {
                height: 100px;
            }
            
            .gallery-item-info {
                padding: 10px;
            }
            
            .gallery-item-info h4 {
                font-size: 0.9rem;
                margin-bottom: 5px;
            }
            
            .gallery-item-info p {
                font-size: 0.7rem;
            }
            
            .gallery-actions .btn {
                padding: 4px 8px;
                font-size: 0.7rem;
            }
            
            .status-indicator {
                padding: 10px;
                margin-top: 15px;
            }
            
            .status-item {
                margin-bottom: 8px;
                padding: 6px 0;
                font-size: 0.9rem;
            }
            
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                transform: translateY(-100px);
                max-width: none;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }
        
        /* Extra small screens (480px and below) - Raspberry Pi specific */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.8rem;
            }
            
            .camera-feed {
                min-height: 200px;
            }
            
            .camera-grid {
                gap: 10px;
            }
            
            .camera-section {
                padding: 10px;
            }
            
            .control-group {
                padding: 10px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.8rem;
                min-width: 80px;
            }
            
            .effects-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
            
            .effect-btn {
                padding: 6px;
                font-size: 0.7rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .gallery-item img {
                height: 80px;
            }
            
            .info-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .camera-placeholder {
                padding: 20px;
            }
            
            .camera-placeholder i {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }
            
            .focus-indicator {
                width: 40px;
                height: 40px;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #00d4ff;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: #4caf50;
        }

        .notification.error {
            border-left-color: #f44336;
        }

        .notification.warning {
            border-left-color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back-btn">← Back</a>
        <h1>📸 Camera Showcase</h1>
        <p>Explore the Raspberry Pi's advanced camera capabilities</p>
    </div>

    <div class="main-container">
        <div class="camera-section">
            <div class="camera-grid">
                <div class="camera-feed">
                    <div class="camera-placeholder">
                        <div style="font-size: 4rem; margin-bottom: 20px;">📷</div>
                        <h3>Camera Feed</h3>
                        <p>Starting camera automatically...</p>
                        <div class="loading-spinner" style="margin-top: 20px;"></div>
                    </div>
                    <video id="camera-video" autoplay muted style="display: none; width: 100%; height: 100%; object-fit: cover;"></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                    
                    <div class="camera-overlay">
                        <div class="overlay-grid" id="overlay-grid">
                            <div class="grid-line vertical" style="grid-column: 2;"></div>
                            <div class="grid-line horizontal" style="grid-row: 2;"></div>
                        </div>
                        <div class="focus-indicator" id="focus-indicator"></div>
                    </div>
                    
                    <div class="recording-indicator" id="recording-indicator">
                        🔴 REC
                    </div>
                </div>

                <div class="camera-controls">
                    <div class="control-group">
                        <h3>🎮 Camera Controls</h3>
                        <button class="btn" id="restart-camera">🔄 Restart Camera</button>
                        <button class="btn" id="stop-camera">Stop Camera</button>
                        <button class="btn" id="capture-photo">📸 Capture Photo</button>
                        <button class="btn record" id="start-recording">🎥 Start Recording</button>
                        <button class="btn" id="switch-camera" style="display: none;">Switch Camera</button>
                    </div>

                    <div class="control-group">
                        <h3>⚙️ Camera Settings</h3>
                        
                        <div class="slider-container">
                            <label for="brightness">Brightness</label>
                            <input type="range" class="slider" id="brightness" min="0" max="200" value="100">
                            <div class="value-display" id="brightness-value">100%</div>
                        </div>

                        <div class="slider-container">
                            <label for="contrast">Contrast</label>
                            <input type="range" class="slider" id="contrast" min="0" max="200" value="100">
                            <div class="value-display" id="contrast-value">100%</div>
                        </div>

                        <div class="slider-container">
                            <label for="saturation">Saturation</label>
                            <input type="range" class="slider" id="saturation" min="0" max="200" value="100">
                            <div class="value-display" id="saturation-value">100%</div>
                        </div>

                        <div class="slider-container">
                            <label for="sharpness">Sharpness</label>
                            <input type="range" class="slider" id="sharpness" min="-100" max="100" value="0">
                            <div class="value-display" id="sharpness-value">0</div>
                        </div>

                        <div class="slider-container">
                            <label for="zoom">Zoom</label>
                            <input type="range" class="slider" id="zoom" min="100" max="300" value="100">
                            <div class="value-display" id="zoom-value">100%</div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>🎨 Camera Effects</h3>
                        <div class="effects-grid">
                            <button class="effect-btn" data-effect="none">Normal</button>
                            <button class="effect-btn" data-effect="grayscale">Grayscale</button>
                            <button class="effect-btn" data-effect="sepia">Sepia</button>
                            <button class="effect-btn" data-effect="invert">Invert</button>
                            <button class="effect-btn" data-effect="blur">Blur</button>
                            <button class="effect-btn" data-effect="brightness">Bright</button>
                            <button class="effect-btn" data-effect="contrast">High Contrast</button>
                            <button class="effect-btn" data-effect="saturation">Vibrant</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>🔧 Advanced Features</h3>
                        <button class="btn" id="toggle-grid">Toggle Grid</button>
                        <button class="btn" id="auto-focus">Auto Focus</button>
                        <button class="btn" id="face-detection">Face Detection</button>
                        <button class="btn" id="motion-detection">Motion Detection</button>
                        <button class="btn" id="night-mode">Night Mode</button>
                    </div>
                </div>
            </div>

            <div class="camera-info">
                <h3>📊 Camera Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Resolution</div>
                        <div class="info-value" id="resolution">Unknown</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Frame Rate</div>
                        <div class="info-value" id="framerate">Unknown</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Camera Type</div>
                        <div class="info-value" id="camera-type">Unknown</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value" id="camera-status">Stopped</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="gallery-section">
            <h2>🖼️ Photo Gallery</h2>
            <div class="gallery-grid" id="gallery-grid">
                <div class="gallery-item">
                    <div style="background: linear-gradient(45deg, #667eea, #764ba2); height: 150px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">📷</div>
                    <div class="gallery-item-info">
                        <h4>No Photos Yet</h4>
                        <p>Start capturing photos to see them here</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-indicator">
            <h3>📈 System Status</h3>
            <div class="status-item">
                <span class="status-label">Camera Active:</span>
                <span class="status-value" id="status-camera">No</span>
            </div>
            <div class="status-item">
                <span class="status-label">Recording:</span>
                <span class="status-value" id="status-recording">No</span>
            </div>
            <div class="status-item">
                <span class="span class="status-label">Photos Captured:</span>
                <span class="status-value" id="status-photos">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Videos Recorded:</span>
                <span class="status-value" id="status-videos">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Storage Used:</span>
                <span class="status-value" id="status-storage">0 MB</span>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        class CameraShowcase {
            constructor() {
                this.stream = null;
                this.video = document.getElementById('camera-video');
                this.canvas = document.getElementById('camera-canvas');
                this.isRecording = false;
                this.mediaRecorder = null;
                this.recordedChunks = [];
                this.photoCount = 0;
                this.videoCount = 0;
                this.currentEffect = 'none';
                this.isGridVisible = false;
                this.isNightMode = false;
                this.isSmallScreen = window.innerWidth <= 800; // Detect Raspberry Pi screen
                
                this.initializeEventListeners();
                this.initializeSliders();
                this.updateStatus();
                this.optimizeForSmallScreen();
                
                // Listen for orientation/resize changes
                window.addEventListener('resize', () => {
                    this.isSmallScreen = window.innerWidth <= 800;
                    this.optimizeForSmallScreen();
                });
                
                // Automatically start camera when page loads
                this.autoStartCamera();
            }
            
            optimizeForSmallScreen() {
                if (this.isSmallScreen) {
                    // Reduce video quality for better performance on Raspberry Pi
                    this.defaultConstraints = {
                        video: {
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 15, max: 30 }
                        }
                    };
                } else {
                    this.defaultConstraints = {
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            facingMode: 'environment'
                        }
                    };
                }
            }

            async autoStartCamera() {
                // Small delay to ensure DOM is fully loaded
                setTimeout(async () => {
                    try {
                        // Check camera permissions first (if available)
                        try {
                            const permission = await navigator.permissions.query({ name: 'camera' });
                            
                            if (permission.state === 'denied') {
                                throw new Error('Camera permission denied');
                            }
                        } catch (permError) {
                            // Permissions API not available, continue with camera start
                            console.log('Permissions API not available, proceeding with camera start');
                        }
                        
                        await this.startCamera();
                    } catch (error) {
                        console.error('Auto-start camera failed:', error);
                        
                        // Handle different types of errors
                        let errorMessage = 'Camera auto-start failed. Please refresh the page.';
                        
                        if (error.name === 'NotAllowedError' || error.message === 'Camera permission denied') {
                            errorMessage = 'Camera permission denied. Please allow camera access and refresh.';
                        } else if (error.name === 'NotFoundError') {
                            errorMessage = 'No camera found. Please connect a camera and refresh.';
                        } else if (error.name === 'NotReadableError') {
                            errorMessage = 'Camera is in use by another application. Please close other camera apps and refresh.';
                        }
                        
                        // Update placeholder text
                        const placeholder = document.querySelector('.camera-placeholder p');
                        if (placeholder) {
                            placeholder.textContent = errorMessage;
                        }
                        
                        // Hide loading spinner
                        const loadingSpinner = document.querySelector('.camera-placeholder .loading-spinner');
                        if (loadingSpinner) {
                            loadingSpinner.style.display = 'none';
                        }
                        
                        this.showNotification(errorMessage, 'error');
                    }
                }, 500);
            }

            initializeEventListeners() {
                // Camera controls
                document.getElementById('restart-camera').addEventListener('click', () => this.restartCamera());
                document.getElementById('stop-camera').addEventListener('click', () => this.stopCamera());
                document.getElementById('capture-photo').addEventListener('click', () => this.capturePhoto());
                document.getElementById('start-recording').addEventListener('click', () => this.toggleRecording());
                document.getElementById('switch-camera').addEventListener('click', () => this.switchCamera());

                // Advanced features
                document.getElementById('toggle-grid').addEventListener('click', () => this.toggleGrid());
                document.getElementById('auto-focus').addEventListener('click', () => this.autoFocus());
                document.getElementById('face-detection').addEventListener('click', () => this.toggleFaceDetection());
                document.getElementById('motion-detection').addEventListener('click', () => this.toggleMotionDetection());
                document.getElementById('night-mode').addEventListener('click', () => this.toggleNightMode());

                // Effect buttons
                document.querySelectorAll('.effect-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.applyEffect(e.target.dataset.effect));
                });
            }

            initializeSliders() {
                const sliders = ['brightness', 'contrast', 'saturation', 'sharpness', 'zoom'];
                sliders.forEach(id => {
                    const slider = document.getElementById(id);
                    const valueDisplay = document.getElementById(`${id}-value`);
                    
                    slider.addEventListener('input', (e) => {
                        const value = e.target.value;
                        valueDisplay.textContent = id === 'zoom' ? `${value}%` : value;
                        this.applyCameraSettings();
                    });
                });
            }

            async startCamera() {
                try {
                    // Check if camera is already running
                    if (this.stream) {
                        console.log('Camera is already running');
                        return;
                    }

                    this.showNotification('Starting camera...', 'info');
                    
                    // Use optimized constraints based on screen size
                    const constraints = this.defaultConstraints || {
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            facingMode: 'environment'
                        }
                    };

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    this.video.style.display = 'block';
                    
                    // Hide the camera placeholder
                    const placeholder = document.querySelector('.camera-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                    
                    // Wait for video to load
                    this.video.addEventListener('loadedmetadata', () => {
                        this.updateCameraInfo();
                        this.updateStatus();
                        this.showNotification('Camera started successfully!', 'success');
                        
                        // Hide the loading spinner
                        const loadingSpinner = document.querySelector('.camera-placeholder .loading-spinner');
                        if (loadingSpinner) {
                            loadingSpinner.style.display = 'none';
                        }
                    });

                    document.getElementById('camera-status').textContent = 'Active';
                    document.getElementById('status-camera').textContent = 'Yes';
                    
                } catch (error) {
                    console.error('Error starting camera:', error);
                    this.showNotification('Failed to start camera: ' + error.message, 'error');
                    
                    // Update placeholder text to show error
                    const placeholder = document.querySelector('.camera-placeholder p');
                    if (placeholder) {
                        placeholder.textContent = 'Camera failed to start. Please check permissions and refresh.';
                    }
                }
            }

            async restartCamera() {
                this.stopCamera();
                
                // Update placeholder text and show loading spinner
                const placeholder = document.querySelector('.camera-placeholder');
                if (placeholder) {
                    const textElement = placeholder.querySelector('p');
                    if (textElement) {
                        textElement.textContent = 'Restarting camera...';
                    }
                    const loadingSpinner = placeholder.querySelector('.loading-spinner');
                    if (loadingSpinner) {
                        loadingSpinner.style.display = 'inline-block';
                    }
                }
                
                // Small delay to ensure camera is fully stopped
                setTimeout(async () => {
                    await this.startCamera();
                    this.showNotification('Camera restarted successfully!', 'success');
                }, 1000);
            }

            stopCamera() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                this.video.style.display = 'none';
                
                // Show the camera placeholder again
                const placeholder = document.querySelector('.camera-placeholder');
                if (placeholder) {
                    placeholder.style.display = 'block';
                    // Update text and show loading spinner for restart
                    const textElement = placeholder.querySelector('p');
                    if (textElement) {
                        textElement.textContent = 'Camera stopped. Click "Restart Camera" to continue.';
                    }
                    const loadingSpinner = placeholder.querySelector('.loading-spinner');
                    if (loadingSpinner) {
                        loadingSpinner.style.display = 'none';
                    }
                }
                
                this.stopRecording();
                this.updateStatus();
                
                document.getElementById('camera-status').textContent = 'Stopped';
                document.getElementById('status-camera').textContent = 'No';
                
                this.showNotification('Camera stopped', 'info');
            }

            capturePhoto() {
                if (!this.stream) {
                    this.showNotification('Please start the camera first', 'warning');
                    return;
                }

                const context = this.canvas.getContext('2d');
                this.canvas.width = this.video.videoWidth;
                this.canvas.height = this.video.videoHeight;
                
                // Apply current effect
                context.filter = this.getEffectFilter();
                context.drawImage(this.video, 0, 0);
                
                // Convert to blob and create download link
                this.canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `photo_${Date.now()}.jpg`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.addToGallery(url, 'Photo', new Date().toLocaleString());
                    this.photoCount++;
                    this.updateStatus();
                    
                    this.showNotification('Photo captured!', 'success');
                }, 'image/jpeg', 0.9);
            }

            toggleRecording() {
                if (!this.stream) {
                    this.showNotification('Please start the camera first', 'warning');
                    return;
                }

                if (this.isRecording) {
                    this.stopRecording();
                } else {
                    this.startRecording();
                }
            }

            startRecording() {
                this.recordedChunks = [];
                this.mediaRecorder = new MediaRecorder(this.stream, {
                    mimeType: 'video/webm;codecs=vp9'
                });

                this.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        this.recordedChunks.push(event.data);
                    }
                };

                this.mediaRecorder.onstop = () => {
                    const blob = new Blob(this.recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `video_${Date.now()}.webm`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.addToGallery(url, 'Video', new Date().toLocaleString());
                    this.videoCount++;
                    this.updateStatus();
                    
                    this.showNotification('Video saved!', 'success');
                };

                this.mediaRecorder.start();
                this.isRecording = true;
                this.updateRecordingUI();
                this.showNotification('Recording started', 'info');
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.updateRecordingUI();
                    this.showNotification('Recording stopped', 'info');
                }
            }

            updateRecordingUI() {
                const recordingIndicator = document.getElementById('recording-indicator');
                const startBtn = document.getElementById('start-recording');
                
                if (this.isRecording) {
                    recordingIndicator.classList.add('active');
                    startBtn.textContent = '⏹️ Stop Recording';
                    startBtn.classList.add('recording');
                    document.getElementById('status-recording').textContent = 'Yes';
                } else {
                    recordingIndicator.classList.remove('active');
                    startBtn.textContent = '🎥 Start Recording';
                    startBtn.classList.remove('recording');
                    document.getElementById('status-recording').textContent = 'No';
                }
            }

            applyEffect(effect) {
                this.currentEffect = effect;
                
                // Update active button
                document.querySelectorAll('.effect-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-effect="${effect}"]`).classList.add('active');
                
                // Apply effect to video
                this.video.style.filter = this.getEffectFilter();
                
                this.showNotification(`Effect applied: ${effect}`, 'info');
            }

            getEffectFilter() {
                const brightness = document.getElementById('brightness').value;
                const contrast = document.getElementById('contrast').value;
                const saturation = document.getElementById('saturation').value;
                const sharpness = document.getElementById('sharpness').value;
                
                let filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%)`;
                
                switch (this.currentEffect) {
                    case 'grayscale':
                        filter += ' grayscale(100%)';
                        break;
                    case 'sepia':
                        filter += ' sepia(100%)';
                        break;
                    case 'invert':
                        filter += ' invert(100%)';
                        break;
                    case 'blur':
                        filter += ' blur(2px)';
                        break;
                    case 'brightness':
                        filter += ' brightness(150%)';
                        break;
                    case 'contrast':
                        filter += ' contrast(150%)';
                        break;
                    case 'saturation':
                        filter += ' saturate(200%)';
                        break;
                }
                
                return filter;
            }

            applyCameraSettings() {
                // Apply zoom effect
                const zoom = document.getElementById('zoom').value / 100;
                this.video.style.transform = `scale(${zoom})`;
                
                // Apply other settings through CSS filters
                this.video.style.filter = this.getEffectFilter();
            }

            toggleGrid() {
                this.isGridVisible = !this.isGridVisible;
                const grid = document.getElementById('overlay-grid');
                grid.classList.toggle('active', this.isGridVisible);
                
                this.showNotification(`Grid ${this.isGridVisible ? 'enabled' : 'disabled'}`, 'info');
            }

            autoFocus() {
                if (!this.stream) {
                    this.showNotification('Please start the camera first', 'warning');
                    return;
                }

                const focusIndicator = document.getElementById('focus-indicator');
                focusIndicator.classList.add('active');
                
                setTimeout(() => {
                    focusIndicator.classList.remove('active');
                }, 2000);
                
                this.showNotification('Auto focus activated', 'info');
            }

            toggleFaceDetection() {
                this.showNotification('Face detection feature coming soon!', 'info');
            }

            toggleMotionDetection() {
                this.showNotification('Motion detection feature coming soon!', 'info');
            }

            toggleNightMode() {
                this.isNightMode = !this.isNightMode;
                
                if (this.isNightMode) {
                    this.video.style.filter += ' brightness(80%) contrast(120%)';
                    document.getElementById('night-mode').textContent = 'Day Mode';
                } else {
                    this.video.style.filter = this.getEffectFilter();
                    document.getElementById('night-mode').textContent = 'Night Mode';
                }
                
                this.showNotification(`Night mode ${this.isNightMode ? 'enabled' : 'disabled'}`, 'info');
            }

            switchCamera() {
                // This would typically switch between front/back cameras
                this.showNotification('Camera switching feature coming soon!', 'info');
            }

            addToGallery(url, type, timestamp) {
                const galleryGrid = document.getElementById('gallery-grid');
                
                // Remove placeholder if it exists
                const placeholder = galleryGrid.querySelector('.gallery-item:first-child');
                if (placeholder && placeholder.querySelector('h4').textContent === 'No Photos Yet') {
                    placeholder.remove();
                }
                
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.innerHTML = `
                    <img src="${url}" alt="${type}">
                    <div class="gallery-item-info">
                        <h4>${type}</h4>
                        <p>${timestamp}</p>
                        <div class="gallery-actions">
                            <button class="btn" onclick="this.downloadItem('${url}', '${type.toLowerCase()}_${Date.now()}')">Download</button>
                            <button class="btn" onclick="this.deleteItem(this)">Delete</button>
                        </div>
                    </div>
                `;
                
                galleryGrid.appendChild(galleryItem);
            }

            downloadItem(url, filename) {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
            }

            deleteItem(button) {
                const galleryItem = button.closest('.gallery-item');
                galleryItem.remove();
                this.showNotification('Item deleted', 'info');
            }

            updateCameraInfo() {
                if (this.video.videoWidth && this.video.videoHeight) {
                    document.getElementById('resolution').textContent = `${this.video.videoWidth}x${this.video.videoHeight}`;
                }
                
                // Simulate frame rate detection
                document.getElementById('framerate').textContent = '30 FPS';
                document.getElementById('camera-type').textContent = 'USB Camera';
            }

            updateStatus() {
                document.getElementById('status-photos').textContent = this.photoCount;
                document.getElementById('status-videos').textContent = this.videoCount;
                
                // Simulate storage calculation
                const totalSize = (this.photoCount * 2) + (this.videoCount * 10); // MB
                document.getElementById('status-storage').textContent = `${totalSize} MB`;
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize the camera showcase when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new CameraShowcase();
        });

        // Add global functions for gallery actions
        window.downloadItem = function(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        };

        window.deleteItem = function(button) {
            const galleryItem = button.closest('.gallery-item');
            galleryItem.remove();
        };
    </script>
</body>
</html>
