<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wind Tunnel 125 - Matrix TSL</title>
  <link rel="icon" type="image/png" href="../assets/Matrix.png">
  
  <!-- Chart.js for enhanced graphing -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>

<section id="screen-wind-tunnel">
  <button class="nav-btn" id="btnHome" aria-label="Home">üè†</button>
  
  <!-- Header -->
  <header class="wind-tunnel-header">
    <div class="logo-section">
      <span class="matrix-logo">MATRIX</span>
      <span class="model-info">WIND TUNNEL<br>125</span>
    </div>
  </header>

  <div class="wind-tunnel-container">
    <!-- Left Control Panel -->
    <div class="control-panel left-panel">
      <!-- Sweep Section -->
      <div class="control-section">
        <div class="section-header">
          <span class="number-badge">4</span>
          <button class="sweep-btn active">Sweep</button>
        </div>
        <div class="control-group">
          <button class="control-btn">Zero</button>
          <button class="control-btn">Set</button>
        </div>
      </div>

      <!-- Angle Section -->
      <div class="control-section">
        <div class="section-title">üåä Angle of Attack</div>
        <div class="interactive-slider-container">
          <div class="slider-header">
            <span class="slider-label">Angle:</span>
            <span class="value-display" id="angleDisplay">0¬∞</span>
          </div>
          <div class="vertical-slider-wrapper">
            <div class="slider-marks">
              <span>45¬∞</span>
              <span>30¬∞</span>
              <span>15¬∞</span>
              <span>0¬∞</span>
              <span>-15¬∞</span>
              <span>-30¬∞</span>
              <span>-45¬∞</span>
            </div>
            <input type="range" 
                   id="angleSlider" 
                   class="interactive-slider" 
                   min="-45" 
                   max="45" 
                   value="0" 
                   step="1"
                   oninput="setAngleFromSlider(this.value)"
                   orient="vertical">
          </div>
        </div>
      </div>

      <!-- Fan Speed Section -->
      <div class="control-section">
        <div class="section-header">
          <button class="control-btn switch-off" onclick="setFanSpeed(0)">Switch Off</button>
          <button class="control-btn" onclick="startSweep()">Set</button>
        </div>
        <div class="section-title">üí® Fan Speed</div>
        <div class="interactive-slider-container">
          <div class="slider-header">
            <span class="slider-label">Speed:</span>
            <span class="value-display" id="speedDisplay">50%</span>
          </div>
          <div class="vertical-slider-wrapper">
            <div class="slider-marks">
              <span>100%</span>
              <span>75%</span>
              <span>50%</span>
              <span>25%</span>
              <span>0%</span>
            </div>
            <input type="range" 
                   id="speedSlider" 
                   class="interactive-slider" 
                   min="0" 
                   max="100" 
                   value="50" 
                   step="5"
                   oninput="setFanSpeedFromSlider(this.value)"
                   orient="vertical">
          </div>
        </div>
      </div>
    </div>

    <!-- Center Data Panel -->
    <div class="data-panel">
      <!-- User Control Sliders -->
      <div class="slider-section">
        <!-- Lift Coefficient Slider -->
        <div class="control-slider">
          <label class="slider-label">Lift Coefficient</label>
          <div class="slider-container">
            <input type="range" class="data-slider" id="liftCoeff" min="-2" max="2" step="0.1" value="0.5">
            <div class="slider-value" id="liftCoeffValue">0.5</div>
          </div>
          <button class="zero-btn">Zero</button>
        </div>

        <!-- Angle of Attack Slider -->
        <div class="control-slider">
          <label class="slider-label">Angle of Attack</label>
          <div class="slider-container">
            <input type="range" class="data-slider" id="angleAttack" min="-45" max="45" step="1" value="30">
            <div class="slider-value" id="angleAttackValue">30¬∞</div>
          </div>
          <button class="zero-btn">Zero</button>
        </div>
      </div>

      <!-- Data Display Columns -->
      <div class="data-columns">
        <!-- Lift Column -->
        <div class="data-column">
          <div class="column-title">Lift</div>
          <div class="display-value" id="liftDisplay">810.00mN</div>
          <div class="value-bar">
            <div class="value-indicator" id="liftIndicator" style="height: 40%;"></div>
          </div>
        </div>

        <!-- Drag Column -->
        <div class="data-column">
          <div class="column-title">Drag</div>
          <div class="display-value" id="dragDisplay">323.37mN</div>
          <div class="value-bar">
            <div class="value-indicator" id="dragIndicator" style="height: 20%;"></div>
          </div>
        </div>

        <!-- Pressure Column -->
        <div class="data-column">
          <div class="column-title">Pressure</div>
          <div class="display-value" id="pressureDisplay">0.45Pa</div>
          <div class="value-bar">
            <div class="value-indicator" id="pressureIndicator" style="height: 15%;"></div>
          </div>
        </div>

        <!-- Air Speed Column -->
        <div class="data-column">
          <div class="column-title">Air Speed</div>
          <div class="display-value" id="airSpeedDisplay">18.25m/s</div>
          <div class="value-bar">
            <div class="value-indicator" id="airSpeedIndicator" style="height: 35%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Graph Panel -->
    <div class="graph-panel">
      <div class="graph-header">
        <button class="graph-btn">Log</button>
        <button class="graph-btn">Clear Graph</button>
      </div>
      
      <div class="graph-container">
        <div class="graph-title">Angle vs Lift/Drag</div>
        <div class="graph-area">
          <canvas id="windTunnelChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body, html {
    height: 100%;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  #screen-wind-tunnel {
    width: 100vw;
    height: 100vh;
    background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
    color: white;
    position: relative;
    display: flex;
    flex-direction: column;
  }

  /* Navigation Button */
  .nav-btn {
    position: fixed;
    top: 15px;
    left: 15px;
    width: 40px;
    height: 40px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50%;
    color: white;
    font-size: 16px;
    cursor: pointer;
    z-index: 1000;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nav-btn:hover {
    background: rgba(255,255,255,0.2);
    transform: scale(1.1);
  }

  /* Header */
  .wind-tunnel-header {
    padding: 20px;
    text-align: center;
    background: rgba(0,0,0,0.3);
    border-bottom: 2px solid #444;
  }

  .logo-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  .matrix-logo {
    font-size: 36px;
    font-weight: bold;
    background: linear-gradient(45deg, #9b59b6, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .model-info {
    font-size: 18px;
    font-weight: 600;
    text-align: left;
    line-height: 1.2;
  }

  /* Main Container */
  .wind-tunnel-container {
    flex: 1;
    display: grid;
    grid-template-columns: 200px 300px 1fr;
    gap: 15px;
    padding: 20px;
    overflow: hidden;
    height: calc(100vh - 120px);
  }

  /* Control Panel */
  .control-panel {
    width: 200px;
    background: #333;
    border: 2px solid #555;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .control-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .number-badge {
    background: #ffeb3b;
    color: #000;
    width: 30px;
    height: 30px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
  }

  .sweep-btn {
    background: #d32f2f;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    min-height: 48px;
    min-width: 100px;
    transition: all 0.2s ease;
    user-select: none;
    touch-action: manipulation;
  }

  .sweep-btn:hover {
    background: #b71c1c;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(211, 47, 47, 0.4);
  }

  .sweep-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(211, 47, 47, 0.4);
  }

  .sweep-btn.active {
    background: #ff5722;
    box-shadow: 0 0 15px rgba(255, 87, 34, 0.6);
  }

  .control-btn {
    background: #666;
    color: white;
    border: 1px solid #888;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    min-height: 48px;
    min-width: 80px;
    transition: all 0.2s ease;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    touch-action: manipulation;
  }

  .control-btn:hover {
    background: #777;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .control-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .switch-off {
    background: #4caf50 !important;
  }

  .control-group {
    display: flex;
    gap: 5px;
  }

  .section-title {
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
  }

  /* Angle Display */
  .angle-display, .fan-speed-display {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .angle-scale, .speed-scale {
    flex: 1;
    background: #222;
    border: 1px solid #555;
    border-radius: 4px;
    padding: 5px;
    position: relative;
  }

  .angle-values, .speed-values {
    display: flex;
    flex-direction: column;
    gap: 2px;
    max-height: 200px;
    overflow-y: auto;
  }

  .angle-value, .speed-value {
    padding: 3px 8px;
    font-size: 12px;
    border-radius: 2px;
    text-align: center;
  }

  .angle-value.selected, .speed-value.selected {
    background: #d32f2f;
    color: white;
  }

  .angle-readout, .speed-readout {
    background: #333;
    border: 1px solid #555;
    padding: 8px;
    border-radius: 4px;
    font-weight: bold;
    min-width: 50px;
    text-align: center;
  }

  /* Data Panel */
  .data-panel {
    background: #333;
    border: 2px solid #555;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    height: 100%;
    overflow-y: auto;
  }

  .input-section {
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 15px;
    border-bottom: 1px solid #555;
  }

  /* Slider Controls */
  .slider-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #555;
  }

  .control-slider {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .slider-label {
    font-weight: bold;
    color: #00ff41;
    font-size: 14px;
  }

  .slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .data-slider {
    flex: 1;
    height: 8px;
    background: #444;
    border-radius: 4px;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    cursor: pointer;
    touch-action: manipulation;
  }

  .data-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    background: #00ff41;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    transition: all 0.2s ease;
  }

  .data-slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(0, 255, 65, 0.8);
  }

  .data-slider::-webkit-slider-thumb:active {
    transform: scale(1.2);
    box-shadow: 0 0 20px rgba(0, 255, 65, 1);
  }

  .data-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    background: #00ff41;
    border-radius: 50%;
    cursor: pointer;
    border: none;
    box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    transition: all 0.2s ease;
  }

  .data-slider::-moz-range-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(0, 255, 65, 0.8);
  }

  .slider-value {
    background: #222;
    border: 1px solid #555;
    padding: 8px 12px;
    border-radius: 4px;
    font-weight: bold;
    color: #00ff41;
    min-width: 60px;
    text-align: center;
  }

  /* Touch feedback enhancements */
  .control-btn:focus,
  .sweep-btn:focus,
  .graph-btn:focus,
  .zero-btn:focus {
    outline: 2px solid #00ff41;
    outline-offset: 2px;
  }

  /* Haptic feedback for touchscreens */
  @media (hover: none) and (pointer: coarse) {
    .control-btn:active,
    .sweep-btn:active,
    .graph-btn:active,
    .zero-btn:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }
  }

  /* Enhanced touch targets */
  .angle-value,
  .speed-value {
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 4px;
    user-select: none;
    touch-action: manipulation;
  }

  .angle-value:hover,
  .speed-value:hover {
    background: #444;
  }

  .angle-value:active,
  .speed-value:active {
    background: #555;
    transform: scale(0.95);
  }

  .zero-btn {
    background: #666;
    color: white;
    border: 1px solid #888;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    min-height: 44px;
    min-width: 60px;
    transition: all 0.2s ease;
    user-select: none;
    touch-action: manipulation;
  }

  .zero-btn:hover {
    background: #777;
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  }

  .zero-btn:active {
    transform: translateY(0);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }

  /* Interactive Sliders */
  .interactive-slider-container {
    margin: 15px 0;
    padding: 15px;
    background: rgba(0, 255, 255, 0.1);
    border-radius: 8px;
    border: 1px solid #00ffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 300px;
  }

  .slider-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: 14px;
    color: #00ffff;
    width: 100%;
  }

  .value-display {
    font-weight: bold;
    color: #ffffff;
    background: rgba(0, 255, 255, 0.2);
    padding: 4px 12px;
    border-radius: 4px;
    min-width: 50px;
    text-align: center;
    font-size: 16px;
  }

  .interactive-slider {
    width: 8px;
    height: 220px;
    background: #333;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
    -webkit-appearance: slider-vertical;
    appearance: slider-vertical;
    writing-mode: bt-lr; /* IE */
    -webkit-writing-mode: vertical-lr; /* WebKit */
    writing-mode: vertical-lr;
    margin: 10px 0;
    transform: rotate(180deg); /* Flip so min is at bottom */
  }

  .interactive-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    background: #00ffff;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #ffffff;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    transition: all 0.2s ease;
  }

  .interactive-slider::-webkit-slider-thumb:hover {
    background: #ffffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
    transform: scale(1.1);
  }

  .interactive-slider::-webkit-slider-thumb:active {
    transform: scale(1.2);
    box-shadow: 0 0 20px rgba(0, 255, 255, 1);
  }

  .interactive-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    background: #00ffff;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #ffffff;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    transition: all 0.2s ease;
  }

  .interactive-slider::-moz-range-thumb:hover {
    background: #ffffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
    transform: scale(1.1);
  }

  .slider-marks {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-size: 11px;
    color: #888;
    margin-left: 10px;
    height: 220px;
    align-items: flex-start;
  }

  .slider-marks span {
    color: #00ffff;
    font-size: 10px;
    line-height: 1;
  }

  .vertical-slider-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex: 1;
  }

  /* Touch-friendly slider sizing */
  @media (max-width: 768px) {
    .interactive-slider {
      width: 12px;
      height: 250px;
    }
    
    .interactive-slider::-webkit-slider-thumb {
      width: 28px;
      height: 28px;
    }
    
    .interactive-slider::-moz-range-thumb {
      width: 28px;
      height: 28px;
    }
    
    .slider-header {
      font-size: 18px;
    }
    
    .value-display {
      font-size: 16px;
      padding: 6px 12px;
    }

    .interactive-slider-container {
      padding: 20px;
      margin: 25px 0;
      height: 350px;
    }

    .slider-marks {
      height: 250px;
      font-size: 12px;
    }

    .slider-marks span {
      font-size: 12px;
    }
  }

  .input-label {
    font-weight: bold;
    min-width: 120px;
  }

  .data-input {
    flex: 1;
    background: #222;
    border: 1px solid #555;
    color: white;
    padding: 8px;
    border-radius: 4px;
  }

  .zero-btn {
    background: #666;
    color: white;
    border: 1px solid #888;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
  }

  .data-columns {
    display: flex;
    gap: 15px;
    flex: 1;
  }

  .data-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .column-title {
    font-weight: bold;
    text-align: center;
    padding: 8px;
    background: #444;
    border-radius: 4px;
    color: #00ff41;
  }

  .display-value {
    background: #222;
    border: 1px solid #555;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    color: #00ff41;
    border-radius: 4px;
    font-size: 16px;
  }

  .value-bar {
    height: 150px;
    background: #222;
    border: 1px solid #555;
    border-radius: 4px;
    position: relative;
    overflow: hidden;
  }

  .value-indicator {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(to top, #00ff41, #00aa2a);
    transition: height 0.3s ease;
    border-radius: 0 0 3px 3px;
  }

  .data-values {
    flex: 1;
    background: #222;
    border: 1px solid #555;
    border-top: none;
    display: flex;
    flex-direction: column;
    max-height: 300px;
    overflow-y: auto;
  }

  .data-value {
    padding: 4px 8px;
    font-size: 12px;
    text-align: center;
    border-bottom: 1px solid #333;
  }

  .data-value.selected {
    background: #d32f2f;
    color: white;
  }

  .unit-display {
    background: #444;
    padding: 8px;
    text-align: center;
    font-weight: bold;
    border-radius: 0 0 4px 4px;
    border: 1px solid #555;
    border-top: none;
  }

  /* Graph Panel */
  .graph-panel {
    background: #333;
    border: 2px solid #555;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-width: 600px;
  }

  .graph-header {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }

  .graph-btn {
    background: #666;
    color: white;
    border: 1px solid #888;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    min-height: 48px;
    min-width: 100px;
    transition: all 0.2s ease;
    user-select: none;
    touch-action: manipulation;
  }

  .graph-btn:hover {
    background: #777;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .graph-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .graph-container {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .graph-title {
    font-weight: bold;
    text-align: center;
    margin-bottom: 15px;
    font-size: 14px;
  }

  .graph-area {
    flex: 1;
    background: #222;
    border: 2px solid #555;
    border-radius: 8px;
    position: relative;
    padding: 15px;
    min-height: 480px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #windTunnelChart {
    background: transparent;
    border-radius: 4px;
    max-width: 100%;
    max-height: 100%;
  }

  .graph-axes {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
  }

  .y-axis {
    position: absolute;
    left: 0;
    top: 20px;
    bottom: 40px;
    width: 60px;
    display: flex;
    flex-direction: column;
  }

  .y-label {
    writing-mode: vertical-lr;
    text-orientation: mixed;
    font-size: 12px;
    text-align: center;
    flex: 1;
  }

  .y-scale {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    font-size: 10px;
    padding: 10px 0;
  }

  .x-axis {
    position: absolute;
    bottom: 0;
    left: 60px;
    right: 20px;
    height: 40px;
    display: flex;
    flex-direction: column;
  }

  .x-scale {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    padding: 5px 0;
  }

  .x-label {
    text-align: center;
    font-size: 12px;
    margin-top: 5px;
  }

  /* Responsive Design */
  @media (max-width: 1400px) {
    .wind-tunnel-container {
      grid-template-columns: 180px 280px 1fr;
      gap: 10px;
    }

    .graph-panel {
      min-width: 500px;
    }

    #windTunnelGraph {
      width: 500px;
      height: 350px;
    }
  }

  @media (max-width: 1200px) {
    .wind-tunnel-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .control-panel {
      width: 100%;
      flex-direction: row;
      overflow-x: auto;
    }

    .graph-panel {
      width: 100%;
      min-width: auto;
    }

    .data-columns {
      overflow-x: auto;
    }

    #windTunnelChart {
      width: 100%;
      max-width: 600px;
      height: 400px;
    }
  }

  @media (max-width: 768px) {
    .wind-tunnel-container {
      padding: 10px;
    }

    .control-section {
      min-width: 150px;
    }

    .slider-section {
      flex-direction: row;
      gap: 15px;
    }

    .control-slider {
      flex: 1;
      min-width: 200px;
    }

    #windTunnelChart {
      width: 100%;
      height: 300px;
    }

    .control-btn, .graph-btn {
      min-height: 52px;
      min-width: 80px;
      font-size: 15px;
    }

    .sweep-btn {
      min-height: 52px;
      min-width: 110px;
      font-size: 15px;
    }
  }

    .matrix-logo {
      font-size: 24px;
    }

    .model-info {
      font-size: 14px;
    }

    .data-columns {
      flex-direction: column;
    }
  }
</style>

<script>
  (function() {
    'use strict';
    
    let currentAngle = 30;
    let currentFanSpeed = 30;
    let liftData = [];
    let dragData = [];
    
    function initWindTunnel() {
      console.log('üå™Ô∏è Wind Tunnel 125 initialized');
      
      // Initialize slider values
      const liftCoeffSlider = document.getElementById('liftCoeff');
      const angleAttackSlider = document.getElementById('angleAttack');
      
      if (liftCoeffSlider) {
        updateSliderValue('liftCoeffValue', liftCoeffSlider.value);
      }
      
      if (angleAttackSlider) {
        angleAttackSlider.value = currentAngle;
        updateSliderValue('angleAttackValue', currentAngle + '¬∞');
      }
      
      setupEventListeners();
      
      // Initialize graph with a small delay to ensure DOM is ready
      setTimeout(() => {
        initializeGraph();
        // Generate initial realistic curve data
        generateInitialCurveData();
      }, 100);
      
      updateAngleDisplay();
      updateSpeedDisplay();
      updateDataReadings();
      startDataSimulation();
    }

    function generateInitialCurveData() {
      console.log('üìä Generating initial curve data');
      
      // Clear existing data
      liftData = [];
      dragData = [];
      
      // Generate realistic curve data across the angle range
      for (let angle = -25; angle <= 30; angle += 2) {
        const tempAngle = currentAngle;
        currentAngle = angle;
        
        // Calculate realistic values without random noise for smooth curve
        let lift;
        if (angle < -5) {
          lift = -200 - (angle + 5) * 50;
        } else if (angle < 0) {
          lift = angle * 40;
        } else if (angle < 15) {
          lift = angle * 60;
        } else if (angle < 20) {
          lift = 900 + (angle - 15) * 20;
        } else {
          lift = 1000 - (angle - 20) * 10;
        }
        
        let drag;
        if (Math.abs(angle) < 10) {
          drag = 50 + Math.abs(angle) * 5;
        } else if (Math.abs(angle) < 20) {
          drag = 100 + (Math.abs(angle) - 10) * 10;
        } else {
          drag = 200 + (Math.abs(angle) - 20) * 15;
        }
        
        // Apply current speed factor
        const speedFactor = currentFanSpeed / 100;
        lift *= speedFactor;
        drag *= speedFactor;
        
        liftData.push({angle: angle, value: lift});
        dragData.push({angle: angle, value: drag});
        
        // Restore original angle
        currentAngle = tempAngle;
      }
      
      // Update the graph with initial data
      updateGraph();
    }
    
    function setupEventListeners() {
      const homeButton = document.querySelector('#btnHome');
      if (homeButton) {
        homeButton.addEventListener('click', goHome);
      }

      // Slider controls
      const liftCoeffSlider = document.getElementById('liftCoeff');
      const angleAttackSlider = document.getElementById('angleAttack');
      
      if (liftCoeffSlider) {
        liftCoeffSlider.addEventListener('input', function() {
          updateSliderValue('liftCoeffValue', this.value);
          updateDataReadings();
        });
      }

      if (angleAttackSlider) {
        angleAttackSlider.addEventListener('input', function() {
          updateSliderValue('angleAttackValue', this.value + '¬∞');
          currentAngle = parseFloat(this.value);
          updateAngleDisplay();
          updateDataReadings();
        });
      }

      // Zero buttons
      document.querySelectorAll('.zero-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const slider = this.parentElement.querySelector('.data-slider');
          if (slider) {
            slider.value = 0;
            slider.dispatchEvent(new Event('input'));
          }
        });
      });

      // Slider-specific functions
    function setAngleFromSlider(value) {
      const angle = parseInt(value);
      setAngle(angle);
      document.getElementById('angleDisplay').textContent = `${angle}¬∞`;
    }

    function setFanSpeedFromSlider(value) {
      const speed = parseInt(value);
      setFanSpeed(speed);
      document.getElementById('speedDisplay').textContent = `${speed}%`;
    }

    // Update UI element text content
      const angleValues = document.querySelectorAll('.angle-value');
      angleValues.forEach((value, index) => {
        value.addEventListener('click', () => {
          setAngle(45 - (index * 5));
          // Update the angle slider too
          if (angleAttackSlider) {
            angleAttackSlider.value = 45 - (index * 5);
            updateSliderValue('angleAttackValue', angleAttackSlider.value + '¬∞');
          }
        });
      });

      // Fan speed control
      const speedValues = document.querySelectorAll('.speed-value');
      speedValues.forEach((value, index) => {
        value.addEventListener('click', () => setFanSpeed(100 - (index * 10)));
      });

      // Graph buttons
      document.querySelector('.graph-btn').addEventListener('click', logData);
      document.querySelectorAll('.graph-btn')[1].addEventListener('click', clearGraph);

      // Control buttons
      document.querySelector('.sweep-btn').addEventListener('click', startSweep);
      document.querySelector('.switch-off').addEventListener('click', toggleFan);
    }

    function updateSliderValue(elementId, value) {
      const element = document.getElementById(elementId);
      if (element) {
        element.textContent = value;
      }
    }

    function setAngle(angle) {
      currentAngle = angle;
      updateAngleDisplay();
      updateDataReadings();
      updateGraph();
      console.log(`üìê Angle set to: ${angle}¬∞`);
    }

    function setFanSpeed(speed) {
      currentFanSpeed = speed;
      updateSpeedDisplay();
      updateDataReadings();
      console.log(`üí® Fan speed set to: ${speed}%`);
    }

    function updateAngleDisplay() {
      document.querySelectorAll('.angle-value').forEach(el => {
        el.classList.remove('selected');
        if (parseInt(el.textContent) === currentAngle) {
          el.classList.add('selected');
        }
      });
      document.querySelector('.angle-readout').textContent = `${currentAngle}¬∞`;
    }

    function updateSpeedDisplay() {
      document.querySelectorAll('.speed-value').forEach(el => {
        el.classList.remove('selected');
        if (parseInt(el.textContent) === currentFanSpeed) {
          el.classList.add('selected');
        }
      });
      document.querySelector('.speed-readout').textContent = `${currentFanSpeed}%`;
    }

    function updateDataReadings() {
      // Simulate realistic wind tunnel data matching typical airfoil behavior
      const angleRad = currentAngle * Math.PI / 180;
      const speedFactor = currentFanSpeed / 100;
      const liftCoeff = parseFloat(document.getElementById('liftCoeff')?.value) || 0.5;
      
      // Realistic lift curve - typical airfoil behavior
      let lift;
      if (currentAngle < -5) {
        // Negative lift at high negative angles
        lift = -200 - (currentAngle + 5) * 50;
      } else if (currentAngle < 0) {
        // Gradual increase from negative to zero lift
        lift = currentAngle * 40;
      } else if (currentAngle < 15) {
        // Steep linear increase (lift curve slope)
        lift = currentAngle * 60;
      } else if (currentAngle < 20) {
        // Approaching stall - slight leveling
        lift = 900 + (currentAngle - 15) * 20;
      } else {
        // Post-stall - slight decrease or plateau
        lift = 1000 - (currentAngle - 20) * 10;
      }
      
      // Apply scaling factors
      lift = lift * speedFactor * liftCoeff;
      
      // Add some realistic noise
      lift += (Math.random() - 0.5) * 50;
      
      // Realistic drag curve - typically low with slight increase at high angles
      let drag;
      if (Math.abs(currentAngle) < 10) {
        // Low drag at small angles
        drag = 50 + Math.abs(currentAngle) * 5;
      } else if (Math.abs(currentAngle) < 20) {
        // Slight increase
        drag = 100 + (Math.abs(currentAngle) - 10) * 10;
      } else {
        // Higher drag at extreme angles
        drag = 200 + (Math.abs(currentAngle) - 20) * 15;
      }
      
      // Apply scaling and add noise
      drag = drag * speedFactor + (Math.random() - 0.5) * 20;
      
      // Other parameters
      const pressure = Math.sin(angleRad) * 200 * speedFactor;
      const airSpeed = 20 * speedFactor + Math.random() * 2 - 1;

      // Update display values
      const liftDisplay = document.getElementById('liftDisplay');
      const dragDisplay = document.getElementById('dragDisplay');
      const pressureDisplay = document.getElementById('pressureDisplay');
      const airSpeedDisplay = document.getElementById('airSpeedDisplay');

      if (liftDisplay) liftDisplay.textContent = `${lift.toFixed(2)}mN`;
      if (dragDisplay) dragDisplay.textContent = `${drag.toFixed(2)}mN`;
      if (pressureDisplay) pressureDisplay.textContent = `${pressure.toFixed(2)}Pa`;
      if (airSpeedDisplay) airSpeedDisplay.textContent = `${airSpeed.toFixed(2)}m/s`;

      // Update value bars (normalized to 0-100%)
      const liftPercent = Math.max(0, Math.min(100, (lift + 1500) / 3000 * 100));
      const dragPercent = Math.max(0, Math.min(100, (drag + 500) / 1000 * 100));
      const pressurePercent = Math.max(0, Math.min(100, (pressure + 400) / 800 * 100));
      const airSpeedPercent = Math.max(0, Math.min(100, airSpeed / 30 * 100));

      const liftIndicator = document.getElementById('liftIndicator');
      const dragIndicator = document.getElementById('dragIndicator');
      const pressureIndicator = document.getElementById('pressureIndicator');
      const airSpeedIndicator = document.getElementById('airSpeedIndicator');

      if (liftIndicator) liftIndicator.style.height = `${liftPercent}%`;
      if (dragIndicator) dragIndicator.style.height = `${dragPercent}%`;
      if (pressureIndicator) pressureIndicator.style.height = `${pressurePercent}%`;
      if (airSpeedIndicator) airSpeedIndicator.style.height = `${airSpeedPercent}%`;

      // Store data for graphing
      liftData.push({angle: currentAngle, value: lift});
      dragData.push({angle: currentAngle, value: drag});
      
      // Keep only last 50 data points
      if (liftData.length > 50) liftData.shift();
      if (dragData.length > 50) dragData.shift();
    }

    let windTunnelChart = null;

    function initializeGraph() {
      const ctx = document.getElementById('windTunnelChart');
      if (!ctx) {
        console.error('‚ùå Chart canvas not found!');
        return;
      }

      // Destroy existing chart if it exists
      if (windTunnelChart) {
        windTunnelChart.destroy();
        windTunnelChart = null;
      }

      // Check if Chart.js is loaded
      if (typeof Chart === 'undefined') {
        console.error('‚ùå Chart.js not loaded!');
        return;
      }

      try {
        windTunnelChart = new Chart(ctx, {
          type: 'line',
          data: {
            datasets: [{
              label: 'Lift Force',
              data: [],
              borderColor: '#00ff41',
              backgroundColor: 'rgba(0, 255, 65, 0.1)',
              borderWidth: 3,
              fill: false,
              tension: 0.3,
              pointBackgroundColor: '#00ff41',
              pointBorderColor: '#00aa2a',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }, {
              label: 'Drag Force',
              data: [],
              borderColor: '#ff8800',
              backgroundColor: 'rgba(255, 136, 0, 0.1)',
              borderWidth: 3,
              fill: false,
              tension: 0.3,
              pointBackgroundColor: '#ff8800',
              pointBorderColor: '#cc6600',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index'
            },
            plugins: {
              title: {
                display: true,
                text: 'Wind Tunnel Force Analysis',
                color: '#ffffff',
                font: {
                  size: 16,
                  weight: 'bold'
                }
              },
              legend: {
                labels: {
                  color: '#ffffff',
                  font: {
                    size: 14
                  },
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleColor: '#ffffff',
                bodyColor: '#ffffff',
                borderColor: '#00ff41',
                borderWidth: 1,
                callbacks: {
                  label: function(context) {
                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} mN`;
                  }
                }
              }
            },
            scales: {
              x: {
                type: 'linear',
                position: 'bottom',
                title: {
                  display: true,
                  text: 'Angle (degrees)',
                  color: '#ffffff',
                  font: {
                    size: 14,
                    weight: 'bold'
                  }
                },
                min: -45,
                max: 45,
                ticks: {
                  stepSize: 15,
                  color: '#cccccc',
                  font: {
                    size: 12
                  }
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)',
                  lineWidth: 1
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Force (mN)',
                  color: '#ffffff',
                  font: {
                    size: 14,
                    weight: 'bold'
                  }
                },
                min: -1500,
                max: 1500,
                ticks: {
                  stepSize: 500,
                  color: '#cccccc',
                  font: {
                    size: 12
                  }
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)',
                  lineWidth: 1
                }
              }
            },
            animation: {
              duration: 300,
              easing: 'easeInOutQuad'
            }
          }
        });

        console.log('‚úÖ Chart initialized successfully');
      } catch (error) {
        console.error('‚ùå Chart initialization failed:', error);
      }
    }

    function updateGraph() {
      if (!windTunnelChart) {
        console.warn('‚ö†Ô∏è Chart not initialized, attempting to initialize...');
        initializeGraph();
        return;
      }

      try {
        // Convert data to Chart.js format, sorted by angle
        const liftPoints = liftData
          .sort((a, b) => a.angle - b.angle)
          .map(point => ({
            x: point.angle,
            y: point.value
          }));

        const dragPoints = dragData
          .sort((a, b) => a.angle - b.angle)
          .map(point => ({
            x: point.angle,
            y: point.value
          }));

        // Update chart data
        windTunnelChart.data.datasets[0].data = liftPoints;
        windTunnelChart.data.datasets[1].data = dragPoints;

        // Update the chart with animation
        windTunnelChart.update('none'); // Use 'none' for better performance
      } catch (error) {
        console.error('‚ùå Chart update failed:', error);
        // Try to reinitialize the chart
        initializeGraph();
      }
    }

    function clearGraph() {
      console.log('üßπ Clearing graph data');
      liftData = [];
      dragData = [];
      
      if (windTunnelChart) {
        try {
          windTunnelChart.data.datasets[0].data = [];
          windTunnelChart.data.datasets[1].data = [];
          windTunnelChart.update('none');
        } catch (error) {
          console.error('‚ùå Clear graph failed:', error);
          initializeGraph();
        }
      }
    }

    function startDataSimulation() {
      setInterval(() => {
        if (currentFanSpeed > 0) {
          updateDataReadings();
          updateGraph();
        }
      }, 1000); // Reduced frequency to 1 second for better performance
    }

    function startSweep() {
      console.log('üîÑ Starting angle sweep');
      let sweepAngle = -45;
      const sweepInterval = setInterval(() => {
        setAngle(sweepAngle);
        sweepAngle += 5;
        
        if (sweepAngle > 45) {
          clearInterval(sweepInterval);
          console.log('‚úÖ Sweep completed');
        }
      }, 1000);
    }

    function toggleFan() {
      if (currentFanSpeed > 0) {
        setFanSpeed(0);
        document.querySelector('.switch-off').textContent = 'Switch On';
        document.querySelector('.switch-off').style.background = '#d32f2f';
      } else {
        setFanSpeed(30);
        document.querySelector('.switch-off').textContent = 'Switch Off';
        document.querySelector('.switch-off').style.background = '#4caf50';
      }
    }

    function logData() {
      const timestamp = new Date().toLocaleTimeString();
      console.log(`üìä Data logged at ${timestamp}:`, {
        angle: currentAngle,
        fanSpeed: currentFanSpeed,
        lift: liftData[liftData.length - 1]?.value || 0,
        drag: dragData[dragData.length - 1]?.value || 0
      });
    }

    function goHome() {
      if (window.showcaseFramework && window.showcaseFramework.goHome) {
        window.showcaseFramework.goHome();
      } else {
        window.location.href = '../index.html';
      }
      console.log('üè† Navigating home');
    }
    
    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initWindTunnel);
    } else {
      initWindTunnel();
    }

    // Also ensure Chart.js is loaded
    window.addEventListener('load', function() {
      if (typeof Chart === 'undefined') {
        console.error('‚ùå Chart.js failed to load from CDN');
        // Could add fallback loading here
      } else {
        console.log('‚úÖ Chart.js loaded successfully');
        // Reinitialize graph if it failed before
        if (!windTunnelChart) {
          setTimeout(initializeGraph, 500);
        }
      }
    });

    // Global debug utilities
    window.windTunnelDebug = {
      setAngle: setAngle,
      setFanSpeed: setFanSpeed,
      setAngleFromSlider: setAngleFromSlider,
      setFanSpeedFromSlider: setFanSpeedFromSlider,
      startSweep: startSweep,
      clearGraph: clearGraph,
      reinitializeGraph: function() {
        console.log('üîÑ Manually reinitializing graph...');
        initializeGraph();
      },
      generateCurve: function() {
        console.log('üìà Generating realistic aerodynamic curve...');
        generateInitialCurveData();
      },
      checkChart: function() {
        console.log('üìä Chart status:', {
          chartExists: !!windTunnelChart,
          chartjsLoaded: typeof Chart !== 'undefined',
          canvasExists: !!document.getElementById('windTunnelChart'),
          dataPoints: {
            lift: liftData.length,
            drag: dragData.length
          }
        });
      },
      getCurrentData: () => ({
        angle: currentAngle,
        fanSpeed: currentFanSpeed,
        liftPoints: liftData.length,
        dragPoints: dragData.length
      })
    };

    console.log('üêõ Wind Tunnel Debug Commands:');
    console.log('  windTunnelDebug.setAngle(-45 to 45) - Set angle');
    console.log('  windTunnelDebug.setFanSpeed(0-100) - Set fan speed');
    console.log('  windTunnelDebug.startSweep() - Start angle sweep');
    console.log('  windTunnelDebug.clearGraph() - Clear graph data');
    console.log('  windTunnelDebug.reinitializeGraph() - Reinitialize chart');
    console.log('  windTunnelDebug.generateCurve() - Generate realistic curve');
    console.log('  windTunnelDebug.checkChart() - Check chart status');
    console.log('  windTunnelDebug.getCurrentData() - Get current readings');
  })();
</script>

</body>
</html>
