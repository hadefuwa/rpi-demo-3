<section id="screen-electrical-machines" class="screen" aria-label="Electrical Machines">
  <header class="em-header">
    <div class="power-readings">
      <div class="reading">
        <span class="reading-label">‚ö° Power In</span>
        <span id="power-in">2.127W</span>
      </div>
      <div class="reading">
        <span class="reading-label">üîå Power Out</span>
        <span id="power-out">36.836W</span>
      </div>
      <div class="reading">
        <span class="reading-label">üìê Phase Angle</span>
        <span id="phase-angle">55¬∞</span>
      </div>
    </div>
    
    <div class="logo-section">
      <div class="matrix-logo">MATRIX</div>
      <div class="subtitle">ELECTRICAL MACHINES</div>
    </div>
    
         <div class="firmware-info">
       <div class="firmware-version">Firmware Version: 1</div>
       <div class="status-indicators">
         <div class="indicator dyno">DYNO</div>
         <div class="indicator connector">3PH</div>
       </div>
       <div class="voltage-readings">
         <div class="reading">
           <span class="reading-label">‚ö° Supply Voltage</span>
           <span id="supply-voltage">35.9V</span>
         </div>
         <div class="reading">
           <span class="reading-label">üõ°Ô∏è Limit Voltage</span>
           <span id="limit-voltage">30.0V</span>
         </div>
       </div>
     </div>
     
     <button id="btnHome" class="home-button" aria-label="Home">HOME</button>
  </header>

  <main class="em-main">
    <!-- Left Control Panel -->
    <section class="control-panel">
      <div class="control-column">
        <div class="control-label">Load</div>
        <div class="control-value" id="load-value">50.0%</div>
                           <div class="horizontal-slider">
           <div class="slider-track" id="load-track">
             <div class="slider-fill" id="load-fill"></div>
             <div class="slider-thumb" id="load-thumb"></div>
           </div>
           <div class="slider-scale">
             <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
           </div>
         </div>
        <button class="control-btn">Set %</button>
      </div>

      <div class="control-column">
        <div class="control-label">Voltage 1</div>
        <div class="control-value" id="voltage1-value">66.7% - 20.0V</div>
                           <div class="horizontal-slider">
           <div class="slider-track" id="voltage1-track">
             <div class="slider-fill" id="voltage1-fill"></div>
             <div class="slider-thumb" id="voltage1-thumb"></div>
           </div>
           <div class="slider-scale">
             <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
           </div>
         </div>
        <button class="control-btn">Set V</button>
        <button class="control-btn">Set %</button>
      </div>

      <div class="control-column">
        <div class="control-label">Frequency</div>
        <div class="control-value" id="frequency-value">50Hz</div>
                           <div class="horizontal-slider">
           <div class="slider-track" id="frequency-track">
             <div class="slider-fill" id="frequency-fill"></div>
             <div class="slider-thumb" id="frequency-thumb"></div>
           </div>
           <div class="slider-scale">
             <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
           </div>
         </div>
        <button class="control-btn">Set</button>
      </div>

      <div class="control-column">
        <div class="control-label">Submodule Drive</div>
        <div class="control-value" id="submodule-value">0.0% - 0.0V</div>
                           <div class="horizontal-slider">
           <div class="slider-track" id="submodule-track">
             <div class="slider-fill" id="submodule-fill"></div>
             <div class="slider-thumb" id="submodule-thumb"></div>
           </div>
           <div class="slider-scale">
             <span>-50</span><span>-25</span><span>0</span><span>25</span><span>50</span>
           </div>
         </div>
        <button class="control-btn">Set V</button>
        <button class="control-btn">Set %</button>
      </div>
    </section>

    <!-- Bottom Left Gauges -->
    <section class="gauges-section">
      <div class="motor-controls">
        <div class="motor-toggle">
          <div class="toggle-label">Motor</div>
          <div class="toggle-switch">
            <button class="toggle-btn stop-btn active">Stop</button>
            <button class="toggle-btn run-btn">Run</button>
          </div>
        </div>
      </div>
      
      <div class="gauge speed-gauge">
        <div class="gauge-label">Speed</div>
        <div class="gauge-value" id="speed-value">1143RPM</div>
                 <div class="gauge-visual">
           <svg class="gauge-svg" viewBox="0 0 200 200">
             <defs>
               <linearGradient id="speedGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                 <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
                 <stop offset="100%" style="stop-color:#8BC34A;stop-opacity:1" />
               </linearGradient>
             </defs>
             <circle class="gauge-bg" cx="100" cy="100" r="80"></circle>
             <circle class="gauge-fill" id="speed-fill" cx="100" cy="100" r="80" style="stroke: url(#speedGradient)"></circle>
             <line class="gauge-needle" id="speed-needle" x1="100" y1="100" x2="100" y2="30"></line>
             <!-- Gauge ticks -->
             <g class="gauge-ticks">
               <line x1="100" y1="20" x2="100" y2="30" stroke="#fff" stroke-width="2"/>
               <line x1="180" y1="100" x2="170" y2="100" stroke="#fff" stroke-width="2"/>
               <line x1="20" y1="100" x2="30" y2="100" stroke="#fff" stroke-width="2"/>
             </g>
           </svg>
          <div class="gauge-scale">
            <span class="scale-mark">0.0</span>
            <span class="scale-mark">800.0</span>
            <span class="scale-mark">1600.0</span>
            <span class="scale-mark">2400.0</span>
            <span class="scale-mark">3200.0</span>
          </div>
        </div>
      </div>

      <div class="gauge torque-gauge">
        <div class="gauge-label">Torque</div>
        <div class="gauge-value" id="torque-value">0.140NM</div>
                 <div class="gauge-visual">
           <svg class="gauge-svg" viewBox="0 0 200 200">
             <defs>
               <linearGradient id="torqueGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                 <stop offset="0%" style="stop-color:#2196F3;stop-opacity:1" />
                 <stop offset="100%" style="stop-color:#03DAC6;stop-opacity:1" />
               </linearGradient>
             </defs>
             <circle class="gauge-bg" cx="100" cy="100" r="80"></circle>
             <circle class="gauge-fill" id="torque-fill" cx="100" cy="100" r="80" style="stroke: url(#torqueGradient)"></circle>
             <line class="gauge-needle" id="torque-needle" x1="100" y1="100" x2="100" y2="30"></line>
             <!-- Gauge ticks -->
             <g class="gauge-ticks">
               <line x1="100" y1="20" x2="100" y2="30" stroke="#fff" stroke-width="2"/>
               <line x1="180" y1="100" x2="170" y2="100" stroke="#fff" stroke-width="2"/>
               <line x1="20" y1="100" x2="30" y2="100" stroke="#fff" stroke-width="2"/>
             </g>
           </svg>
          <div class="gauge-scale">
            <span class="scale-mark">-50.0</span>
            <span class="scale-mark">50.0</span>
            <span class="scale-mark">100.0</span>
            <span class="scale-mark">150.0</span>
            <span class="scale-mark">200.0</span>
            <span class="scale-mark">250.0</span>
          </div>
                 </div>
       </div>
    </section>

    <!-- Bottom Right Action Buttons -->
    <section class="action-buttons">
      <div class="action-btn">
        <div class="btn-indicator"></div>
        <span>Capture</span>
      </div>
      <div class="action-btn">
        <div class="btn-indicator"></div>
        <span>Sweep</span>
      </div>
      <div class="action-btn">
        <div class="btn-indicator"></div>
        <span>Clear</span>
      </div>
    </section>

    <!-- Right Chart Area -->
    <section class="charts-section">
      <div class="chart voltage-chart">
        <div class="chart-title">Voltage vs Phase Angle</div>
        <div class="chart-container">
          <canvas id="voltage-canvas" width="600" height="200"></canvas>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color dc1"></span>
              <span>DC1/X</span>
            </div>
            <div class="legend-item">
              <span class="legend-color dc2"></span>
              <span>DC2/U</span>
            </div>
            <div class="legend-item">
              <span class="legend-color va"></span>
              <span>V/A</span>
            </div>
            <div class="legend-item">
              <span class="legend-color wb"></span>
              <span>W/B</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chart current-chart">
        <div class="chart-title">Current vs Phase Angle</div>
        <div class="chart-container">
          <canvas id="current-canvas" width="600" height="200"></canvas>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color dc1"></span>
              <span>DC1/X</span>
            </div>
            <div class="legend-item">
              <span class="legend-color dc2"></span>
              <span>DC2/U</span>
            </div>
            <div class="legend-item">
              <span class="legend-color va"></span>
              <span>V/A</span>
            </div>
            <div class="legend-item">
              <span class="legend-color wb"></span>
              <span>W/B</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

     <footer class="em-footer">
   </footer>
</section>

<style>
/* All styles strictly scoped to #screen-electrical-machines */
#screen-electrical-machines { 
  width: 100%; 
  height: 100vh; 
  background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%); 
  color: #ffffff; 
  font-family: 'Arial', sans-serif; 
  overflow: hidden; 
  display: flex;
  flex-direction: column;
}

#screen-electrical-machines * { 
  box-sizing: border-box; 
  touch-action: manipulation; 
  user-select: none; 
}

/* Header */
.em-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 15px;
  background: #1a1a1a;
  border-bottom: 2px solid #444;
  height: 70px;
}

.logo-section {
  text-align: center;
  flex: 1;
}

.matrix-logo {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  letter-spacing: 2px;
  text-shadow: 0 0 10px rgba(255,255,255,0.5);
}

.subtitle {
  font-size: 12px;
  color: #ccc;
  margin-top: 1px;
}

.firmware-info {
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.firmware-version {
  font-size: 12px;
  color: #ccc;
}

.status-indicators {
  display: flex;
  align-items: center;
  gap: 15px;
  background: #333;
  padding: 6px 12px;
  border-radius: 4px;
  position: relative;
}

.status-indicators::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 4px;
  height: 4px;
  background: #666;
  border-radius: 50%;
}

.indicator {
  font-size: 11px;
  color: #fff;
  padding: 3px 6px;
  border-radius: 3px;
  background: #000;
}

.power-readings {
  display: flex;
  flex-direction: column;
  gap: 6px;
  text-align: left;
  background: rgba(0,0,0,0.3);
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  min-width: 120px;
  max-width: 130px;
  position: relative;
  overflow: hidden;
}

.power-readings::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #4CAF50, #8BC34A);
  opacity: 0.7;
}

.reading {
  font-size: 10px;
  color: #ccc;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  font-weight: 500;
  line-height: 1.2;
}

.reading:last-child {
  border-bottom: none;
}

.reading-label {
  color: #ccc;
  font-weight: 500;
  font-size: 10px;
}

.reading span:not(.reading-label) {
  color: #4CAF50;
  font-weight: bold;
  font-size: 11px;
  text-shadow: 0 0 4px rgba(76, 175, 80, 0.5);
  background: rgba(76, 175, 80, 0.1);
  padding: 1px 4px;
  border-radius: 3px;
  border: 1px solid rgba(76, 175, 80, 0.3);
  transition: all 0.3s ease;
}

.power-readings:hover {
  border-color: rgba(76, 175, 80, 0.3);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 8px rgba(76, 175, 80, 0.2);
  transform: translateY(-1px);
}

.power-readings:hover .reading span:not(.reading-label) {
  background: rgba(76, 175, 80, 0.2);
  border-color: rgba(76, 175, 80, 0.5);
  text-shadow: 0 0 6px rgba(76, 175, 80, 0.7);
  transform: scale(1.05);
}

.voltage-readings {
  display: flex;
  flex-direction: column;
  gap: 6px;
  text-align: center;
  background: rgba(0,0,0,0.3);
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  min-width: 120px;
  max-width: 130px;
  position: relative;
  overflow: hidden;
}

.voltage-readings::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #2196F3, #4CAF50);
  opacity: 0.7;
}

.voltage-readings .reading span:not(.reading-label) {
  color: #2196F3;
  font-weight: bold;
  font-size: 11px;
  text-shadow: 0 0 4px rgba(33, 150, 243, 0.5);
  background: rgba(33, 150, 243, 0.1);
  padding: 1px 4px;
  border-radius: 3px;
  border: 1px solid rgba(33, 150, 243, 0.3);
  transition: all 0.3s ease;
}

.voltage-readings:hover {
  border-color: rgba(33, 150, 243, 0.3);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 8px rgba(33, 150, 243, 0.2);
  transform: translateY(-1px);
}

.voltage-readings:hover .reading span:not(.reading-label) {
  background: rgba(33, 150, 243, 0.2);
  border-color: rgba(33, 150, 243, 0.5);
  text-shadow: 0 0 6px rgba(33, 150, 243, 0.7);
  transform: scale(1.05);
}

/* Main Layout */
.em-main {
  display: grid;
  grid-template-columns: 400px 1fr;
  grid-template-rows: 1fr 200px;
  gap: 20px;
  padding: 20px;
  flex: 1;
  height: calc(100vh - 150px);
}

/* Control Panel */
.control-panel {
  background: #333;
  border-radius: 12px;
  padding: 20px;
  display: flex;
  gap: 20px;
  align-items: flex-start;
  grid-row: 1 / 3;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  border: 1px solid #444;
}

.control-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.05);
  min-height: 400px;
}

.control-label {
  font-size: 14px;
  color: #ccc;
  font-weight: bold;
  margin-bottom: 5px;
}

.control-value {
  font-size: 13px;
  color: #fff;
  background: #222;
  padding: 8px 12px;
  border-radius: 6px;
  min-width: 100px;
  text-align: center;
  font-weight: 500;
  border: 1px solid #444;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
}

.horizontal-slider {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 8px;
}

.slider-track {
  width: 100%;
  height: 8px;
  background: #222;
  border-radius: 4px;
  position: relative;
  border: 2px solid #555;
  cursor: pointer;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}

.slider-track:hover {
  border-color: #4CAF50;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 8px rgba(76, 175, 80, 0.3);
}

.slider-track:active {
  border-color: #45a049;
}

.slider-fill {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  background: linear-gradient(to right, #4CAF50, #8BC34A);
  border-radius: 2px;
  transition: width 0.3s ease;
  box-shadow: 0 0 4px rgba(76, 175, 80, 0.5);
}

.slider-thumb {
  position: absolute;
  top: -6px;
  width: 20px;
  height: 20px;
  background: #fff;
  border-radius: 50%;
  border: 2px solid #4CAF50;
  cursor: grab;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  transform: translateX(-50%);
}

.slider-thumb:active {
  cursor: grabbing;
  transform: translateX(-50%) scale(1.2);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

.slider-thumb:hover {
  background: #4CAF50;
  border-color: #45a049;
  transform: translateX(-50%) scale(1.1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 8px rgba(76, 175, 80, 0.5);
}

.slider-scale {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: #999;
  width: 100%;
  font-weight: 500;
  padding: 0 10px;
}

.control-btn {
  background: #555;
  color: #fff;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 80px;
  font-weight: 500;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  border: 1px solid #666;
}

.control-btn:hover {
  background: #666;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.control-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.control-btn.active {
  background: #2196F3;
  border-color: #1976D2;
  box-shadow: 0 0 8px rgba(33, 150, 243, 0.3);
}

/* Gauges Section */
.gauges-section {
  background: #333;
  border-radius: 12px;
  padding: 20px;
  display: flex;
  gap: 20px;
  align-items: center;
  grid-column: 2;
  grid-row: 2;
}

.motor-controls {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.motor-toggle {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.toggle-label {
  font-size: 12px;
  color: #ccc;
  font-weight: bold;
}

.toggle-switch {
  display: flex;
  background: #222;
  border-radius: 4px;
  padding: 2px;
  gap: 2px;
}

.toggle-btn {
  background: #555;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 3px;
  font-size: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 50px;
}

.toggle-btn.active {
  background: #2196F3;
}

.toggle-btn.stop-btn.active {
  background: #f44336;
}

.toggle-btn.run-btn.active {
  background: #4CAF50;
}

.gauge {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.gauge-label {
  font-size: 14px;
  color: #ccc;
  font-weight: bold;
}

.gauge-value {
  font-size: 16px;
  color: #fff;
  font-weight: bold;
}

.gauge-visual {
  position: relative;
  width: 120px;
  height: 120px;
  background: rgba(0,0,0,0.2);
  border-radius: 50%;
  padding: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
}

.gauge-svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

.gauge-bg {
  fill: none;
  stroke: #333;
  stroke-width: 8;
  opacity: 0.8;
}

.gauge-fill {
  fill: none;
  stroke: url(#gaugeGradient);
  stroke-width: 8;
  stroke-linecap: round;
  stroke-dasharray: 502;
  stroke-dashoffset: 502;
  transition: stroke-dashoffset 0.5s ease;
  filter: drop-shadow(0 0 4px rgba(76, 175, 80, 0.5));
}

.gauge-needle {
  stroke: #fff;
  stroke-width: 3;
  transform-origin: 100px 100px;
  transition: transform 0.5s ease;
  filter: drop-shadow(0 0 2px rgba(255,255,255,0.5));
}

.gauge-ticks {
  stroke: #fff;
  stroke-width: 2;
}

.gauge-scale {
  position: absolute;
  bottom: -25px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  font-size: 9px;
  color: #ccc;
  font-weight: 500;
  padding: 0 5px;
}

.scale-mark {
  background: rgba(0,0,0,0.3);
  padding: 2px 4px;
  border-radius: 3px;
  border: 1px solid rgba(255,255,255,0.1);
  font-size: 8px;
  color: #aaa;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.zero-btn {
  background: #666;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-top: 8px;
}

.zero-btn:hover {
  background: #777;
}

/* Action Buttons */
.action-buttons {
  background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
  border-radius: 12px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  grid-column: 2;
  grid-row: 2;
  align-self: end;
  width: 150px;
  border: 1px solid #444;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
}

.action-buttons::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0);
  border-radius: 12px 12px 0 0;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: linear-gradient(135deg, #555 0%, #444 100%);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid #666;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
}

.action-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transition: left 0.5s ease;
}

.action-btn:hover::before {
  left: 100%;
}

.action-btn:hover {
  background: linear-gradient(135deg, #666 0%, #555 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  border-color: #777;
}

.action-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.btn-indicator {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #999;
  border: 2px solid #777;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  position: relative;
}

.btn-indicator::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
}

/* Specific button styling */
.action-btn:nth-child(1) .btn-indicator {
  background: #4CAF50;
  border-color: #45a049;
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
}

.action-btn:nth-child(2) .btn-indicator {
  background: #2196F3;
  border-color: #1976D2;
  box-shadow: 0 0 8px rgba(33, 150, 243, 0.3);
}

.action-btn:nth-child(3) .btn-indicator {
  background: #f44336;
  border-color: #d32f2f;
  box-shadow: 0 0 8px rgba(244, 67, 54, 0.3);
}

.action-btn:nth-child(1):hover {
  border-color: #4CAF50;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 0 8px rgba(76, 175, 80, 0.2);
}

.action-btn:nth-child(2):hover {
  border-color: #2196F3;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 0 8px rgba(33, 150, 243, 0.2);
}

.action-btn:nth-child(3):hover {
  border-color: #f44336;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 0 8px rgba(244, 67, 54, 0.2);
}

/* Charts Section */
.charts-section {
  background: #333;
  border-radius: 12px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  grid-column: 2;
  grid-row: 1;
  overflow: hidden;
  min-height: 0;
}

.chart {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.chart-title {
  font-size: 14px;
  color: #ccc;
  font-weight: bold;
  margin-bottom: 10px;
}

.chart-container {
  flex: 1;
  position: relative;
  background: #222;
  border-radius: 8px;
  padding: 10px;
  width: 100%;
  height: 100%;
}

.chart-legend {
  position: absolute;
  right: 15px;
  top: 15px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  background: rgba(0,0,0,0.7);
  padding: 8px;
  border-radius: 4px;
  border: 1px solid rgba(255,255,255,0.1);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 10px;
  color: #ccc;
}

.legend-color {
  width: 12px;
  height: 2px;
  border-radius: 1px;
}

.legend-color.dc1 { background: #2196F3; }
.legend-color.dc2 { background: #f44336; }
.legend-color.va { background: #4CAF50; }
.legend-color.wb { background: #9C27B0; }

/* Footer */
.em-footer {
  height: 50px;
  padding: 8px 20px;
  background: #1a1a1a;
  border-top: 2px solid #444;
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

 .home-button { 
   padding: 8px 16px;
   border-radius: 6px; 
   background: rgba(255, 255, 255, 0.1); 
   border: 1px solid rgba(255, 255, 255, 0.2); 
   color: #fff; 
   cursor: pointer; 
   transition: all 0.2s ease; 
   font-size: 12px;
   font-weight: 500;
   text-transform: uppercase;
   letter-spacing: 1px;
 }

 .home-button:hover { 
   background: rgba(255, 255, 255, 0.2); 
   border-color: rgba(255, 255, 255, 0.3);
   transform: translateY(-1px);
   box-shadow: 0 2px 4px rgba(0,0,0,0.3);
 }
 
 .home-button:active { 
   transform: translateY(0);
   box-shadow: 0 1px 2px rgba(0,0,0,0.2);
 }

/* Responsive adjustments */
@media (max-width: 1200px) {
  .em-main {
    grid-template-columns: 350px 1fr;
    gap: 15px;
    padding: 15px;
  }
  
  .control-panel {
    padding: 15px;
    gap: 15px;
  }
  
  .control-column {
    gap: 8px;
  }
  
  .horizontal-slider {
    width: 100%;
  }
  
  .slider-track {
    height: 6px;
  }
  
  .slider-thumb {
    width: 18px;
    height: 18px;
    top: -5px;
  }
  
  .slider-scale {
    font-size: 9px;
  }
  
  .control-value {
    font-size: 12px;
    min-width: 90px;
    padding: 6px 10px;
  }
  
  .control-btn {
    font-size: 11px;
    padding: 8px 14px;
    min-width: 70px;
  }
}

@media (max-width: 900px) {
  .em-main {
    grid-template-columns: 300px 1fr;
    gap: 12px;
    padding: 12px;
  }
  
  .control-panel {
    padding: 12px;
    gap: 12px;
  }
  
  .horizontal-slider {
    width: 100%;
  }
  
  .slider-track {
    height: 5px;
  }
  
  .slider-thumb {
    width: 16px;
    height: 16px;
    top: -4px;
  }
  
  .slider-scale {
    font-size: 8px;
  }
  
  .charts-section {
    padding: 15px;
  }
  
  .chart-title {
    font-size: 13px;
  }
}

@media (max-width: 768px) {
  .em-header {
    flex-direction: column;
    height: auto;
    padding: 10px;
    gap: 10px;
  }
  
  .power-readings, .voltage-readings {
    flex-direction: row;
    gap: 15px;
    min-width: auto;
    padding: 8px;
  }
  
  .reading {
    font-size: 10px;
    padding: 2px 0;
  }
  
  .reading-label {
    font-size: 10px;
  }
  
  .reading span:not(.reading-label) {
    font-size: 11px;
    padding: 1px 4px;
  }
  
  .em-main {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto auto;
    gap: 12px;
    padding: 12px;
    height: auto;
  }
  
  .control-panel {
    grid-row: 1;
    grid-column: 1;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    padding: 15px;
  }
  
  .control-column {
    min-width: 120px;
    max-width: 150px;
  }
  
  .horizontal-slider {
    width: 100%;
  }
  
  .slider-track {
    height: 4px;
  }
  
  .slider-thumb {
    width: 14px;
    height: 14px;
    top: -3px;
  }
  
  .slider-scale {
    font-size: 7px;
  }
  
  .charts-section {
    grid-row: 2;
    grid-column: 1;
    padding: 12px;
  }
  
  .chart-container {
    padding: 8px;
  }
  
  .gauges-section {
    grid-row: 3;
    grid-column: 1;
    flex-direction: column;
    gap: 15px;
    padding: 15px;
  }
  
  .gauge {
    flex-direction: row;
    align-items: center;
    gap: 15px;
  }
  
  .gauge-visual {
    width: 100px;
    height: 100px;
  }
  
  .action-buttons {
    grid-row: 4;
    grid-column: 1;
    flex-direction: row;
    width: auto;
    align-self: center;
    justify-content: center;
    gap: 15px;
    padding: 15px;
  }
  
  .action-btn {
    flex-direction: column;
    align-items: center;
    gap: 5px;
    padding: 10px;
    min-width: 80px;
  }
}

@media (max-width: 480px) {
  .em-header {
    padding: 8px;
  }
  
  .matrix-logo {
    font-size: 24px;
  }
  
  .subtitle {
    font-size: 12px;
  }
  
  .em-main {
    padding: 8px;
    gap: 8px;
  }
  
  .control-panel {
    padding: 10px;
    gap: 10px;
  }
  
  .control-column {
    min-width: 100px;
    max-width: 120px;
  }
  
  .horizontal-slider {
    width: 100%;
  }
  
  .slider-track {
    height: 3px;
  }
  
  .slider-thumb {
    width: 12px;
    height: 12px;
    top: -2px;
  }
  
  .slider-scale {
    font-size: 6px;
  }
  
  .control-value {
    font-size: 10px;
    min-width: 70px;
    padding: 4px 6px;
  }
  
  .control-btn {
    font-size: 10px;
    padding: 6px 10px;
    min-width: 60px;
  }
  
  .gauges-section {
    padding: 10px;
  }
  
  .gauge-visual {
    width: 80px;
    height: 80px;
  }
  
  .gauge-value {
    font-size: 14px;
  }
  
  .action-buttons {
    padding: 10px;
    gap: 10px;
  }
  
  .action-btn {
    min-width: 70px;
    padding: 8px;
  }
}
</style>

<script>
(function() {
  'use strict';
  const root = document.getElementById('screen-electrical-machines');
  
  // Canvas elements
  const voltageCanvas = root.querySelector('#voltage-canvas');
  const currentCanvas = root.querySelector('#current-canvas');
  const voltageCtx = voltageCanvas.getContext('2d');
  const currentCtx = currentCanvas.getContext('2d');
  
  // Control elements
  const loadValue = root.querySelector('#load-value');
  const voltage1Value = root.querySelector('#voltage1-value');
  const frequencyValue = root.querySelector('#frequency-value');
  const submoduleValue = root.querySelector('#submodule-value');
  
  // Gauge elements
  const speedValue = root.querySelector('#speed-value');
  const torqueValue = root.querySelector('#torque-value');
  const speedFill = root.querySelector('#speed-fill');
  const torqueFill = root.querySelector('#torque-fill');
  const speedNeedle = root.querySelector('#speed-needle');
  const torqueNeedle = root.querySelector('#torque-needle');
  
  // Power readings
  const powerIn = root.querySelector('#power-in');
  const powerOut = root.querySelector('#power-out');
  const phaseAngle = root.querySelector('#phase-angle');
  const supplyVoltage = root.querySelector('#supply-voltage');
  const limitVoltage = root.querySelector('#limit-voltage');
  
  // State
  let animationId = 0;
  let phase = 0;
  let isRunning = false;
  let isDragging = false;
  let currentSlider = null;
  
  // Slider values
  let sliderValues = {
    load: 50,
    voltage1: 66.7,
    frequency: 50,
    submodule: 0
  };
  
  // Initialize charts
  function initCharts() {
    // Set canvas size to fill the full container
    const voltageRect = voltageCanvas.parentElement.getBoundingClientRect();
    const currentRect = currentCanvas.parentElement.getBoundingClientRect();
    
    // Account for padding and legend space
    const legendWidth = 80; // Approximate legend width
    const padding = 20; // Account for container padding
    
    voltageCanvas.width = voltageRect.width - padding - legendWidth;
    voltageCanvas.height = voltageRect.height - padding;
    currentCanvas.width = currentRect.width - padding - legendWidth;
    currentCanvas.height = currentRect.height - padding;
    
    // Set canvas style to fill container
    voltageCanvas.style.width = '100%';
    voltageCanvas.style.height = '100%';
    currentCanvas.style.width = '100%';
    currentCanvas.style.height = '100%';
    
    drawCharts();
  }
  
  // Draw charts with animated waveforms
  function drawCharts() {
    // Clear canvases
    voltageCtx.clearRect(0, 0, voltageCanvas.width, voltageCanvas.height);
    currentCtx.clearRect(0, 0, currentCanvas.width, currentCanvas.height);
    
    // Draw grid
    drawGrid(voltageCtx, voltageCanvas.width, voltageCanvas.height, -10, 10, 0, 350);
    drawGrid(currentCtx, currentCanvas.width, currentCanvas.height, -4, 4, 0, 350);
    
    // Update phase for animation
    phase += 0.02;
    
    // Draw waveforms with enhanced styling and animation
    const voltageAmplitude = 8 + Math.sin(phase * 0.5) * 2;
    const currentAmplitude = 3 + Math.sin(phase * 0.3) * 1;
    
    drawWaveform(voltageCtx, voltageCanvas.width, voltageCanvas.height, -10, 10, 0, 350, '#2196F3', 'flat', 0, 1); // DC1/X - flat line
    drawWaveform(voltageCtx, voltageCanvas.width, voltageCanvas.height, -10, 10, 0, 350, '#f44336', 'sine', phase, 3, voltageAmplitude); // DC2/U - highlighted sine
    drawWaveform(voltageCtx, voltageCanvas.width, voltageCanvas.height, -10, 10, 0, 350, '#9C27B0', 'sine', phase + Math.PI/4, 2, voltageAmplitude * 0.8); // V/A - purple sine
    drawWaveform(voltageCtx, voltageCanvas.width, voltageCanvas.height, -10, 10, 0, 350, '#4CAF50', 'sine', phase + Math.PI/2, 2, voltageAmplitude * 0.6); // W/B - green sine
    
    drawWaveform(currentCtx, currentCanvas.width, currentCanvas.height, -4, 4, 0, 350, '#2196F3', 'flat', 0, 1); // DC1/X - flat line
    drawWaveform(currentCtx, currentCanvas.width, currentCanvas.height, -4, 4, 0, 350, '#f44336', 'sine', phase, 3, currentAmplitude); // DC2/U - highlighted sine
    drawWaveform(currentCtx, currentCanvas.width, currentCanvas.height, -4, 4, 0, 350, '#9C27B0', 'sine', phase + Math.PI/4, 2, currentAmplitude * 0.8); // V/A - purple sine
    drawWaveform(currentCtx, currentCanvas.width, currentCanvas.height, -4, 4, 0, 350, '#4CAF50', 'sine', phase + Math.PI/2, 2, currentAmplitude * 0.6); // W/B - green sine
  }
  
  // Draw grid
  function drawGrid(ctx, width, height, yMin, yMax, xMin, xMax) {
    ctx.strokeStyle = '#444';
    ctx.lineWidth = 1;
    
    // Vertical lines
    for (let x = xMin; x <= xMax; x += 50) {
      const xPos = (x - xMin) / (xMax - xMin) * width;
      ctx.beginPath();
      ctx.moveTo(xPos, 0);
      ctx.lineTo(xPos, height);
      ctx.stroke();
    }
    
    // Horizontal lines
    for (let y = yMin; y <= yMax; y += 2) {
      const yPos = height - (y - yMin) / (yMax - yMin) * height;
      ctx.beginPath();
      ctx.moveTo(0, yPos);
      ctx.lineTo(width, yPos);
      ctx.stroke();
    }
  }
  
  // Draw waveform with enhanced styling and amplitude control
  function drawWaveform(ctx, width, height, yMin, yMax, xMin, xMax, color, type, phaseOffset, lineWidth = 2, amplitude = null) {
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth;
    ctx.beginPath();
    
    const points = [];
    const waveAmplitude = amplitude || (yMax - yMin) / 2;
    
    for (let x = 0; x < width; x++) {
      const xVal = (x / width) * (xMax - xMin) + xMin;
      let yVal = 0;
      
      switch (type) {
        case 'sine':
          yVal = Math.sin((xVal * Math.PI / 180) + phaseOffset) * waveAmplitude;
          break;
        case 'square':
          yVal = Math.sin((xVal * Math.PI / 180) + phaseOffset) > 0 ? waveAmplitude : -waveAmplitude;
          break;
        case 'flat':
          yVal = 0;
          break;
      }
      
      const yPos = height - (yVal - yMin) / (yMax - yMin) * height;
      points.push({x, y: yPos});
      
      if (x === 0) {
        ctx.moveTo(x, yPos);
      } else {
        ctx.lineTo(x, yPos);
      }
    }
    
    ctx.stroke();
    
    // Add dots for highlighted waveforms (DC2/U)
    if (color === '#f44336' && type === 'sine') {
      ctx.fillStyle = color;
      points.forEach((point, index) => {
        if (index % 20 === 0) { // Add dots every 20 pixels
          ctx.beginPath();
          ctx.arc(point.x, point.y, 3, 0, 2 * Math.PI);
          ctx.fill();
        }
      });
    }
  }
  
  // Update gauges
  function updateGauges() {
    // Speed gauge (0-3200 RPM)
    const speedPercent = Math.min(100, Math.max(0, (parseInt(speedValue.textContent) / 3200) * 100));
    const speedAngle = (speedPercent / 100) * 180 - 90;
    const speedCircumference = 2 * Math.PI * 80;
    speedFill.style.strokeDashoffset = speedCircumference - (speedPercent / 100) * speedCircumference;
    speedNeedle.style.transform = `rotate(${speedAngle}deg)`;
    
    // Torque gauge (-50 to 250 NM)
    const torqueVal = parseFloat(torqueValue.textContent);
    const torquePercent = Math.min(100, Math.max(0, ((torqueVal + 50) / 300) * 100));
    const torqueAngle = (torquePercent / 100) * 180 - 90;
    const torqueCircumference = 2 * Math.PI * 80;
    torqueFill.style.strokeDashoffset = torqueCircumference - (torquePercent / 100) * torqueCircumference;
    torqueNeedle.style.transform = `rotate(${torqueAngle}deg)`;
  }
  
  // Update controls based on slider values
  function updateControls() {
    if (!isRunning) return;
    
    // Add some variation to the slider values
    const time = Date.now() / 1000;
    const loadVariation = Math.sin(time * 0.3) * 5;
    const voltageVariation = Math.sin(time * 0.4) * 3;
    const frequencyVariation = Math.sin(time * 0.2) * 1;
    const submoduleVariation = Math.sin(time * 0.5) * 10;
    
    const load = Math.max(0, Math.min(100, sliderValues.load + loadVariation));
    const voltage1 = Math.max(0, Math.min(100, sliderValues.voltage1 + voltageVariation));
    const frequency = Math.max(0, Math.min(100, sliderValues.frequency + frequencyVariation));
    const submodule = Math.max(-50, Math.min(50, sliderValues.submodule + submoduleVariation));
    
    loadValue.textContent = `${load.toFixed(1)}%`;
    voltage1Value.textContent = `${voltage1.toFixed(1)}% - ${(voltage1 * 0.3).toFixed(1)}V`;
    frequencyValue.textContent = `${frequency.toFixed(0)}Hz`;
    submoduleValue.textContent = `${submodule.toFixed(1)}% - ${(submodule * 0.3).toFixed(1)}V`;
    
    // Update slider indicators
    updateSlider('load', load);
    updateSlider('voltage1', voltage1);
    updateSlider('frequency', frequency);
    updateSlider('submodule', submodule + 50);
  }
  
  // Update slider visual
  function updateSlider(name, value) {
    const fill = root.querySelector(`#${name}-fill`);
    const thumb = root.querySelector(`#${name}-thumb`);
    
    if (fill && thumb) {
      const percent = Math.min(100, Math.max(0, value));
      fill.style.width = `${percent}%`;
      thumb.style.left = `${percent}%`;
    }
  }
  
  // Handle slider interaction
  function handleSliderInteraction(sliderName, event) {
    const track = event.currentTarget;
    const rect = track.getBoundingClientRect();
    const clickX = event.clientX - rect.left;
    const width = rect.width;
    const percent = Math.max(0, Math.min(100, (clickX / width) * 100));
    
    // Update slider value
    if (sliderName === 'submodule') {
      sliderValues[sliderName] = percent - 50; // -50 to 50 range
    } else {
      sliderValues[sliderName] = percent;
    }
    
    // Update visual
    updateSlider(sliderName, sliderName === 'submodule' ? percent : sliderValues[sliderName]);
    
    // Update display value
    updateControlDisplay(sliderName);
  }
  
  // Update control display
  function updateControlDisplay(sliderName) {
    const value = sliderValues[sliderName];
    switch (sliderName) {
      case 'load':
        loadValue.textContent = `${value.toFixed(1)}%`;
        break;
      case 'voltage1':
        voltage1Value.textContent = `${value.toFixed(1)}% - ${(value * 0.3).toFixed(1)}V`;
        break;
      case 'frequency':
        frequencyValue.textContent = `${value.toFixed(0)}Hz`;
        break;
      case 'submodule':
        submoduleValue.textContent = `${value.toFixed(1)}% - ${(value * 0.3).toFixed(1)}V`;
        break;
    }
  }
  
  // Update power readings
  function updatePowerReadings() {
    if (!isRunning) return;
    
    const time = Date.now() / 1000;
    const powerInVal = 2.127 + Math.sin(time) * 0.5;
    const powerOutVal = 36.836 + Math.sin(time * 0.5) * 2;
    const phaseAngleVal = 55 + Math.sin(time * 0.3) * 5;
    const supplyVoltageVal = 35.9 + Math.sin(time * 0.7) * 1;
    
    powerIn.textContent = `${powerInVal.toFixed(3)}W`;
    powerOut.textContent = `${powerOutVal.toFixed(3)}W`;
    phaseAngle.textContent = `${Math.round(phaseAngleVal)}¬∞`;
    supplyVoltage.textContent = `${supplyVoltageVal.toFixed(1)}V`;
  }
  
  // Update speed and torque
  function updateSpeedTorque() {
    if (!isRunning) return;
    
    const time = Date.now() / 1000;
    const speed = 1143 + Math.sin(time * 0.5) * 100;
    const torque = 0.140 + Math.sin(time * 0.3) * 0.05;
    
    speedValue.textContent = `${Math.round(speed)}RPM`;
    torqueValue.textContent = `${torque.toFixed(3)}NM`;
    
    updateGauges();
  }
  
  // Animation loop
  function animate() {
    updateControls();
    updatePowerReadings();
    updateSpeedTorque();
    drawCharts();
    
    animationId = requestAnimationFrame(animate);
  }
  
  // Event handlers
  function setupEventHandlers() {
    // Home button
    const homeButton = root.querySelector('#btnHome');
    if (homeButton) {
      homeButton.addEventListener('click', () => {
        window.location.href = '../index.html';
      });
    }
    
    // Motor toggle buttons
    const toggleButtons = root.querySelectorAll('.toggle-btn');
    toggleButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        toggleButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update running state
        isRunning = btn.classList.contains('run-btn');
      });
    });
    
    // Slider interactions
    const sliderTracks = root.querySelectorAll('.slider-track');
    sliderTracks.forEach(track => {
      const sliderName = track.id.replace('-track', '');
      
      // Click to set value
      track.addEventListener('click', (e) => {
        handleSliderInteraction(sliderName, e);
      });
      
      // Drag functionality
      track.addEventListener('mousedown', (e) => {
        isDragging = true;
        currentSlider = sliderName;
        handleSliderInteraction(sliderName, e);
      });
    });
    
    // Global mouse events for dragging
    document.addEventListener('mousemove', (e) => {
      if (isDragging && currentSlider) {
        const track = root.querySelector(`#${currentSlider}-track`);
        if (track) {
          handleSliderInteraction(currentSlider, e);
        }
      }
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      currentSlider = null;
    });
    
             // Touch events for mobile
   sliderTracks.forEach(track => {
     const sliderName = track.id.replace('-track', '');
     
     track.addEventListener('touchstart', (e) => {
       e.preventDefault();
       isDragging = true;
       currentSlider = sliderName;
       const touch = e.touches[0];
       handleSliderInteraction(sliderName, { clientX: touch.clientX, currentTarget: track });
       
       // Add visual feedback
       track.style.borderColor = '#4CAF50';
       track.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.3), 0 0 12px rgba(76, 175, 80, 0.5)';
     });
     
     track.addEventListener('touchend', (e) => {
       e.preventDefault();
       isDragging = false;
       currentSlider = null;
       
       // Remove visual feedback
       track.style.borderColor = '#555';
       track.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.3)';
     });
   });
   
   document.addEventListener('touchmove', (e) => {
     if (isDragging && currentSlider) {
       e.preventDefault();
       const track = root.querySelector(`#${currentSlider}-track`);
       if (track) {
         const touch = e.touches[0];
         handleSliderInteraction(currentSlider, { clientX: touch.clientX, currentTarget: track });
       }
     }
   });
   
   document.addEventListener('touchend', () => {
     if (isDragging && currentSlider) {
       const track = root.querySelector(`#${currentSlider}-track`);
       if (track) {
         track.style.borderColor = '#555';
         track.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.3)';
       }
     }
     isDragging = false;
     currentSlider = null;
   });
    
    // Action buttons
    const actionButtons = root.querySelectorAll('.action-btn');
    actionButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        btn.style.background = '#666';
        setTimeout(() => {
          btn.style.background = '#555';
        }, 200);
      });
    });
    
    // Zero button
    const zeroBtn = root.querySelector('.zero-btn');
    if (zeroBtn) {
      zeroBtn.addEventListener('click', () => {
        speedValue.textContent = '0RPM';
        torqueValue.textContent = '0.000NM';
        updateGauges();
      });
    }
  }
  
  // Lifecycle functions
  function activate() {
    isRunning = true;
    initCharts();
    animate();
  }
  
  function deactivate() {
    isRunning = false;
    if (animationId) {
      cancelAnimationFrame(animationId);
    }
  }
  
  function cleanup() {
    deactivate();
  }
  
  // Initialize
  setupEventHandlers();
  
  // Handle window resize
  window.addEventListener('resize', () => {
    if (isRunning) {
      initCharts();
    }
  });
  
  // Export lifecycle
  window.appLifecycle = {
    activate,
    deactivate,
    cleanup
  };
  
  // Auto-init for standalone testing
  if (!window.showcaseFramework) {
    activate();
  }
})();
</script>
