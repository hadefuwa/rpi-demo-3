<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>AR Guidance System - RPI Showcase</title>
  
  <!-- Raspberry Pi Camera Detection Script - Simplified -->
  <script>
    // Simple RPi detection
    const isRaspberryPi = () => {
      const userAgent = navigator.userAgent.toLowerCase();
      return userAgent.includes('armv7l') || 
             userAgent.includes('armv6l') || 
             userAgent.includes('aarch64') ||
             (navigator.hardwareConcurrency <= 4 && navigator.deviceMemory <= 4);
    };
    
    window.isRaspberryPi = isRaspberryPi();
    console.log('ü•ß Raspberry Pi detected:', window.isRaspberryPi);
  </script>
  
  <style>
    /* Base styles for AR container */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }
    
    /* Main Layout Container */
    .main-container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }
    
    /* Camera Container - Fixed Size */
    .camera-container {
      flex: 1;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background: #000;
      border-right: 2px solid #4CAF50;
    }
    
    /* AR Scene Container - Within Camera Container */
    #ar-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    
    /* Video element styling */
    #ar-video {
      background: #000;
      border-radius: 0;
    }
    
    /* UI Overlay - Only for camera controls */
    .ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      pointer-events: none;
    }
    
    /* Top bar with controls - Only in camera area */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      pointer-events: auto;
    }
    
    .logo {
      height: 30px;
      width: auto;
    }
    
    .title {
      font-size: 20px;
      font-weight: 600;
      color: white;
      text-align: center;
      flex: 1;
    }
    
    /* Home Button - Prominent and separate */
    .home-button {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 0;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1001;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      pointer-events: auto;
    }
    
    .home-button:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    .home-button:active {
      transform: scale(0.95);
    }
    
    /* Bottom controls - Only in camera area */
    .bottom-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      pointer-events: auto;
    }
    
    .control-btn {
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      font-size: 14px;
      font-weight: 500;
    }
    
    .control-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
    }
    
    .control-btn.active {
      background: rgba(33, 150, 243, 0.8);
      border-color: #2196f3;
    }
    
    /* Right Side Panel - Fixed, Non-transparent */
    .side-panel {
      position: fixed;
      right: 0;
      top: 0;
      width: 280px;
      height: 100vh;
      background: #2d2d2d;
      border-left: 3px solid #4CAF50;
      overflow-y: auto;
      z-index: 2000;
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .panel-title {
      font-size: 18px;
      font-weight: 600;
      margin: 20px 20px 15px 20px;
      color: #fff;
      text-align: center;
      padding: 15px;
      background: #4CAF50;
      border-radius: 10px;
    }
    
    .ar-option {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      margin: 8px 15px;
      background: #3d3d3d;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .ar-option:hover {
      background: #4d4d4d;
      border-color: #4CAF50;
      transform: translateX(-5px);
    }
    
    .ar-option.active {
      background: #4CAF50;
      border: 2px solid #45a049;
      color: white;
    }
    
    .ar-icon {
      width: 25px;
      height: 25px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .ar-option.active .ar-icon {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Loading screen - simplified */
    .loading-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: opacity 0.3s ease;
    }
    
    .loading-text {
      margin-top: 20px;
      font-size: 18px;
      color: white;
      text-align: center;
    }
    
    /* AR Status indicator - Only in camera area */
    .ar-status {
      position: absolute;
      top: 80px;
      left: 20px;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 25px;
      font-size: 14px;
      color: white;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      pointer-events: auto;
    }
    
    .status-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse 2s infinite;
    }
    
    .status-dot.camera { background: #4caf50; }
    .status-dot.ar { background: #2196f3; }
    .status-dot.error { background: #f44336; }
    
    /* Error message */
    .error-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(244, 67, 54, 0.95);
      padding: 25px;
      border-radius: 15px;
      color: white;
      text-align: center;
      max-width: 80%;
      backdrop-filter: blur(15px);
      z-index: 3000;
      border: 2px solid #d32f2f;
    }
    
    /* AR Objects Container - Constrained to camera area */
    #ar-objects {
      position: absolute;
      top: 0;
      left: 0;
      width: calc(100vw - 280px); /* Full width minus side panel */
      height: 100vh;
      pointer-events: auto;
      z-index: 10;
    }
    
    /* Guidance Elements */
    .guidance-element {
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #FFC65D;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      min-width: 150px;
      pointer-events: none;
    }
    
    .guidance-arrow {
      font-size: 48px;
      margin-bottom: 10px;
      display: block;
    }
    
    .guidance-text {
      font-size: 16px;
      font-weight: bold;
      color: #FFC65D;
      margin-bottom: 8px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }
    
    .guidance-progress {
      font-size: 12px;
      color: #4CAF50;
      opacity: 0.8;
    }
    
    .guidance-validation {
      font-size: 14px;
      color: #FF9800;
      font-weight: 500;
      margin-top: 8px;
      padding: 8px;
      background: rgba(255, 152, 0, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    /* Guidance Hint */
    .guidance-hint {
      background: rgba(33, 150, 243, 0.95);
      border: 3px solid #2196F3;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(33, 150, 243, 0.4);
      min-width: 200px;
      pointer-events: none;
    }
    
    .hint-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }
    
    .hint-text {
      font-size: 16px;
      font-weight: bold;
      color: white;
      margin-bottom: 8px;
    }
    
    .hint-subtext {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      opacity: 0.9;
    }
    
    /* Arrow Direction Styles */
    .arrow-right { color: #4CAF50; }
    .arrow-left { color: #EF2D5E; }
    .arrow-up { color: #2196F3; }
    .arrow-hold { color: #FFC65D; animation: pulse 1s ease-in-out infinite; }
    .arrow-dig { color: #FF9800; animation: bounce 0.5s ease-in-out infinite; }
    
    /* Action Icon Styles */
    .action-open { color: #4CAF50; }
    .action-remove { color: #EF2D5E; }
    .action-sensor { color: #2196F3; }
    .action-unbolt { color: #FF9800; }
    .action-found { color: #4CAF50; animation: celebration 1s ease-in-out infinite; }
    
    /* Completion Message */
    .guidance-completion {
      background: rgba(0, 0, 0, 0.9);
      border: 4px solid #4CAF50;
      border-radius: 25px;
      padding: 30px;
      text-align: center;
      backdrop-filter: blur(15px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
      min-width: 250px;
      pointer-events: none;
    }
    
    .completion-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .completion-text {
      font-size: 24px;
      font-weight: bold;
      color: #FFC65D;
      margin-bottom: 10px;
    }
    
    .completion-subtext {
      font-size: 18px;
      color: #4CAF50;
      opacity: 0.9;
    }
    
    /* Animations */
    @keyframes guidancePulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }
    
    @keyframes completionCelebration {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      25% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.9; }
      75% { transform: translate(-50%, -50%) scale(0.9); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes celebration {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(5deg); }
      75% { transform: scale(0.9) rotate(-5deg); }
    }
    
    @keyframes hintPulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.05); opacity: 0.9; }
    }
    
    /* Responsive design */
    @media (max-width: 1200px) {
      .side-panel {
        width: 250px;
      }
      
      #ar-objects {
        width: calc(100vw - 250px);
      }
    }
    
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      
      .camera-container {
        height: 70vh;
      }
      
      .side-panel {
        position: fixed;
        bottom: 0;
        right: 0;
        top: auto;
        width: 100%;
        height: 30vh;
        border-left: none;
        border-top: 3px solid #4CAF50;
        overflow-x: auto;
        overflow-y: hidden;
      }
      
      .side-panel .ar-option {
        display: inline-block;
        min-width: 120px;
        margin: 8px 10px;
        text-align: center;
      }
      
      #ar-objects {
        width: 100%;
        height: 70vh;
      }
      
      .top-bar {
        padding: 10px 15px;
      }
      
      .title {
        font-size: 16px;
      }
      
      .bottom-controls {
        bottom: 10px;
        gap: 10px;
      }
      
      .control-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Simple Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="loading-text">
      <p id="loading-main-text">Starting AR Guidance System...</p>
    </div>
  </div>

  <!-- Error Message (hidden by default) -->
  <div id="error-message" class="error-message" style="display: none;">
    <h3>ü•ß Raspberry Pi AR Setup Required</h3>
    <p id="error-text">Please allow camera access to use AR features. Refresh the page and try again.</p>
    <div style="margin-top: 15px;">
      <button onclick="retryCamera()" style="margin: 5px; padding: 10px 20px; background: white; color: #f44336; border: none; border-radius: 5px; cursor: pointer;">üîÑ Retry Camera</button>
      <button onclick="goHome()" style="margin: 5px; padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">üè† Go Home</button>
    </div>
    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 12px;">
      <strong>ü•ß Raspberry Pi Setup Tips:</strong><br>
      ‚Ä¢ Run <code>sudo raspi-config</code> ‚Üí Interface Options ‚Üí Camera ‚Üí Enable<br>
      ‚Ä¢ Make sure no other apps are using the camera<br>
      ‚Ä¢ Use Chromium browser (pre-installed) for best compatibility<br>
      ‚Ä¢ Ensure you're on local network or HTTPS<br>
      ‚Ä¢ Try rebooting the Pi if camera fails<br>
      ‚Ä¢ Check camera cable connection<br>
      ‚Ä¢ Free up RAM by closing other applications
    </div>
  </div>

  <!-- AR Container -->
  <div class="main-container">
    <!-- Camera Container -->
    <div class="camera-container">
      <div id="ar-container">
        <!-- AR Overlay System (simplified) -->
        <div id="ar-overlay" style="
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 2;
          pointer-events: none;
        ">
          <!-- AR Objects Container -->
          <div id="ar-objects" style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: auto;
          ">
            <!-- AR Box -->
            <div id="ar-box" class="ar-object" style="
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              width: 100px;
              height: 100px;
              background: linear-gradient(45deg, #4CC3D9, #2196F3);
              border-radius: 10px;
              box-shadow: 0 8px 32px rgba(0,0,0,0.3);
              opacity: 0;
              transition: all 0.5s ease;
              pointer-events: auto;
              cursor: pointer;
            " onclick="toggleObject('ar-box')">
              <div style="
                position: absolute;
                top: -30px;
                left: 50%;
                transform: translateX(-50%);
                color: white;
                font-size: 12px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
              ">AR Box</div>
            </div>
            
            <!-- AR Sphere -->
            <div id="ar-sphere" class="ar-object" style="
              position: absolute;
              top: 40%;
              left: 30%;
              width: 80px;
              height: 80px;
              background: radial-gradient(circle, #EF2D5E, #C2185B);
              border-radius: 50%;
              box-shadow: 0 6px 24px rgba(0,0,0,0.3);
              opacity: 0;
              transition: all 0.5s ease;
              pointer-events: auto;
              cursor: pointer;
            " onclick="toggleObject('ar-sphere')">
              <div style="
                position: absolute;
                top: -25px;
                left: 50%;
                transform: translateX(-50%);
                color: white;
                font-size: 12px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
              ">AR Sphere</div>
            </div>
            
            <!-- AR Text -->
            <div id="ar-text" class="ar-object" style="
              position: absolute;
              top: 60%;
              left: 70%;
              color: #FFC65D;
              font-size: 24px;
              font-weight: bold;
              text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
              opacity: 0;
              transition: all 0.5s ease;
              pointer-events: auto;
              cursor: pointer;
              text-align: center;
              min-width: 120px;
            " onclick="toggleObject('ar-text')">
              Hello AR!
            </div>
          </div>
          
          <!-- AR Grid Overlay -->
          <div id="ar-grid" style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
            pointer-events: none;
            z-index: 1;
          ">
            <div style="
              position: absolute;
              top: 50%;
              left: 0;
              right: 0;
              height: 1px;
              background: rgba(255,255,255,0.5);
            "></div>
            <div style="
              position: absolute;
              left: 50%;
              top: 0;
              bottom: 0;
              width: 1px;
              background: rgba(255,255,255,0.5);
            "></div>
          </div>
        </div>

        <!-- UI Overlay -->
        <div class="ui-overlay">
          <!-- Top Bar -->
          <div class="top-bar">
            <img src="../assets/Matrix.png" alt="Matrix TSL" class="logo" />
            <div class="title">AR Guidance System</div>
            <button id="btn-home" class="control-btn" onclick="goHome()">üè† Home</button>
          </div>

          <!-- AR Status -->
          <div class="ar-status">
            <span id="status-indicator" class="status-dot camera"></span>
            <span id="status-text">Camera Active</span>
          </div>

          <!-- Bottom Controls -->
          <div class="bottom-controls">
            <button class="control-btn" onclick="startGuidance()">‚ñ∂Ô∏è Start</button>
            <button class="control-btn" onclick="toggleCamera()">üìπ Camera</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side Panel -->
    <div class="side-panel">
      <div class="panel-title">AR Guidance System</div>
      
      <div class="ar-option active" onclick="toggleGuidanceMode()">
        <div class="ar-icon">üéØ</div>
        <span id="mode-toggle">Treasure Hunt</span>
      </div>
      
      <div class="ar-option" onclick="startGuidance()">
        <div class="ar-icon">‚ñ∂Ô∏è</div>
        <span>Start Guidance</span>
      </div>
      
      <div class="ar-option" onclick="captureScreenshot()">
        <div class="ar-icon">üì∏</div>
        <span>Screenshot</span>
      </div>
    </div>
  </div>

  <script>
    // AR Guidance System State
    let currentMode = 'treasure'; // 'treasure' or 'troubleshoot'
    let currentStep = 0;
    let isGuidanceActive = false;
    let guidanceSteps = [];
    let currentArrow = null;
    let cameraStream = null;
    let videoElement = null;
    
    // Motion tracking for guidance validation
    let motionTracker = {
      lastPosition: { x: 0, y: 0 },
      currentPosition: { x: 0, y: 0 },
      movementThreshold: 50, // Minimum pixels to move
      isTracking: false,
      startTime: 0,
      guidanceTimeout: null,
      cameraWidth: 0, // Added for camera boundaries
      cameraHeight: 0 // Added for camera boundaries
    };

    // Treasure Hunt Guidance Steps
    const treasureSteps = [
      { direction: 'right', text: 'Go this way', duration: 10000, arrow: '‚Üí', requiredMovement: 'right', validation: 'Move camera right to continue' },
      { direction: 'left', text: 'Turn left here', duration: 10000, arrow: '‚Üê', requiredMovement: 'left', validation: 'Move camera left to continue' },
      { direction: 'up', text: 'Go up the hill', duration: 12000, arrow: '‚Üë', requiredMovement: 'up', validation: 'Move camera up to continue' },
      { direction: 'hold', text: 'Hold it there...', duration: 8000, arrow: '‚óè', requiredMovement: 'hold', validation: 'Keep camera steady for 3 seconds' },
      { direction: 'right', text: 'Perfect! Now right', duration: 10000, arrow: '‚Üí', requiredMovement: 'right', validation: 'Move camera right to continue' },
      { direction: 'dig', text: 'Dig here! Gold found!', duration: 15000, arrow: '‚õèÔ∏è', requiredMovement: 'down', validation: 'Move camera down to dig' }
    ];

    // Troubleshooting Guidance Steps
    const troubleshootSteps = [
      { action: 'open', text: 'Open that panel', duration: 10000, icon: 'üîß', requiredMovement: 'right', validation: 'Move camera right to open panel' },
      { action: 'remove', text: 'Remove that cover', duration: 10000, icon: 'üîÑ', requiredMovement: 'left', validation: 'Move camera left to remove cover' },
      { action: 'sensor', text: 'There is the sensor', duration: 8000, icon: 'üì°', requiredMovement: 'up', validation: 'Move camera up to see sensor' },
      { action: 'remove', text: 'Remove the sensor', duration: 12000, icon: 'üîÑ', requiredMovement: 'down', validation: 'Move camera down to remove sensor' },
      { action: 'unbolt', text: 'Unbolt that bracket', duration: 15000, icon: 'üî©', requiredMovement: 'hold', validation: 'Keep camera steady to unbolt' },
      { action: 'found', text: 'Perfect! There\'s the fault!', duration: 10000, icon: '‚úÖ', requiredMovement: 'center', validation: 'Center camera to confirm fault' }
    ];

    // Initialize AR Guidance System
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üéØ Starting AR Guidance System - Treasure Hunt & Troubleshooting');
      
      // Initialize camera first, then guidance system
      initializeCamera();
    });

    // Initialize camera using the same approach as camera.html
    async function initializeCamera() {
      updateLoadingMessage('Starting guidance camera...');
      
      try {
        // Check camera permissions first (if available)
        try {
          const permission = await navigator.permissions.query({ name: 'camera' });
          if (permission.state === 'denied') {
            throw new Error('Camera permission denied');
          }
        } catch (permError) {
          console.log('Permissions API not available, proceeding with camera start');
        }
        
        // Use optimized constraints based on screen size
        const constraints = {
          video: {
            width: { ideal: 640, max: 1280 },
            height: { ideal: 480, max: 720 },
            frameRate: { ideal: 15, max: 30 }
          }
        };

        console.log('üìπ Requesting camera access...');
        cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        
        // Create video element for AR
        createARVideo();
        
        updateLoadingMessage('Camera active - starting guidance system...');
        updateStatus('Camera Active', 'camera');
        
        // Initialize guidance system after camera is ready
        setTimeout(() => {
          initializeGuidanceSystem();
        }, 1000);
        
      } catch (error) {
        console.error('‚ùå Camera initialization failed:', error);
        
        let errorMessage = 'Camera failed to start. Please check permissions and refresh.';
        
        if (error.name === 'NotAllowedError' || error.message === 'Camera permission denied') {
          errorMessage = 'Camera permission denied. Please allow camera access and refresh.';
        } else if (error.name === 'NotFoundError') {
          errorMessage = 'No camera found. Please connect a camera and refresh.';
        } else if (error.name === 'NotReadableError') {
          errorMessage = 'Camera is in use by another application. Please close other camera apps and refresh.';
        }
        
        showError(errorMessage);
      }
    }

    // Create video element for AR display
    function createARVideo() {
      // Remove existing video if any
      const existingVideo = document.querySelector('#ar-video');
      if (existingVideo) {
        existingVideo.remove();
      }
      
      // Create new video element
      videoElement = document.createElement('video');
      videoElement.id = 'ar-video';
      videoElement.autoplay = true;
      videoElement.muted = true;
      videoElement.playsInline = true;
      videoElement.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        z-index: 1;
      `;
      
      // Set video source
      videoElement.srcObject = cameraStream;
      
      // Add to AR container
      const arContainer = document.getElementById('ar-container');
      arContainer.appendChild(videoElement);
      
      // Wait for video to load
      videoElement.addEventListener('loadedmetadata', () => {
        console.log('üìπ AR Video ready:', videoElement.videoWidth, 'x', videoElement.videoHeight);
        updateLoadingMessage('Guidance Video Ready!');
        
        // Adjust video positioning after metadata loads
        adjustVideoPositioning();
      });
      
      // Handle video errors
      videoElement.addEventListener('error', (e) => {
        console.error('‚ùå Video error:', e);
        showError('Video playback error. Please refresh the page.');
      });
    }

    // Adjust video positioning to ensure it's fully visible
    function adjustVideoPositioning() {
      if (!videoElement) return;
      
      const container = document.getElementById('ar-container');
      const containerRect = container.getBoundingClientRect();
      const videoRect = videoElement.getBoundingClientRect();
      
      // Calculate the available space (excluding side panel)
      const sidePanelWidth = window.innerWidth <= 1200 ? 250 : 280;
      const availableWidth = window.innerWidth - sidePanelWidth;
      const availableHeight = window.innerHeight;
      
      // Calculate video dimensions while maintaining aspect ratio
      const videoAspectRatio = videoElement.videoWidth / videoElement.videoHeight;
      const containerAspectRatio = availableWidth / availableHeight;
      
      let finalWidth, finalHeight;
      
      if (videoAspectRatio > containerAspectRatio) {
        // Video is wider than container - fit to width
        finalWidth = availableWidth;
        finalHeight = availableWidth / videoAspectRatio;
      } else {
        // Video is taller than container - fit to height
        finalHeight = availableHeight;
        finalWidth = availableHeight * videoAspectRatio;
      }
      
      // Center the video
      const leftOffset = (availableWidth - finalWidth) / 2;
      const topOffset = (availableHeight - finalHeight) / 2;
      
      videoElement.style.cssText = `
        position: absolute;
        top: ${topOffset}px;
        left: ${leftOffset}px;
        width: ${finalWidth}px;
        height: ${finalHeight}px;
        object-fit: fill;
        z-index: 1;
      `;
      
      console.log('üìπ Video repositioned:', { finalWidth, finalHeight, leftOffset, topOffset });
    }

    // Update loading message
    function updateLoadingMessage(mainText) {
      const mainTextEl = document.getElementById('loading-main-text');
      if (mainTextEl) mainTextEl.textContent = mainText;
    }

    // Initialize Guidance System
    function initializeGuidanceSystem() {
      updateLoadingMessage('Starting AR Guidance System...');
      console.log('üéØ Starting AR guidance system');
      
      // Set default mode
      setGuidanceMode('treasure');
      
      // Start motion tracking
      startMotionTracking();
      
      // Hide loading screen
      setTimeout(() => {
        hideLoadingScreen();
        updateStatus('Guidance System Ready - Choose your mode!', 'ar');
      }, 1000);
    }

    // Start motion tracking for guidance validation
    function startMotionTracking() {
      motionTracker.isTracking = true;
      motionTracker.lastPosition = { x: 0, y: 0 };
      motionTracker.currentPosition = { x: 0, y: 0 };
      
      // Set initial camera boundaries
      updateCameraBoundaries();
      
      // Track camera movement using device motion/gyroscope if available
      if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion', handleDeviceMotion);
      }
      
      // Fallback: track mouse/touch movement for desktop testing
      document.addEventListener('mousemove', handleMouseMovement);
      document.addEventListener('touchmove', handleTouchMovement);
      
      console.log('üéØ Motion tracking started');
    }

    // Handle device motion (mobile/tablet)
    function handleDeviceMotion(event) {
      if (!motionTracker.isTracking || !isGuidanceActive) return;
      
      const acceleration = event.accelerationIncludingGravity;
      if (acceleration) {
        motionTracker.currentPosition.x += acceleration.x || 0;
        motionTracker.currentPosition.y += acceleration.y || 0;
        
        checkMovementValidation();
      }
    }

    // Handle mouse movement (desktop)
    function handleMouseMovement(event) {
      if (!motionTracker.isTracking || !isGuidanceActive) return;
      
      motionTracker.currentPosition.x = event.clientX;
      motionTracker.currentPosition.y = event.clientY;
      
      checkMovementValidation();
    }

    // Handle touch movement (mobile)
    function handleTouchMovement(event) {
      if (!motionTracker.isTracking || !isGuidanceActive) return;
      
      const touch = event.touches[0];
      motionTracker.currentPosition.x = touch.clientX;
      motionTracker.currentPosition.y = touch.clientY;
      
      checkMovementValidation();
    }

    // Check if movement matches required direction
    function checkMovementValidation() {
      if (!isGuidanceActive || currentStep >= guidanceSteps.length) return;
      
      const step = guidanceSteps[currentStep];
      const movement = getMovementDirection();
      
      if (movement === step.requiredMovement) {
        // Correct movement detected - advance to next step
        console.log(`üéØ Correct movement detected: ${movement}`);
        advanceToNextStep();
      }
    }

    // Determine movement direction based on position change
    function getMovementDirection() {
      const deltaX = motionTracker.currentPosition.x - motionTracker.lastPosition.x;
      const deltaY = motionTracker.currentPosition.y - motionTracker.lastPosition.y;
      
      // Update last position
      motionTracker.lastPosition = { ...motionTracker.currentPosition };
      
      // Determine primary direction
      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        if (deltaX > motionTracker.movementThreshold) return 'right';
        if (deltaX < -motionTracker.movementThreshold) return 'left';
      } else {
        if (deltaY > motionTracker.movementThreshold) return 'down';
        if (deltaY < -motionTracker.movementThreshold) return 'up';
      }
      
      // Check for hold (minimal movement)
      if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10) {
        return 'hold';
      }
      
      // Check for center (return to middle of camera area)
      const sidePanelWidth = window.innerWidth <= 1200 ? 250 : 280;
      const cameraWidth = window.innerWidth - sidePanelWidth;
      const centerX = cameraWidth / 2;
      const centerY = window.innerHeight / 2;
      
      const distanceFromCenter = Math.sqrt(
        Math.pow(motionTracker.currentPosition.x - centerX, 2) +
        Math.pow(motionTracker.currentPosition.y - centerY, 2)
      );
      
      if (distanceFromCenter < 100) return 'center';
      
      return 'none';
    }

    // Set guidance mode (treasure hunt or troubleshooting)
    function setGuidanceMode(mode) {
      currentMode = mode;
      currentStep = 0;
      isGuidanceActive = false;
      
      // Clear any existing guidance
      clearGuidance();
      
      // Set guidance steps based on mode
      if (mode === 'treasure') {
        guidanceSteps = [...treasureSteps];
        updateStatus('Treasure Hunt Mode - Ready to start!', 'ar');
      } else if (mode === 'troubleshoot') {
        guidanceSteps = [...troubleshootSteps];
        updateStatus('Troubleshooting Mode - Ready to start!', 'ar');
      }
      
      console.log(`üéØ Switched to ${mode} mode with ${guidanceSteps.length} steps`);
    }

    // Start guidance sequence
    function startGuidance() {
      if (isGuidanceActive) {
        console.log('üéØ Guidance already active');
        return;
      }
      
      isGuidanceActive = true;
      currentStep = 0;
      
      console.log(`üéØ Starting ${currentMode} guidance with ${guidanceSteps.length} steps`);
      updateStatus(`Guidance Active - ${currentMode}`, 'ar');
      
      // Start first step
      showNextStep();
    }

    // Advance to next step after successful movement validation
    function advanceToNextStep() {
      // Clear the guidance timeout
      if (motionTracker.guidanceTimeout) {
        clearTimeout(motionTracker.guidanceTimeout);
        motionTracker.guidanceTimeout = null;
      }
      
      currentStep++;
      
      if (currentStep >= guidanceSteps.length) {
        // Guidance complete
        completeGuidance();
      } else {
        // Show next step
        showNextStep();
      }
    }

    // Show next guidance step
    function showNextStep() {
      if (currentStep >= guidanceSteps.length) {
        // Guidance complete
        completeGuidance();
        return;
      }
      
      const step = guidanceSteps[currentStep];
      console.log(`üéØ Step ${currentStep + 1}: ${step.text}`);
      
      // Create and show guidance arrow/icon
      showGuidanceElement(step);
      
      // Show validation instruction
      updateStatus(`Step ${currentStep + 1}: ${step.validation}`, 'ar');
      
      // Set timeout fallback for stuck users (longer duration)
      motionTracker.guidanceTimeout = setTimeout(() => {
        if (isGuidanceActive && currentStep < guidanceSteps.length) {
          // User is stuck - show hint
          showStuckHint(step);
        }
      }, step.duration + 5000); // Extra 5 seconds after the original duration
    }

    // Show hint when user is stuck on a step
    function showStuckHint(step) {
      const hintEl = document.createElement('div');
      hintEl.className = 'guidance-hint';
      hintEl.innerHTML = `
        <div class="hint-icon">üí°</div>
        <div class="hint-text">Hint: ${step.validation}</div>
        <div class="hint-subtext">Try moving your camera in the right direction!</div>
      `;
      
      hintEl.style.cssText = `
        position: absolute;
        left: 50%;
        top: 20%;
        transform: translate(-50%, -50%);
        z-index: 150;
        animation: hintPulse 2s ease-in-out infinite;
      `;
      
      const arObjects = document.getElementById('ar-objects');
      arObjects.appendChild(hintEl);
      
      // Remove hint after 5 seconds
      setTimeout(() => {
        if (hintEl.parentNode) {
          hintEl.remove();
        }
      }, 5000);
      
      console.log('üí° Showing stuck hint for step:', step.text);
    }

    // Show guidance element (arrow or icon)
    function showGuidanceElement(step) {
      // Clear previous guidance
      clearGuidance();
      
      // Create guidance element
      const guidanceEl = document.createElement('div');
      guidanceEl.className = 'guidance-element';
      guidanceEl.id = 'current-guidance';
      
      let content = '';
      let arrowClass = '';
      
      if (currentMode === 'treasure') {
        // Treasure hunt uses directional arrows
        content = step.arrow;
        arrowClass = `arrow-${step.direction}`;
        
        // Add special styling for different directions
        if (step.direction === 'hold') {
          arrowClass = 'arrow-hold';
        } else if (step.direction === 'dig') {
          arrowClass = 'arrow-dig';
        }
      } else {
        // Troubleshooting uses action icons
        content = step.icon;
        arrowClass = `action-${step.action}`;
      }
      
      guidanceEl.innerHTML = `
        <div class="guidance-arrow ${arrowClass}">${content}</div>
        <div class="guidance-text">${step.text}</div>
        <div class="guidance-progress">Step ${currentStep + 1} of ${guidanceSteps.length}</div>
        <div class="guidance-validation">${step.validation}</div>
      `;
      
      // Position within the camera view area (excluding side panel)
      const sidePanelWidth = window.innerWidth <= 1200 ? 250 : 280;
      const cameraWidth = window.innerWidth - sidePanelWidth;
      
      // Position randomly but ensure it's within the visible camera area
      const x = 50 + Math.random() * (cameraWidth - 200);
      const y = 50 + Math.random() * (window.innerHeight - 200);
      
      guidanceEl.style.cssText = `
        position: absolute;
        left: ${x}px;
        top: ${y}px;
        z-index: 100;
        animation: guidancePulse 2s ease-in-out infinite;
      `;
      
      // Add to AR objects container
      const arObjects = document.getElementById('ar-objects');
      arObjects.appendChild(guidanceEl);
      
      currentArrow = guidanceEl;
      
      // Add entrance animation
      guidanceEl.style.opacity = '0';
      guidanceEl.style.transform = 'scale(0.5)';
      setTimeout(() => {
        guidanceEl.style.transition = 'all 0.5s ease';
        guidanceEl.style.opacity = '1';
        guidanceEl.style.transform = 'scale(1)';
      }, 100);
    }

    // Clear current guidance
    function clearGuidance() {
      if (currentArrow) {
        currentArrow.remove();
        currentArrow = null;
      }
      
      // Clear any active guidance timeout
      if (motionTracker.guidanceTimeout) {
        clearTimeout(motionTracker.guidanceTimeout);
        motionTracker.guidanceTimeout = null;
      }
    }

    // Complete guidance sequence
    function completeGuidance() {
      isGuidanceActive = false;
      
      // Show completion message
      const completionEl = document.createElement('div');
      completionEl.className = 'guidance-completion';
      completionEl.innerHTML = `
        <div class="completion-icon">üéâ</div>
        <div class="completion-text">
          ${currentMode === 'treasure' ? 'Treasure Hunt Complete!' : 'Troubleshooting Complete!'}
        </div>
        <div class="completion-subtext">
          ${currentMode === 'treasure' ? 'You found the gold!' : 'You found the fault!'}
        </div>
      `;
      
      completionEl.style.cssText = `
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 200;
        animation: completionCelebration 3s ease-in-out;
      `;
      
      const arObjects = document.getElementById('ar-objects');
      arObjects.appendChild(completionEl);
      
      // Remove completion message after animation
      setTimeout(() => {
        completionEl.remove();
        updateStatus(`${currentMode === 'treasure' ? 'Treasure Hunt' : 'Troubleshooting'} Complete!`, 'ar');
      }, 3000);
      
      console.log(`üéØ ${currentMode} guidance completed!`);
    }

    // Stop current guidance
    function stopGuidance() {
      if (isGuidanceActive) {
        isGuidanceActive = false;
        clearGuidance();
        updateStatus('Guidance Stopped', 'camera');
        console.log('üéØ Guidance stopped');
      }
    }

    // Reset guidance to beginning
    function resetGuidance() {
      stopGuidance();
      currentStep = 0;
      updateStatus('Guidance Reset', 'ar');
      console.log('üéØ Guidance reset');
    }

    // Skip to next step
    function nextStep() {
      if (isGuidanceActive) {
        currentStep++;
        showNextStep();
        console.log(`üéØ Skipped to step ${currentStep + 1}`);
      }
    }

    // Go back to previous step
    function previousStep() {
      if (isGuidanceActive && currentStep > 0) {
        currentStep--;
        showNextStep();
        console.log(`üéØ Went back to step ${currentStep + 1}`);
      }
    }

    // Hide loading screen
    function hideLoadingScreen() {
      const loadingScreen = document.getElementById('loading-screen');
      loadingScreen.style.opacity = '0';
      setTimeout(() => {
        loadingScreen.style.display = 'none';
      }, 500);
    }

    // Show error message
    function showError(message) {
      console.error('‚ùå AR Error:', message);
      const errorDiv = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');
      errorText.textContent = message;
      errorDiv.style.display = 'block';
      hideLoadingScreen();
      updateStatus('Error: ' + message, 'error');
    }

    // Update status indicator
    function updateStatus(text, type) {
      const statusText = document.getElementById('status-text');
      const statusDot = document.getElementById('status-indicator');
      
      if (statusText) statusText.textContent = text;
      if (statusDot) statusDot.className = `status-dot ${type}`;
    }

    // Toggle guidance mode
    function toggleGuidanceMode() {
      const newMode = currentMode === 'treasure' ? 'troubleshoot' : 'treasure';
      setGuidanceMode(newMode);
      
      // Update UI text
      const modeToggle = document.getElementById('mode-toggle');
      if (modeToggle) {
        modeToggle.textContent = newMode === 'treasure' ? 'Treasure Hunt' : 'Troubleshooting';
      }
      
      console.log(`üéØ Switched to ${newMode} mode`);
    }

    // Toggle camera
    function toggleCamera() {
      const cameraActive = !videoElement.style.display || videoElement.style.display === 'block';
      
      if (cameraActive && videoElement) {
        videoElement.style.display = 'none';
        updateStatus('Camera Paused', 'error');
      } else if (videoElement) {
        videoElement.style.display = 'block';
        updateStatus('Camera Active', 'camera');
      }
      
      console.log(`üìπ Camera ${cameraActive ? 'disabled' : 'enabled'}`);
    }

    // Retry camera access
    function retryCamera() {
      console.log('üîÑ Retrying AR Guidance...');
      const errorDiv = document.getElementById('error-message');
      errorDiv.style.display = 'none';
      
      const loadingScreen = document.getElementById('loading-screen');
      loadingScreen.style.display = 'flex';
      updateLoadingMessage('Retrying AR Guidance...');
      
      setTimeout(() => {
        initializeCamera();
      }, 1000);
    }

    // Toggle fullscreen
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
          console.log('‚õ∂ Entered fullscreen mode');
        }).catch(err => {
          console.log('‚ùå Failed to enter fullscreen:', err);
        });
      } else {
        document.exitFullscreen().then(() => {
          console.log('‚õ∂ Exited fullscreen mode');
        });
      }
    }

    // Capture screenshot
    function captureScreenshot() {
      try {
        // Create a canvas to capture the AR scene
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size to match video
        if (videoElement) {
          canvas.width = videoElement.videoWidth || 640;
          canvas.height = videoElement.videoHeight || 480;
        } else {
          canvas.width = 640;
          canvas.height = 480;
        }
        
        // Draw video frame
        if (videoElement && videoElement.videoWidth > 0) {
          ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
        }
        
        // Draw guidance elements on top
        if (currentArrow) {
          const rect = currentArrow.getBoundingClientRect();
          const scaleX = canvas.width / window.innerWidth;
          const scaleY = canvas.height / window.innerHeight;
          
          // Draw guidance element representation
          ctx.fillStyle = '#FFC65D';
          ctx.font = '24px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('üéØ', rect.left * scaleX, rect.top * scaleY);
        }
        
        // Create download link
        const link = document.createElement('a');
        link.download = `ar-guidance-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
        
        console.log('üì∏ AR Guidance screenshot captured');
        updateStatus('Screenshot Saved', 'ar');
        
        setTimeout(() => {
          updateStatus('Guidance System Ready', 'ar');
        }, 2000);
        
      } catch (error) {
        console.error('üì∏ Screenshot failed:', error);
        updateStatus('Screenshot Failed', 'error');
      }
    }

    // Setup AR event listeners
    function setupAREventListeners() {
      // Handle device orientation for mobile
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', function(event) {
          // Optionally handle device orientation for better AR tracking
        });
      }

      // Handle touch events for interaction
      document.addEventListener('touchstart', function(e) {
        // Add touch-based interactions if needed
      });

      // Handle click events for guidance interaction
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('guidance-element')) {
          // Guidance element clicked - could add more interaction here
          console.log('üéØ Guidance element clicked');
        }
      });
    }

    // Navigation
    function goHome() {
      if (window.showcaseFramework && window.showcaseFramework.goHome) {
        window.showcaseFramework.goHome();
      } else {
        window.location.href = '../index.html';
      }
    }

    // Quality mode detection and optimization
    function getQualityMode() {
      const cores = navigator.hardwareConcurrency || 1;
      const memory = navigator.deviceMemory || 1;

      // Pi detection logic
      if (cores <= 4 && memory <= 1) return 'low';
      if (cores <= 4 && memory <= 2) return 'medium';
      return 'high';
    }

    // Apply quality optimizations
    function applyQualityOptimizations() {
      const quality = getQualityMode();
      console.log(`üéÆ AR Quality Mode: ${quality}`);

      // Adjust animation complexity based on quality
      const guidanceElements = document.querySelectorAll('.guidance-element');
      
      switch (quality) {
        case 'low':
          // Low quality optimizations for Pi 3B+
          guidanceElements.forEach(el => {
            el.style.transition = 'all 0.3s ease';
          });
          break;
          
        case 'medium':
          // Medium quality for Pi 4
          guidanceElements.forEach(el => {
            el.style.transition = 'all 0.5s ease';
          });
          break;
          
        case 'high':
          // High quality for Pi 5 and desktop
          guidanceElements.forEach(el => {
            el.style.transition = 'all 0.8s ease';
          });
          break;
      }
    }

    // Apply optimizations when page loads
    document.addEventListener('DOMContentLoaded', applyQualityOptimizations);

    // Handle window resize
    window.addEventListener('resize', () => {
      // Update AR objects container width
      const arObjects = document.getElementById('ar-objects');
      if (arObjects) {
        const sidePanelWidth = window.innerWidth <= 1200 ? 250 : 280;
        arObjects.style.width = `calc(100vw - ${sidePanelWidth}px)`;
      }
      
      // Re-adjust video positioning on resize
      adjustVideoPositioning();
      
      // Update camera boundaries for motion tracking
      updateCameraBoundaries();
    });

    // Update camera boundaries for motion tracking
    function updateCameraBoundaries() {
      const sidePanelWidth = window.innerWidth <= 1200 ? 250 : 280;
      const cameraWidth = window.innerWidth - sidePanelWidth;
      
      // Update motion tracker boundaries
      motionTracker.cameraWidth = cameraWidth;
      motionTracker.cameraHeight = window.innerHeight;
      
      console.log('üìπ Camera boundaries updated:', { cameraWidth, height: window.innerHeight });
    }

    // Console commands for debugging - Enhanced for Guidance System
    window.arDebug = {
      getCurrentMode: () => currentMode,
      getCurrentStep: () => currentStep,
      getGuidanceActive: () => isGuidanceActive,
      getTotalSteps: () => guidanceSteps.length,
      startGuidance: () => startGuidance(),
      stopGuidance: () => stopGuidance(),
      resetGuidance: () => resetGuidance(),
      nextStep: () => nextStep(),
      previousStep: () => previousStep(),
      setMode: (mode) => setGuidanceMode(mode),
      checkCameraStatus: () => {
        if (videoElement) {
          console.log('üìπ AR Video element found:', videoElement);
          console.log('üìä Video stats:', {
            videoWidth: videoElement.videoWidth,
            videoHeight: videoElement.videoHeight,
            readyState: videoElement.readyState,
            paused: videoElement.paused,
            srcObject: !!videoElement.srcObject,
            display: videoElement.style.display
          });
        } else {
          console.log('‚ùå No AR video element found');
        }
        
        // Check for camera stream
        if (cameraStream) {
          console.log('üìπ Camera stream active:', cameraStream);
          const tracks = cameraStream.getTracks();
          tracks.forEach(track => {
            console.log('üìπ Track:', track.kind, track.enabled, track.readyState);
          });
        } else {
          console.log('‚ùå No camera stream found');
        }
        
        return { videoElement, cameraStream };
      },
      forceHideLoading: () => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.display = 'none';
        }
      },
      testBasicCamera: async () => {
        try {
          console.log('üß™ Testing basic camera access...');
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: 320, height: 240 }
          });
          console.log('‚úÖ Basic camera access works!');
          stream.getTracks().forEach(track => track.stop());
          return true;
        } catch (error) {
          console.error('‚ùå Basic camera test failed:', error);
          return false;
        }
      },
      showCurrentStep: () => {
        if (currentStep < guidanceSteps.length) {
          console.log(`üéØ Current step: ${guidanceSteps[currentStep].text}`);
          return guidanceSteps[currentStep];
        } else {
          console.log('üéØ No current step - guidance complete');
          return null;
        }
      },
      jumpToStep: (stepNumber) => {
        if (stepNumber >= 0 && stepNumber < guidanceSteps.length) {
          currentStep = stepNumber;
          if (isGuidanceActive) {
            showNextStep();
          }
          console.log(`üéØ Jumped to step ${stepNumber + 1}`);
        } else {
          console.log('‚ùå Invalid step number');
        }
      }
    };

    console.log('üéØ AR Guidance System Debug commands available:');
    console.log('  arDebug.getCurrentMode() - Get current guidance mode');
    console.log('  arDebug.getCurrentStep() - Get current step number');
    console.log('  arDebug.getGuidanceActive() - Check if guidance is active');
    console.log('  arDebug.getTotalSteps() - Get total number of steps');
    console.log('  arDebug.startGuidance() - Start guidance sequence');
    console.log('  arDebug.stopGuidance() - Stop guidance sequence');
    console.log('  arDebug.resetGuidance() - Reset guidance to beginning');
    console.log('  arDebug.nextStep() - Go to next step');
    console.log('  arDebug.previousStep() - Go to previous step');
    console.log('  arDebug.setMode("treasure"|"troubleshoot") - Set guidance mode');
    console.log('  arDebug.checkCameraStatus() - Check camera/video status');
    console.log('  arDebug.testBasicCamera() - Test basic camera access');
    console.log('  arDebug.forceHideLoading() - Force hide loading screen');
    console.log('  arDebug.showCurrentStep() - Show current step info');
    console.log('  arDebug.jumpToStep(stepNumber) - Jump to specific step');
    console.log('');
    console.log('üéÆ Guidance Features:');
    console.log('  ‚Ä¢ Treasure Hunt Mode: Follow arrows to find gold!');
    console.log('  ‚Ä¢ Troubleshooting Mode: Step-by-step repair guidance');
    console.log('  ‚Ä¢ Interactive arrows and icons overlay on camera');
    console.log('  ‚Ä¢ Auto-advancing steps with customizable timing');
    console.log('  ‚Ä¢ Manual step navigation (next/previous)');
    console.log('  ‚Ä¢ Mode switching between treasure hunt and troubleshooting');
    console.log('  ‚Ä¢ Progress tracking and completion celebrations');
  </script>
</body>
</html>